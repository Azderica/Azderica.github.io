!function(n){n.Oven=n.Oven||{}}(this);$(function(){var e=function(e){_.extend(this,e);var o={"You have the unsaved data in this page. Do you want to restore it?":{ko:"이 페이지에 저장되지 않은 임시데이터가 있습니다. 불러오시겠습니까?"},"Not enough free space. You need to upgrade the account.":{ko:"이미지 저장공간이 가득찼습니다. 계정 업그레이드가 필요합니다."},"Verify your email and get a free upgrade to Standard account now.":{ko:"이메일 인증을 받게 되면 Standard 계정으로 무료 업그레이드 할 수 있습니다."},"You can upload JPG, PNG or GIF files only.":{ko:"JPG, PNG 또는 GIF 파일만 업로드할 수 있습니다"},"Maximum filesize is limited to ":{ko:"이미지 용량이 너무 큽니다.\n이미지파일 당 최대 사이즈 : "},"Multiple image uploading is available up to 10 files.\n Please try again.":{ko:"한번에 동시 업로드할 수 있는 최대 개수는 10개입니다.\n다시 선택해주세요."},"Are you sure to delete?":{ko:"정말로 삭제하시겠습니까?"},"(You cannot recover the removed pages.)":{ko:"(삭제된 페이지는 복원할 수 없습니다.)"},"Are you sure to delete this image?\n(If you used this image on pages, it'll be displayed as a wireframe.)":{ko:"이 이미지를 삭제하시겠습니까?\n(기존에 이 이미지를 페이지에 사용했다면, 해당 이미지 영역은 와이어프레임으로 대체됩니다.)"},"Are you sure to delete these images?\n(If you used thees images on pages, they'll be displayed as wireframes.)":{ko:"이 이미지들을 삭제하시겠습니까?\n(기존에 이 이미지들을 페이지에 사용했다면, 해당 이미지 영역은 와이어프레임으로 대체됩니다.)"},"Drag tabs to change the order":{ko:"드래그하여 순서를 변경할 수 있습니다"},"Right-click to show menu":{ko:"우클릭하여 메뉴 표시"},"You don't have the permission. Please login again.":{ko:"권한이 없습니다. 다시 로그인해주세요"},"Cannot save the page due to error.":{ko:"오류로 인해 저장할 수 없습니다. 다시 시도해주세요."},"Cannot perform action due to an error.":{ko:"오류로 인해 수행할 수 없습니다. 다시 시도해주세요."},"You have unsaved page.":{ko:"변경사항이 저장되지 않은 페이지가 있습니다."},"Sending..":{ko:"전송 중.."},Send:{ko:"보내기"},"Processing..":{ko:"처리 중.."},"Crop and upload":{ko:"선택한 영역으로 새 이미지 등록"},"The filtered filesize is too big to upload.":{ko:"결과물의 파일크기로 인해 업로드할 수 없습니다."},"Filter and upload":{ko:"효과 적용하여 새 이미지 등록"},"URL is invalid.":{ko:"올바른 URL을 입력해주세요"},"Email address is invalid.":{ko:"적합한 이메일주소를 입력해주세요."},"Already exists in the list.":{ko:"공유목록에 존재하는 유저입니다."},"You cannot add yourself.":{ko:"유저 자신은 추가할 수 없습니다."},"Delete selected items?":{ko:"선택된 항목을 삭제할까요?"},"Delete this item?":{ko:"이 항목을 삭제할까요?"},Delete:{ko:"삭제하기"},Cancel:{ko:"취소"},"Same with the currently verified address.":{ko:"현재의 인증된 이메일 주소와 동일합니다."},"We've sent a verification mail. Please check your spam folder if the email doesn’t appear within a few minutes.":{ko:"인증메일이 전송되었습니다. 이메일이 몇 분 이내에 나타나지 않을 경우 스팸 폴더를 확인하시기 바랍니다."},"Email address is already taken.":{ko:"이미 누군가 사용중인 이메일주소입니다"},"Verification canceled.":{ko:"인증 진행이 취소되었습니다."},"Your username is changed.":{ko:"유저이름이 변경되었습니다."},"Password doesn't match<br>the confirmation.":{ko:"앞서 입력한 비밀번호와 다릅니다.<br>확인해주세요."},"Your password is changed.":{ko:"비밀번호가 변경되었습니다."},"Incorrect password.":{ko:"기존의 비밀번호를 잘못 입력하셨습니다."},"Upload size limited to 1MB.":{ko:"1MB 이하의 파일만 첨부할 수 있습니다."},"Thank you for contacting us. We will use your reports as we strive to improve your usability.":{ko:"귀중한 시간을 내주셔서 정말 감사합니다. 보내주신 내용은 잊지않고 반드시 검토 후 확인해보도록 하겠습니다."},"Are you sure?":{ko:"계속 진행할까요?"},"All of your data and the account has been deleted.\nWe'll miss you. Goodbye.":{ko:"계정정보와 데이터가 모두 삭제되었습니다.\n그동안 감사했습니다."},"Incorrect email address or password.":{ko:"입력하신 계정 정보가 맞지 않습니다."},"DoubleClick or drag into canvas to insert":{ko:"더블클릭하거나 캔버스로 드래그하여 삽입"},"This page has been modified but not saved. Do you wish to continue?":{ko:"이 페이지의 수정사항이 저장되지 않았습니다. 계속 진행하시겠습니까?\n(마지막에 저장된 데이터를 기준으로 실행됩니다.)"},"Some pages have been modified but not saved. Do you wish to continue?":{ko:"일부 페이지들의 수정사항이 저장되지 않았습니다. 계속 진행하시겠습니까?\n(마지막에 저장된 데이터를 기준으로 실행됩니다.)"}};return this.convert=function(e){var a=this.locale,t=o[e];if(!t)return e;var i=t[a];return i||e},this};Oven.Translation=e});$(function(){var e=function(){this.encodeHtml=function(e){var t={"&":"&amp;","'":"&#39;",'"':"&quot;","<":"&lt;",">":"&gt;"},a=function(e){return t[e]||e};return e.replace(/[&<>]/g,a)},this.decodeHtml=function(e){var t={"&amp;":"&","&#39;":"'","&quot;":'"',"&lt;":"<","&gt;":">"},a=function(e){return t[e]||e};return e.replace(/&amp;|&lt;|&gt;/g,a)},this.makeThumbnail=function(e,t){var a,n=e.projectId,i=e.model,o=e.seqId,r=e.screenWidth,d=e.screenHeight,c=e.background,s=e.content,m=e.modidate,h=window.localStorage,l=n+":"+o,p=r,u=p*(1/3);u=u>326?326:u;var g=d,v=g*(1/3);v=v>1/3*500?1/3*500:v,e.thumbnail&&e.thumbnail.css({width:u/2,height:v/2});var f=u,w=v,I=h.getItem(l);if(!i.get("_thumbnail")&&I&&I.split("_data:image")[0]==m)return a={data:I.split(m+"_")[1],w:f,h:w,isNew:!1};var b=$(document.createElement("div")).attr("data-canvas","true").css({position:"absolute",top:0,overflow:"hidden",opacity:0,width:1,height:1}).addClass("canvas"),E=$(document.createElement("div")).width(p).height(g).css({overflow:"hidden",backgroundColor:c});E.html(s),E.find("[data-obj-type='image']").each(function(){var e=$(this);parseInt(e.css("left"))<0&&e.find("[data-image-content]").css("backgroundPositionX",parseInt(e.css("left"))),parseInt($(this).css("top"))<0&&e.find("[data-image-content]").css("backgroundPositionY",parseInt(e.css("top"))),e.find("[data-image-content]").css("backgroundSize",e.width()+"px "+e.height()+"px")}),b.append(E),$("body").append(b),html2canvas(E.get(0),{height:d,onrendered:function(e){var n=document.createElement("canvas");n.width=f,n.height=w;var i=n.getContext("2d");i.scale(1/3,1/3),i.drawImage(e,0,0,e.width,e.height),b.remove();var o=n.toDataURL("image/jpeg",.7);if(a={data:o,w:f,h:w,isNew:!0},"function"==typeof t)return t(a),!0}})},this.ajaxDownload=function(e){var t;if($.cookie("OVEN_PROCESSING_FILES"))return alert("요청하신 파일을 처리 중입니다. 처리가 완료되어 다운로드가 시작되면 다시 시도해주세요."),!1;t=$($("#processingFileTemplate").html()),$("body").append(t),window.checkProcessingInterval=setInterval(function(){if($.cookie("OVEN_PROCESSING_FILES"))return!1;t.remove(),clearInterval(window.checkProcessingInterval),delete window.checkProcessingInterval},100),$.cookie("OVEN_PROCESSING_FILES",!0,{path:"/"});var a;$("iframe[name='"+e.frameName+"']").length>0?a=$("iframe[name='"+e.frameName+"']"):(a=$(document.createElement("iframe")),a.attr({frameborder:0,name:e.frameName,style:"position:absolute;top:0;left:0;z-index:-1;overflow:hidden;width:1px;height:0px;"}),$("body").append(a));var n=$(document.createElement("form"));n.attr({action:e.url,method:e.method,target:e.frameName});for(var i in e.data)n.append("<input type='hidden' name='"+i+"' value=''>"),n.find("input[name='"+i+"']").val(e.data[i]);n.hide(),$("body").append(n),n.submit(),n.remove()},this.compressCanvas=function(e,t){var a=e.canvas,n=e.width,i=e.height,o=e.mimetype,r=new Image;r.width=n,r.height=i,r.src=a.toDataURL(o,.8),r.onload=function(){var e=document.createElement("canvas");e.width=n,e.height=i,e.getContext("2d").drawImage(r,0,0);var a=e.toDataURL(o);a=a.replace("data:"+o+";base64,",""),$(e).remove(),$(r).remove(),"function"==typeof t&&t(a)}}};Oven.Util=e});$(function(){var e=Backbone.Model.extend({idAttribute:"pro_id",urlRoot:"/api/projects/",initialize:function(e){_.extend(this,e)},defaults:{pro_title:"",pro_description:"",pro_screen:0,pro_editortype:0,pro_public_read:"N",pro_modidate:"",pro_regidate:"",user_id:"",user_email:"",user_profile:"",user_name:"",perm_read:"",perm_write:"",shared_count:0,_isChecked:!1,_isSharedProject:0}}),r=e.extend({initialize:function(){this.urlRoot=0==this.get("_isSharedProject")?"/api/projects":"/api/sharedProjects"}});Oven.Project=Oven.Project||{},Oven.Project.Model=e,Oven.Project.SearchModel=r});$(function(){var e=Backbone.Model.extend({idAttribute:"perm_id",defaults:{pro_id:"",user_name:"",user_email:"",perm_read:"Y",perm_modidate:"",perm_regidate:""}});Oven.Permission=Oven.Permission||{},Oven.Permission.Model=e});$(function(){var e=Oven.Permission.Model,n=Backbone.Collection.extend({model:e});Oven.Permission=Oven.Permission||{},Oven.Permission.Collection=n});$(function(){var e=Backbone.View.extend({tagName:"tr",events:{"click .send_invitation":"sendInvitation","click .btn_dismiss":"remove"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render"),this.template=_.template($("#confirmInvitationTemplate").html()),this.completeTemplate=_.template($("#confirmInvitationCompleteTemplate").html())},render:function(){return this.$el.html(this.template({user_email:this.user_email})),this},sendInvitation:function(){var e=this;$.ajax({url:"/api/sendShareInvitation",type:"POST",data:{perm_id:this.perm_id},success:function(){e.$el.html(e.completeTemplate({user_email:e.user_email}))}})},remove:function(){var e=this;this.$el.fadeOut(function(){e.$el.unbind().remove(),e.item.invitationMsg=void 0,delete e.item})}}),t=Backbone.View.extend({tagName:"tr",events:{"click .delete_user":"deleteUser","click .btn_perm":"permWriteClickHandler","click .show_invitation":"confirmInvitation"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","destroyHandler","confirmInvitation"),this.template=_.template($("#projectPermissionItemTemplate").html()),this.model.item=this,this.model.on({"change:perm_id":this.render,destroy:this.destroyHandler,"change:perm_write":this.render})},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},confirmInvitation:function(){if(this.invitationMsg)return this.invitationMsg.$el.show(),!1;this.invitationMsg=new e({user_email:this.model.get("user_email"),perm_id:this.model.id,item:this}),this.$el.after(this.invitationMsg.render().$el)},deleteUser:function(){var e=this,t=loggedUser.email==this.model.get("user_email");if(t&&!confirm("유저 자신을 공유목록에서 삭제하면 더이상 프로젝트에 접근할 수 없게 됩니다. 계속하시겠습니까?"))return!1;this.model.destroy({dataType:"text",success:function(){if(t){var i=e.list.dialog.model;e.list.dialog.$el.modal("hide"),e.list.dialog.builder?window.opener?(window.opener.location.reload(),window.close()):location.href="/":permModel.collection&&(i.collection.remove(i),i.item.destroyHandler())}},error:function(t,i){403==i.status?alert("You don't have the permission."):alert("Cannot perform action due to an error."),e.list.dialog.$el.modal("hide")}}),void 0!==this.invitationMsg&&this.invitationMsg.remove()},destroyHandler:function(){this.$el.fadeOut(function(){this.remove()})},permWriteClickHandler:function(e){var t=$(e.currentTarget).find("input").get(0).checked,i=!t;this.model.save({perm_write:!0===i?"Y":"N"},{patch:!0})}});Oven.Permission=Oven.Permission||{},Oven.Permission.Item=t});$(function(){var e=Oven.Translation,i=Oven.Permission.Collection,t=Oven.Permission.Item,n=Backbone.View.extend({events:{"keydown .add_user_input":"addUserKeydownHadnler","click .add_user":"addUserClickHandler"},initialize:function(t){_.extend(this,t),_.bindAll(this,"render","appendItem","addItem","validateEmail"),this.formEl=$($("#projectPermissionFormTemplate").html()),this.translation=new e({locale:loggedUser.locale}),this.collection=new i,this.collection.url=this.permissionUrl,this.collection.on({reset:this.render,add:this.addItem}),this.collection.fetch({reset:!0})},render:function(){this.$el.find(".permission_form").append(this.formEl),this.collection.each(this.appendItem)},appendItem:function(e){var i=new t({model:e,list:this});this.$el.find("tbody").append(i.render().el)},addItem:function(e){this.appendItem(e),this.$el.find(".permission_wrapper").stop().animate({scrollTop:this.$el.find(".permission_wrapper").scrollTop()+e.item.$el.position().top}),this.confirmInvitation(e)},confirmInvitation:function(e){e.item.confirmInvitation()},validateEmail:function(e){var i;if(/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e))if(this.collection.where({user_email:e}).length>0)i=this.translation.convert("Already exists in the list.");else{if(e!=loggedUser.email)return!0;i=this.translation.convert("You cannot add yourself.")}else i=this.translation.convert("Email address is invalid.");var t=this.formEl.find("input");return t.popover({content:i,placement:"bottom"}),t.popover("show"),t.focus(),!1},addUserClickHandler:function(){var e=this,i=$.trim(this.formEl.find("input").val());if(!1===this.validateEmail(i))return!1;var t={user_email:i};this.collection.create(t,{success:function(){e.formEl.find("input").val("")},wait:!0})},addUserKeydownHadnler:function(e){13==e.which?this.addUserClickHandler():this.formEl.find("input").popover("destroy")}});Oven.Permission=Oven.Permission||{},Oven.Permission.List=n});$(function(){var t=Backbone.View.extend({events:{"submit #loginForm":"submitLogin"},initialize:function(t){_.extend(this,t),_.bindAll(this,"render"),this.template=_.template($("#login_dialog").html()),this.render()},render:function(){""==this.$el.html()?this.$el=$(this.template()):this.$el.html($(this.template()).html()),this.delegateEvents(),this.$el.modal("show")},submitLogin:function(t){t.preventDefault();var e=$(t.currentTarget),i=$.trim(e.find("input[name='email']").val()),n=$.trim(e.find("input[name='pass']").val());if(i.length<1||n.length<1)return alert("올바른 이메일와 비밀번호 값을 입력해주세요"),!1;var a=this;return $.ajax({url:"/api/login",type:"POST",data:{email:i,pass:n,formDate:new Date},success:function(t,e,i){200===i.status&&(a.$el.find("form").get(0).reset(),a.$el.modal("hide"),setTimeout(function(){"function"==typeof a.callback&&a.callback()},300))},error:function(t){401===t.status?alert("이메일주소 또는 비밀번호가 맞지 않습니다. 다시 시도해주세요."):alert("로그인 할 수 없습니다. 다시 시도해주세요."),e.find("input[name='email']").focus()}}),!1}});Oven.Project=Oven.Project||{},Oven.Project.LoginDialog=t});$(function(){var e=Backbone.View.extend({events:{"click .export_project_png":"exportProjectAsPNG","click .export_project_jpg":"exportProjectAsJPG","click .export_project_pdf":"exportProjectAsPDF","click .export_project_pdf_withmemo":"exportProjectAsPDFwithMemo","click .export_project_pdf_allpage":"exportAllpageAsPDF","click .export_project_pdf_allpage_withmemo":"exportAllpageAsPDFwithMemo"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render"),this.template=_.template($("#downloadProjectDialogTemplate").html()),this.render()},render:function(){if(this.builder.sequenceList.collection.where({_isModified:!0}).length>0&&!confirm(this.builder.translation.convert("Some pages have been modified but not saved. Do you wish to continue?")))return!1;var e={each_length:10,pro_title:this.builder.projectModel.get("pro_title"),page_length:this.builder.sequenceList.collection.length};""===this.$el.html()?this.$el=$(this.template(e)):this.$el.html($(this.template(e)).html()),this.delegateEvents(),this.$el.modal("show")},exportProjectAsPNG:function(e){var t=parseInt($(e.currentTarget).attr("data-index")),r=parseInt($(e.currentTarget).attr("data-postfix"));if(isNaN(t)||isNaN(r))return!1;this.builder.sequenceList.exportProjectAsPNG(t,r)},exportProjectAsJPG:function(e){var t=parseInt($(e.currentTarget).attr("data-index")),r=parseInt($(e.currentTarget).attr("data-postfix"));if(isNaN(t)||isNaN(r))return!1;this.builder.sequenceList.exportProjectAsJPG(t,r)},exportProjectAsPDF:function(e){var t=parseInt($(e.currentTarget).attr("data-index")),r=parseInt($(e.currentTarget).attr("data-postfix"));if(isNaN(t)||isNaN(r))return!1;this.builder.sequenceList.exportProjectAsPDF(t,r)},exportProjectAsPDFwithMemo:function(e){var t=parseInt($(e.currentTarget).attr("data-index")),r=parseInt($(e.currentTarget).attr("data-postfix"));if(isNaN(t)||isNaN(r))return!1;this.builder.sequenceList.exportProjectAsPDF(t,r,!0)},exportAllpageAsPDF:function(){this.builder.sequenceList.exportAllpageAsPDF()},exportAllpageAsPDFwithMemo:function(){this.builder.sequenceList.exportAllpageAsPDF(!0)}});Oven.Dialog=Oven.Dialog||{},Oven.Dialog.DownloadProject=e});$(function(){var e=new Oven.Util,t=Backbone.View.extend({events:{"click .save_modify":"saveProject","click .device_select label":"deviceClickHandler"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render"),this.template=_.template($("#dashboard_project_modal_modify").html()),this.render()},render:function(){if(""==this.$el.html()?this.$el=$(this.template(this.model.toJSON())):this.$el.html($(this.template(this.model.toJSON())).html()),this.delegateEvents(),void 0!==this.startTabSelector){var e=this.$el.find(this.startTabSelector);e.tab("show"),this.$el.find(".tab-pane.in.active").removeClass("active in"),this.$el.find(e.attr("href")).addClass("active in"),this.startTabSelector=void 0}this.$el.modal("show")},validateCurrentStep:function(){var e=this.$el.find("input:required");if(e.length<1)return!0;for(var t=0;t<e.length;t++){if($.trim($(e[t]).val()).length<1)return $(e[t]).popover({content:e[t].getAttribute("placeholder"),placement:"bottom"}),$(e[t]).popover("show"),e[t].focus(),!1}return!0},saveProject:function(){if(this.model.get("_isSharedProject"))return!1;if(!this.validateCurrentStep())return!1;var t=this,i=this.$el.find("form");this.model.save({pro_title:e.encodeHtml($.trim(i.find("input[name='pro_title']").val())),pro_description:e.encodeHtml($.trim(i.find("textarea[name='pro_description']").val())),pro_screen:i.find("input[name='pro_screen']:checked").val(),pro_editortype:i.find("input[name='pro_editortype']:checked").val(),pro_public_read:i.find("input[name='pro_public_read']:checked").val()||"N"},{success:function(e){t.$el.modal("hide"),e.trigger("patch")},patch:!0})},deviceClickHandler:function(e){this.$el.find(".device_select .btn-info").removeClass("btn-info"),$(e.currentTarget).addClass("btn-info")}});Oven.Project=Oven.Project||{},Oven.Project.ModifyDialog=t});$(function(){var e=Oven.Permission.List,t=Backbone.View.extend({events:{"click .btn_pro_public":"proPublicClickHandler","hide.bs.modal":"modalHideHandler","submit .read_pass_form":"readPassFormSubmitHandler","shown.bs.popover .public_read_password":"getReadPass"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","proPublicClickHandler","modalHideHandler","readPassFormSubmitHandler","getReadPass"),this.template=_.template($("#dashboard_project_modal_permission").html()),this.render()},render:function(){""==this.$el.html()?this.$el=$(this.template(this.model.toJSON())):this.$el.html($(this.template(this.model.toJSON())).html()),this.getReadPass(!0);var t=new e({$el:this.$el,permissionUrl:this.model.url()+"/permission",dialog:this});this.permissionList=t,this.$el.find(".public_read_password").popover({html:!0,title:"공유 암호 설정",placement:"bottom",container:"#permissionModal",content:_.template($("#publicReadPasswordFormTemplate").html())}),this.delegateEvents(),this.$el.modal("show")},proPublicClickHandler:function(e){var t=$(e.currentTarget).find("input").attr("name"),s=$(e.currentTarget).find("input").get(0).checked,i=!s;$(e.currentTarget).toggleClass("btn-info",i),this.$el.find("input[name='"+t+"']").get(0).checked=i;var a=this.$el.find("input[name='pro_public_read']:checked").val()||"N";this.model.save({pro_public_read:a},{patch:!0}),this.$el.find(".public_read_password").toggle("Y"==a).popover("hide").removeClass("active")},modalHideHandler:function(){if(this.model.item){this.$el.find(".public_read_password").popover("hide");var e=this.model.item;this.model.set("shared_count",this.permissionList.collection.length),e.$el.find(".shared_list[data-toggle='tooltip']").tooltip("destroy"),e.render()}},getReadPass:function(e){var t=this;$.ajax({url:this.model.url()+"/publicReadPassword",type:"GET",success:function(s){!0===e&&s.pass?t.$el.find(".public_read_password").addClass("btn-success"):s.pass?t.$el.find("input[name='read_pass']").val(s.pass):t.$el.find("input[name='read_pass']").attr("placeholder","공유 암호를 입력하세요")}})},readPassFormSubmitHandler:function(e){e.preventDefault();var t=this.$el.find(".public_read_password"),s=this.$el.find("input[name='read_pass']"),i=$.trim(s.val()),a=/^[A-Za-z0-9`~!@#$%^&*\(\)_\-\+={}\[\]\|:;"'<>,.\?\/\\]{6,32}$/;return i.length&&!a.test(i)?(alert("6~32자의 영문 대/소문자,숫자,특수문자로 입력해주세요."),s.focus(),!1):($.ajax({url:this.model.url()+"/publicReadPassword",type:"POST",data:{read_pass:i},success:function(e){t.popover("hide"),i.length?t.addClass("btn-success"):t.removeClass("btn-success"),t.removeClass("active")}}),!1)}});Oven.Project=Oven.Project||{},Oven.Project.PermissionDialog=t});$(function(){var e=Backbone.View.extend({events:{},initialize:function(e){_.extend(this,e),_.bindAll(this,"render"),this.template=_.template($("#qrDialogTemplate").html()),this.render()},render:function(){var e=this,t={qrUrl:"/api/qr?pro="+this.pro_id+(this.seq_id?"&seq="+this.seq_id:""),shortUrl:location.origin+this.url};""==this.$el.html()?this.$el=$(this.template(t)):this.$el.html($(this.template(t)).html()),this.delegateEvents(),e.$el.modal("show")}});Oven.Dialog=Oven.Dialog||{},Oven.Dialog.QR=e});$(function(){var e=Backbone.View.extend({events:{},initialize:function(e){_.extend(this,e),_.bindAll(this,"render"),this.template=_.template($("#aboutOvenDialogTemplate").html()),this.render()},render:function(){""==this.$el.html()?this.$el=$(this.template()):this.$el.html($(this.template()).html()),this.delegateEvents(),this.$el.modal("show")}});Oven.Dialog=Oven.Dialog||{},Oven.Dialog.About=e});$(function(){var t=Backbone.View.extend({events:{},initialize:function(t){_.extend(this,t),_.bindAll(this,"render"),this.template=_.template($("#shortcutDialogTemplate").html()),this.render()},render:function(){""==this.$el.html()?this.$el=$(this.template()):this.$el.html($(this.template()).html()),this.delegateEvents(),this.$el.modal("show")}});Oven.Dialog=Oven.Dialog||{},Oven.Dialog.Shortcut=t});$(function(){var e=Oven.Translation,t=Backbone.View.extend({events:{"submit form":"submitForm"},initialize:function(t){_.extend(this,t),_.bindAll(this,"render"),this.template=_.template($("#bugDialogTemplate").html()),this.translation=new e({locale:loggedUser.locale}),this.render()},render:function(){var e={location:location.href,email:loggedUser.email||"",ua:navigator.userAgent};""==this.$el.html()?this.$el=$(this.template(e)):this.$el.html($(this.template(e)).html()),this.delegateEvents(),this.$el.modal("show")},submitForm:function(e){e.preventDefault();var t=this,r=this.$el.find("form"),i={report_text:$.trim(r.find("[name='report_text']").val()),report_url:$.trim(r.find("[name='report_url']").val()),report_email:$.trim(r.find("[name='report_email']").val()),report_ua:r.find("[name='report_ua']:checked").length>0?navigator.userAgent:"",report_file:r.find("[name='report_file']").get(0).files?r.find("[name='report_file']").get(0).files[0]:void 0};if(i.report_text.length<1)return r.find("[name='report_text']").focus(),!1;if(i.report_file&&i.report_file.size>1048576)return alert(this.translation.convert("Maximum filesize is limited to ")+"1MB"),!1;if(i.report_file&&"image/png"!=i.report_file.type.toLowerCase()&&"image/jpeg"!=i.report_file.type.toLowerCase()&&"image/gif"!=i.report_file.type.toLowerCase())return alert(this.translation.convert("You can upload JPG, PNG or GIF files only.")),!1;var n=new FormData;return n.append("report_text",i.report_text),n.append("report_url",i.report_url),n.append("report_email",i.report_email),n.append("report_ua",i.report_ua),n.append("report_file",i.report_file),this.$el.find("button[type='submit']").addClass("disabled").find(".msg").html(this.translation.convert("Sending..")),$.ajax({url:"/api/reportBug",type:"POST",data:n,processData:!1,contentType:!1,success:function(e){t.$el.find(".modal-content").html($("#bugSentMessageTemplate").html())},error:function(e){return t.$el.find("button[type='submit']").removeClass("disabled").find(".msg").html(t.translation.convert("Send")),alert(t.translation.convert("Cannot perform action due to an error.")),!1}}),!1},stopPropagation:function(e){e.stopPropagation()}});Oven.Dialog=Oven.Dialog||{},Oven.Dialog.Bug=t});$(function(){var e=Backbone.View.extend({tagName:"a",events:{click:"select"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","setScrollPosition")},render:function(){return this.$el.attr("href","javascript:;").addClass("list-group-item").html(this.index+1+". "+this.model.get("seq_name")),"page"===this.dialog.modelJSON.linkMode&&this.dialog.modelJSON.linkTo==this.model.id?(this.$el.append("<span class='glyphicon glyphicon-link pull-right'></span>"),this.select()):"page"!==this.dialog.modelJSON.linkMode&&this.dialog.modelJSON.canvasSequenceId==this.model.id&&this.select(),this},setScrollPosition:function(){var e=this.$el.parent().scrollTop()+this.$el.position().top;this.$el.parent().stop().animate({scrollTop:e-50})},select:function(){this.dialog.selectedSequence&&this.dialog.selectedSequence.unselect(),this.dialog.selectedSequence=this,this.$el.addClass("active");var e=this.model.item.$el.find(".sequence_thumbnail img");this.dialog.$el.find("#linkSequencePreview").attr({src:e.attr("src")})},unselect:function(){this.$el.removeClass("active"),delete this.dialog.selectedSequence}}),t=Backbone.View.extend({events:{"click .apply_link":"applyLinkClickHandler","click [data-link-mode='page']:not(.active)":"setPageScrollPosition"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","appendSequence","applyLinkClickHandler","setModel","freeStack"),this.template=_.template($("#linkDialogTemplate").html()),this.sequenceStack=[],this.render(),this.delegateEvents()},setModel:function(){var e=this.canvas.selectCollection.where({cvsobj_locked:!1})[0].get("cvsobj_el"),t=e.attr("data-link-to"),i=!1,l=null,n="none";t&&0===t.indexOf("page:")?(n="page",l=t.replace(/^page\:/,"")):t&&0===t.indexOf("url:")&&(n="url",i=0===t.indexOf("url:@"),l=t.replace(/^url\:/,"")),this.modelJSON={linkMode:n,isExternal:i,linkTo:i?l.replace(/^\@/,""):l,canvasSequenceId:this.canvas.editor.builder.sequenceList.selectedItem.model.id}},freeStack:function(){delete this.selectedSequence,this.sequenceStack.forEach(function(e){delete e.dialog}),this.sequenceStack.length=0},render:function(){this.setModel(),""===this.$el.html()?this.$el=$(this.template(this.modelJSON)):this.$el.html($(this.template(this.modelJSON)).html()),this.freeStack(),this.canvas.editor.builder.sequenceList.collection.each(this.appendSequence),this.$el.modal("show"),this.setPageScrollPosition()},setPageScrollPosition:function(){var e=this;setTimeout(function(){e.selectedSequence.setScrollPosition()},150)},appendSequence:function(t,i){var l=new e({model:t,index:i,dialog:this});this.sequenceStack.push(l),this.$el.find(".list-group").append(l.render().$el)},stopPropagation:function(e){e.stopPropagation()},applyLinkClickHandler:function(){var e,t=this,i=this.$el.find(".nav-tabs .active").attr("data-link-mode"),l=this.canvas.selectCollection.where({cvsobj_locked:!1})[0].get("cvsobj_el");switch(i){case"none":l.removeAttr("data-link-to");break;case"page":e=this.selectedSequence.model.id,l.attr("data-link-to","page:"+e);break;case"url":if(e=this.$el.find("input#linkUrlValue").val(),!0!==/^https?:\/\/([a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+.*)$/.test(e))return alert(t.canvas.editor.builder.translation.convert("URL is invalid.")),this.$el.find("input#linkUrlValue").focus(),!1;e=encodeURIComponent(e),l.attr("data-link-to","url:"+(this.$el.find("input[name='isNewWindow']:checked").length>0?"@":"")+e)}this.canvas.editor.saveContent(),this.$el.modal("hide")}});Oven.Dialog=Oven.Dialog||{},Oven.Dialog.Link=t});$(function(){var t=Backbone.View.extend({events:{},initialize:function(t){_.extend(this,t),_.bindAll(this,"render"),this.template=_.template($("#objectDialogTemplate").html()),this.render()},render:function(){""==this.$el.html()?this.$el=$(this.template(this.model.toJSON())):this.$el.html($(this.template(this.model.toJSON())).html()),this.delegateEvents();var t=this;this.model.item.getWrappedObject({left:20,top:20},function(e){t.$el.find(".obj_preview").append(e),t.$el.modal("show")})},stopPropagation:function(t){t.stopPropagation()}});Oven.Dialog=Oven.Dialog||{},Oven.Dialog.Object=t});$(function(){var t=function(t){return _.extend(this,t),this.editor=this.model.item.list.builder.editor,this.stack=t.stack||[],this.maximumStackLength=25,this.currentIndex=t.currentIndex||0,this.undo=function(){return this.currentIndex==this.stack.length-1?null:this.stack[++this.currentIndex]},this.redo=function(){return this.currentIndex<1?null:this.stack[--this.currentIndex]},this.add=function(t){this.currentIndex>0&&(this.stack.splice(0,this.currentIndex),this.currentIndex=0),this.stack.unshift(t),this.stack.length>this.maximumStackLength&&this.stack.splice(this.stack.length-1,1)},this};Oven.Sequence=Oven.Sequence||{},Oven.Sequence.History=t});$(function(){var e=Backbone.Model.extend({idAttribute:"seq_id",defaults:{pro_id:"",seq_name:"",seq_order:0,seq_screen_width:0,seq_screen_height:0,seq_background:"#FFFFFF",seq_content:"",user_id:"",seq_modidate:"",seq_regidate:"",_thumbnail:!1,_isModified:!1}});Oven.Sequence=Oven.Sequence||{},Oven.Sequence.Model=e});$(function(){var e=Oven.Sequence.Model,n=Backbone.Collection.extend({model:e,url:"/api/projects/",initialize:function(e){_.extend(this,e),this.url+=this.pro_id+"/sequences"}});Oven.Sequence=Oven.Sequence||{},Oven.Sequence.Collection=n});$(function(){var e=new Oven.Util,t=Oven.Sequence.History,i=Backbone.View.extend({tagName:"li",events:{click:"goPage","click .seq_name":"renameClickHandler","click .seq_name_input":"stopPropagation","submit .form_rename":"renameSequence","keydown .form_rename input":"renameKeydownHandler",contextmenu:"contextmenuHandler"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","thumbnailRenderedHandler","saveThumbnail","drawThumbnail","destroySequence","destroyHandler","goPage","loadSequence","modifiedHandler","modidateChangeHandler","duplicateSequence","renameClickHandler","focusRenameInput","toggleSelected","contextmenuHandler","insertSequence","renameSequence","changeSequenceWidth","getThumbnail","historyCalledHandler","sequenceChangeHandler","saveSequence","changeAllOtherBackground","exportSequenceAsJPG","exportSequence","exportSequenceAsPNG","exportSequenceAsPDF","exportSequenceAsPDFwithMemo","webviewSequence","getWebviewURL","renameKeydownHandler"),this.template=_.template($("#sequenceItemTemplate").html()),this.model.item=this,this.model.history=new t({model:this.model,stack:[_.pick(this.model.toJSON(),"seq_name","seq_screen_width","seq_screen_height","seq_background","seq_content")]}),this.model.on({destroy:this.destroyHandler,"change:_isModified":this.modifiedHandler,"change:_thumbnail":this.thumbnailRenderedHandler,"change:seq_modidate":this.modidateChangeHandler,"change:seq_name change:seq_screen_width change:seq_screen_height change:seq_background change:seq_content":this.sequenceChangeHandler,historyCalled:this.historyCalledHandler}),null===this.model.get("_seq_content")&&this.model.unset("_seq_content"),null===this.model.get("_seq_background")&&this.model.unset("_seq_background"),null===this.model.get("_seq_screen_width")&&this.model.unset("_seq_screen_width"),null===this.model.get("_seq_screen_height")&&this.model.unset("_seq_screen_height")},render:function(){var e=this.model.toJSON();return this.$el.attr("title",this.list.builder.translation.convert("Right-click to show menu")),this.$el.html(this.template(e)),this.getThumbnail(),this.$el.addClass("item"),this.modifiedHandler(),this},getThumbnail:function(){var t=this.model.get("seq_screen_width")||this.list.builder.projectModel.get("pro_screen"),i=e.makeThumbnail({projectId:this.list.builder.projectModel.id,seqId:this.model.id,model:this.model,screenWidth:t,screenHeight:this.model.get("seq_screen_height")||(640==t?360:700),background:this.model.get("seq_background")||"#fff",thumbnail:this.$el.find(".sequence_thumbnail"),content:this.model.get("seq_content"),modidate:this.model.get("seq_modidate")},this.drawThumbnail);i&&i.data&&this.drawThumbnail(i)},drawThumbnail:function(e){var t=this.$el.find(".sequence_thumbnail"),i=$(document.createElement("img"));i.attr({src:e.data,width:e.w/2,height:e.h/2}),void 0!==this.model.changedAttributes().seq_content?(i.css({display:"none",position:"absolute",top:0,left:0}),t.find("img").fadeOut(function(){$(this).remove()}),t.append(i),i.fadeIn(200)):t.html(i),this.model.get("_thumbnail")||this.saveThumbnail(e.data),this.model.set("_thumbnail",!0)},saveThumbnail:function(e){if(!this.model.id||!this.model.get("seq_modidate"))return!1;var t=this.list.builder.projectModel.id+":"+this.model.id,i=e||this.$el.find(".sequence_thumbnail > img").attr("src");try{window.localStorage.setItem(t,this.model.get("seq_modidate")+"_"+i)}catch(e){window.localStorage.clear()}},destroySequence:function(){var e=this;if(!confirm(this.list.builder.translation.convert("Are you sure to delete?")+"\n"+this.list.builder.translation.convert("(You cannot recover the removed pages.)")))return!1;this.model.destroy({wait:!0,dataType:"text",error:function(t,i){401==i.status||403==i.status?e.list.builder.showLoginDialog(function(){e.destroySequence()}):alert("오류로 인해 실행할 수 없습니다. 잠시 후에 다시 시도해주세요.")}})},thumbnailRenderedHandler:function(){if(!this.list.isOnLoading)return!0;this.list.progressLoading(1)},goPage:function(){location.hash=this.model.id},loadSequence:function(){if(this.list.selectedItem===this)return null;this.list.builder.editor.loadModel(this.model),this.setScrollPosition(),this.toggleSelected()},insertSequence:function(){this.list.appendSequence()},duplicateSequence:function(){this.list.addSequence(this.model)},renameClickHandler:function(e){if(this.list.selectedItem!==this)return null;e&&e.stopPropagation&&e.stopPropagation(),this.focusRenameInput()},focusRenameInput:function(){this.$el.find(".seq_name").hide(),this.$el.find(".form_rename").show().find("input").val(e.decodeHtml(this.model.get("seq_name"))).focus(),this.list.builder.$el.one("click",this.renameSequence)},renderRenameInput:function(){this.$el.find(".form_rename").hide().find("input").val(""),this.$el.find(".seq_name").show().find(".ellipsis").html(this.model.get("seq_name")),this.list.builder.$el.off("click",this.renameSequence)},renameSequence:function(){var t=this.$el.find(".seq_name_input"),i=$.trim(t.val());return""==i?(this.renderRenameInput(),!1):(this.model.get("seq_name")!==i&&this.model.set({seq_name:e.encodeHtml(i)}),this.renderRenameInput(),!1)},renameKeydownHandler:function(e){if(9==e.which){this.renameSequence();var t=this.list.collection.where({seq_order:parseInt(this.model.get("seq_order"))+(e.shiftKey?-1:1)});t.length>0&&(t[0].item.goPage(),setTimeout(t[0].item.renameClickHandler,20))}},saveSequence:function(){var e=this;this.model.save({seq_name:this.model.get("seq_name"),seq_screen_width:this.model.get("seq_screen_width"),seq_screen_height:this.model.get("seq_screen_height"),seq_background:this.model.get("seq_background"),seq_content:this.model.get("seq_content")},{patch:!0,success:function(e){e.set({_isModified:!1})},error:function(t,i){401==i.status||403==i.status?e.list.builder.showLoginDialog(function(){e.list.builder.topmenu.menubar.pageMenu.saveAll()}):alert("오류로 인해 실행할 수 없습니다. 잠시 후에 다시 시도해주세요.")}})},changeSequenceWidth:function(e){this.model.set({seq_screen_width:parseInt($(e.currentTarget).attr("data-width"))})},modifiedHandler:function(){var e=1==this.model.get("_isModified");this.$el.toggleClass("modified",e),this.list.builder.editor.canvas.function.toggleSaveButton()},modidateChangeHandler:function(){if(this.saveThumbnail(),this.list.selectedItem!==this||!this.list.builder.editor)return!1;var e=moment(this.model.get("seq_modidate")).calendar();this.list.builder.$el.find("#sequenceModidate").html(e);var t=this.list.builder.$el.find(".saved_time");t.addClass("changed"),setTimeout(function(){t.removeClass("changed")},250)},historyCalledHandler:function(e){var t=this.model.changedAttributes(),i=this.list.selectedItem===this&&void 0!==this.list.builder.editor;this.model.set("_isModified",!0),void 0!==t.seq_name&&this.renderRenameInput(),void 0!==t.seq_screen_width&&i&&(this.list.builder.editor.canvas.applyScreenWidth(),this.list.builder.editor.canvas.applyScreenHeight()),void 0!==t.seq_screen_height&&i&&this.list.builder.editor.canvas.applyScreenHeight(),void 0!==t.seq_background&&i&&this.list.builder.editor.canvas.applyBackgroundColor(),!0===e&&void 0!==t.seq_content&&i&&this.list.builder.editor.canvas.$el.html(this.model.get("seq_content")),i&&this.list.builder.editor.canvas.function.toggleHistoryButton(),this.getThumbnail()},destroyHandler:function(){var e=this;this.list.builder.editor.model==this.model&&(this.list.builder.editor.initialize(),this.list.builder.topmenu.quickbar.initialize()),this.$el.addClass("deleted"),this.$el.unbind().slideUp(250,function(){this.remove()}),this.list.selectedItem=void 0;var t=this.list.collection.where({seq_order:parseInt(this.model.get("seq_order"))+1});t.length>0?setTimeout(function(){t[0].item.goPage(),delete e.list},150):e.list.collection.length>1?setTimeout(function(){e.list.collection.at(e.list.collection.length-1).item.goPage(),delete e.list},150):setTimeout(function(){e.list.addSequence(),delete e.list},150)},exportSequence:function(t,i){if(this.model.get("_isModified")&&!confirm(this.list.builder.translation.convert("This page has been modified but not saved. Do you wish to continue?")))return!1;var s=this.model.get("seq_screen_width")||this.list.builder.projectModel.get("pro_screen"),n=640!=s||this.model.get("seq_screen_height")?this.model.get("seq_screen_height")||600:360;e.ajaxDownload({url:"/api/export/"+this.list.builder.projectModel.id,method:"POST",frameName:"_exportFrame",data:{type:t,pro_title:this.list.builder.projectModel.get("pro_title"),pro_id:this.list.builder.projectModel.id,seq_id:this.model.id,seq_name:this.model.get("seq_name"),screen_width:s,screen_height:n,withMemo:!0===i}})},exportSequenceAsPNG:function(){this.exportSequence("png")},exportSequenceAsJPG:function(){this.exportSequence("jpg")},exportSequenceAsPDF:function(){this.exportSequence("pdf")},exportSequenceAsPDFwithMemo:function(){this.exportSequence("pdf",!0)},getWebviewURL:function(){return"/view/"+this.list.builder.pro_id+"/"+this.model.id},webviewSequence:function(){if(this.model.get("_isModified")&&!confirm(this.list.builder.translation.convert("This page has been modified but not saved. Do you wish to continue?")))return!1;var e=this.model.get("seq_screen_width")||this.list.builder.projectModel.get("pro_screen"),t=640!=e||this.model.get("seq_screen_height")?this.model.get("seq_screen_height")||600:360;window.open(this.getWebviewURL(),"_blank","resizable=yes, width="+e+", height="+t)},sequenceChangeHandler:function(){var e=_.pick(this.model.toJSON(),"seq_name","seq_screen_width","seq_screen_height","seq_background","seq_content");this.model.history.add(e),this.historyCalledHandler()},changeAllOtherBackground:function(){var e=this.model.get("seq_background");this.list.collection.each(function(t){t.set({seq_background:e})})},toggleSelected:function(){if(this.list.selectedItem==this)return!1;void 0!==this.list.selectedItem&&this.list.selectedItem.$el.removeClass("selected"),this.list.selectedItem=this,this.list.selectedItem.$el.addClass("selected")},setScrollPosition:function(){var e,t=this.$el.position().top,i=this.list.$el.find("#seqList").scrollTop();if(t<0?e=i+this.$el.position().top:t>this.list.$el.find("#seqList").height()-this.$el.height()&&(e=i+this.$el.position().top-(this.list.$el.find("#seqList").height()-this.$el.height())),void 0===e)return!1;this.list.$el.find("#seqList").stop().animate({scrollTop:e})},contextmenuHandler:function(e){e.stopPropagation(),e.preventDefault(),this.setScrollPosition(),this.list.selectedItem!==this&&this.goPage(),this.list.builder.contextmenu.initialize({e:e,caller:this,callerType:"sequenceItem",callerModel:this.model.toJSON(),callerEvents:{"click .rename_sequence":this.renameClickHandler,"click .change_width:not(.checked)":this.changeSequenceWidth,"click .delete_sequence":this.destroySequence,"click .duplicate_sequence":this.duplicateSequence,"click .insert_new_sequence":this.insertSequence,"click .export_sequence_png":this.exportSequenceAsPNG,"click .export_sequence_jpg":this.exportSequenceAsJPG,"click .export_sequence_pdf":this.exportSequenceAsPDF,"click .export_sequence_pdfmemo":this.exportSequenceAsPDFwithMemo,"click .webview_sequence":this.webviewSequence,"click .webview_qr":this.list.showWebviewQRDialog}})},stopPropagation:function(e){e.stopPropagation()}});Oven.Sequence=Oven.Sequence||{},Oven.Sequence.Item=i});$(function(){var e=new Oven.Util,t=Oven.Sequence.Collection,i=Oven.Sequence.Item,n=Oven.Dialog.QR,o=Backbone.View.extend({events:{click:"clickHandler","click #addSequence":"addSequence"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","appendItem","addSequence","clickHandler","appendSequence","findSkippedNumber","changeOrder","showWebviewQRDialog","progressLoading","finishLoading","moveSequence","toggleSequence","animateButton"),this.progressLoading(),this.template=_.template($("#sequenceListTemplate").html()),this.collection=new t({pro_id:this.builder.pro_id,comparator:"seq_order"}),this.collection.on({reset:this.render,add:this.appendItem,remove:this.changeOrder,duplicate:this.appendItem}),this.collection.fetch({reset:!0}),this.$el.html(this.template())},render:function(){var e=this;this.$el.find("#seqList").html(""),this.collection.each(function(t){e.appendItem(t,!0)}),this.makeSortable(),this.setListRouter()},appendItem:function(e,t){var n=e.get("seq_order")%1>0,o=new i({model:e,list:this});if(n&&o.$el.hide(),n){var r=parseInt(e.get("seq_order"));this.$el.find("#seqList").children().eq(r).after(o.render().el),o.$el.addClass("created transition"),o.$el.slideDown(250,function(){o.$el.removeClass("created"),setTimeout(function(){o.$el.removeClass("transition")},500)})}else this.$el.find("#seqList").append(o.render().el)},setListRouter:function(){var e=this,t=Backbone.Router.extend({routes:{":seq_id":"defaultRoute"},defaultRoute:function(t){var i=e.collection.get(t);void 0!==i?i.item.loadSequence():e.collection.at(0).item.goPage()}});new t;Backbone.history.start();var i=location.hash;""!=i&&"#"!=i||this.collection.at(0).item.goPage()},progressLoading:function(e){if(!this.isOnLoading){var t=$($("#builderLoadingTemplate").html());return this.builder.$el.append(t),this.isOnLoading=!0,this.renderedSequence=0,!1}var t=this.builder.$el.find("#sequenceLoading"),i=this.collection.length;this.renderedSequence+=e;var n=parseInt(100*this.renderedSequence/i);t.find(".progress-bar").css({width:n+"%"}).children("span").html(n+"%"),i==this.renderedSequence&&this.finishLoading()},finishLoading:function(){delete this.isOnLoading,delete this.renderedSequence;var e=this.builder.$el.find("#sequenceLoading");e.find("strong").html("<span class='glyphicon glyphicon-ok'></span>"),e.addClass("done"),setTimeout(function(){e.addClass("out").fadeOut(500,function(){$(this).remove()})},100)},findSkippedNumber:function(e){var t=[],i="^"+e+"$|^"+e+"\\s(\\d+)$",n=new RegExp(i);if(this.collection.each(function(e){var i=e.get("seq_name");"Untitled"==i?t.push(1):n.test(i)&&t.push(parseInt(i.replace("Untitled ","")))}),t.sort(function(e,t){return e-t}),!t.length)return 1;for(var o=void 0,r=0;r<t.length;r++)if(r+1!=t[r]){o=r;break}return void 0!==o?o+1:t.length+1},appendSequence:function(){this.addSequence(this.selectedItem.model.get("seq_order"))},addSequence:function(e){var t,i=this,n=e&&e.id,o=!n&&"number"==typeof e;if(n)t={seq_name:("Copy of "+e.get("seq_name")).substring(0,64),seq_order:parseInt(e.get("seq_order"))+.5,seq_screen_width:e.get("seq_screen_width"),seq_screen_height:e.get("seq_screen_height"),seq_background:e.get("seq_background"),seq_content:e.get("seq_content")};else{var r=this.findSkippedNumber("Untitled");t={seq_name:1===r?"Untitled":"Untitled "+r,seq_order:o?parseInt(e)+.5:this.collection.length}}this.collection.create(t,{success:function(e){i.changeOrder(),e.item.goPage()},error:function(e,t){e.destroy(),401==t.status||403==t.status?i.builder.showLoginDialog():alert("오류로 인해 실행할 수 없습니다. 잠시 후에 다시 시도해주세요.")}}),this.animateButton(e)},animateButton:function(e){if(e.currentTarget){var t=$(e.currentTarget);0===t.find(".ripple_water").length&&t.prepend("<div class='ripple_water'><span class='ink'></span></div>");var i=t.find(".ripple_water"),n=i.find(".ink");if(n.removeClass("animate"),!n.height()&&!n.width()){var o=Math.max(i.outerWidth(),i.outerHeight());n.css({height:o,width:o})}var r=e.pageX-i.offset().left-n.width()/2,s=e.pageY-i.offset().top-n.height()/2;n.css({top:s+"px",left:r+"px"}).addClass("animate")}},makeSortable:function(){var e=this,t=e.$el.find("#seqList");this.$el.find("#seqList").sortable({axis:"y",containment:"parent",placeholder:"ui-state-highlight",revert:300,opacity:.75,helper:"clone",distance:35,tolerance:"pointer",sort:function(e,i){$(window).height()-i.offset.top<200&&t.scrollTop(t.scrollTop()+15),i.offset.top<200&&t.scrollTop(t.scrollTop()-15)},stop:function(t,i){e.changeOrder()}})},changeOrder:function(){var e=this,t=this.$el.find("#seqList").children(":not(.deleted)"),i=this.collection.where({seq_id:void 0});if(t.length<1||i.length>0)return!1;this.collection.each(function(e){e.set({seq_order:t.index(e.item.$el)})}),this.collection.sort();var n=this.collection.pluck("seq_id").join(",");$.ajax({url:this.collection.url+"Reorder",type:"POST",data:{reorder:n},error:function(t){401==t.status||403==t.status?e.builder.showLoginDialog(function(){e.changeOrder()}):alert("오류로 인해 실행할 수 없습니다. 잠시 후에 다시 시도해주세요.")}})},proScreenChangeHandler:function(){var e=this;this.collection.each(function(t){t.item.getThumbnail(),e.selectedItem==t.item&&e.builder.editor.canvas.applyScreenWidth()})},showWebviewQRDialog:function(){var e={url:this.selectedItem.getWebviewURL(),pro_id:this.builder.pro_id,seq_id:this.selectedItem.model.id};this.qrDialog?this.qrDialog.initialize(e):this.qrDialog=new n(e)},moveSequence:function(e){var t=parseInt(this.selectedItem.model.get("seq_order")),i=this.collection.findWhere({seq_order:t+e});i&&i.item.goPage()},clickHandler:function(){this.builder.$el.find("#builder").hasClass("hide_sequence")&&this.toggleSequence()},toggleSequence:function(e){e&&e.stopPropagation(),this.builder.$el.find("#builder").toggleClass("hide_sequence"),this.builder.topmenu.menubar.$el.find(".toggle_sequence").toggleClass("hidden")},exportProject:function(t,i,n,o){e.ajaxDownload({useWaitConfirm:!0,url:"/api/export/"+this.builder.projectModel.id,method:"POST",frameName:"_exportFrame",data:{type:t,index:i,postfix:n,withMemo:!0===o,pro_title:this.builder.projectModel.get("pro_title"),pro_screen:this.builder.projectModel.get("pro_screen")}})},exportAllpageAsPDF:function(t){e.ajaxDownload({useWaitConfirm:!0,url:"/api/exportAllPage/"+this.builder.projectModel.id,method:"POST",frameName:"_exportFrame",data:{pro_title:this.builder.projectModel.get("pro_title"),pro_screen:this.builder.projectModel.get("pro_screen"),withMemo:!0===t}})},exportProjectAsPNG:function(e,t){this.exportProject("png",e,t)},exportProjectAsJPG:function(e,t){this.exportProject("jpg",e,t)},exportProjectAsPDF:function(e,t,i){this.exportProject("pdf",e,t,i)}});Oven.Sequence=Oven.Sequence||{},Oven.Sequence.List=o});$(function(){var e=Backbone.Model.extend({defaults:{bold:!1,italic:!1,underline:!1,strikeThrough:!1,foreColor:"",backColor:""}}),t=Backbone.View.extend({events:{mousedown:"stopPropagation",mouseup:"stopPropagation","mousedown a[data-command]":"commandClickHandler","mouseenter > a":"hasSubMouseEnterHandler","mousedown .sub":"stopPropagation","click .palette .cell":"paletteClickHandler"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","setModel","launchPopup"),this.template=_.template($("#selectionPopupTemplate").html())},launchPopup:function(){if(this.selection=this.getSelection(),!this.selection)return!1;this.model=this.model||new e,this.delegateEvents(),this.render();var t=this.textEditor.canvas.editor.builder.topmenu;t&&t.quickbar.renderDynamicQuickbar()},setModel:function(){this.model.set({bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikeThrough:document.queryCommandState("strikeThrough"),foreColor:document.queryCommandValue("foreColor"),backColor:document.queryCommandValue("backColor")})},render:function(){if(this.setModel(),!this.selection)return!1;this.$el.html(this.template(this.model.toJSON())),this.$el.addClass("selection_popup");var e=$(".canvas_wrapper");this.$el.hide(),this.$el.css({top:this.selection.boundary.top-e.offset().top+e.scrollTop(),left:this.selection.boundary.left-e.offset().left+e.scrollLeft()+this.selection.boundary.width/2}),this.makePalette(),e.append(this.$el),this.$el.fadeIn(100)},remove:function(){this.$el.fadeOut(100,function(){$(this).remove()})},commandClickHandler:function(e){var t,o=$(e.currentTarget).attr("data-command");"fontSize"===o?(t=parseInt(document.queryCommandValue("fontSize")||3)+parseInt($(e.currentTarget).attr("data-arg")),t>0&&t<8&&document.execCommand("styleWithCSS"),document.execCommand(o,!1,t),this.textEditor.scrollHandler()):(document.execCommand("styleWithCSS"),document.execCommand(o),$(e.currentTarget).toggleClass("on")),this.setModel()},getSelection:function(){var e,t,o,n,a,i="";if(void 0!==window.getSelection){if(t=window.getSelection(),t.rangeCount){o=document.createElement("div");for(var r=0,s=t.rangeCount;r<s;++r)o.appendChild(t.getRangeAt(r).cloneContents());e=t.focusNode.parentNode,i=o.innerHTML}"undefined"!=i&&""!=i&&null!=i&&(n=t.getRangeAt(0),a=n.getBoundingClientRect())}return a&&e&&$.trim(t.toString()).length?{targetNode:e,boundary:a}:null},makePalette:function(){this.$el.find("[data-colorpicker='true']").each(function(){$(this).hide();var e=$(document.createElement("div"));e.addClass("palette"),["#1abc9c","#16a085","#ffffff","#2ecc71","#27ae60","#E0E0E0","#3498db","#2980b9","#BEBEBE","#9b59b6","#8e44ad","#9E9E9E","#34495e","#2c3e50","#7F7F7F","#f1c40f","#f39c12","#5E5E5E","#e67e22","#d35400","#404040","#e74c3c","#c0392b","#212121","#95a5a6","#7f8c8d","#000000"].forEach(function(t){var o=$(document.createElement("div"));o.addClass("cell").css({backgroundColor:t}),e.append(o)}),$(this).after(e)})},paletteClickHandler:function(e){var t=$(e.currentTarget).parent().prev("input").attr("data-command"),o=$(e.currentTarget).css("backgroundColor");document.execCommand("styleWithCSS"),document.execCommand(t,!1,o),this.$el.find("[data-preview-color='"+t+"']").css({backgroundColor:o}),this.setModel()},stopPropagation:function(e){return e.stopPropagation(),!1},hasSubMouseEnterHandler:function(e){if(void 0!==this.selectedSubmenu&&(this.selectedSubmenu.prev(".on").removeClass("on"),this.selectedSubmenu.hide().removeClass("sub_on"),this.selectedSubmenu=void 0),!$(e.currentTarget).hasClass("has_sub"))return!1;$(e.currentTarget).addClass("on"),this.selectedSubmenu=$(e.currentTarget).next(".sub"),this.selectedSubmenu.fadeIn(100).addClass("sub_on")}}),o=Backbone.View.extend({initialize:function(e){void 0!==this.target&&this.remove(),_.extend(this,e),_.bindAll(this,"render","remove","mouseupHandler","mousedownHandler","keydownHandler","scrollHandler"),this.selectionPopup=this.selectionPopup||new t({textEditor:this}),this.target&&(this.canvas.selectCollection.remove(this.canvas.selectCollection.models),this.canvas.selectHandler(),this.render())},render:function(){var e=this;this.target.parent("[data-text-editable]").addClass("on_edit"),this.target.attr({contenteditable:"true",spellcheck:"false"}),setTimeout(function(){e.target.addClass("show").focus(),document.execCommand("selectAll",!1,null)},10),this.target.on("scroll",this.scrollHandler),this.target.on("keydown",this.keydownHandler),this.target.on("mouseup",this.mouseupHandler),this.target.on("mousedown",this.mousedownHandler),$("body").one("mousedown",this.remove)},remove:function(e){var t=this.target;this.target.blur(),this.target.parent("[data-text-editable]").removeClass("on_edit"),this.target.removeClass("show"),setTimeout(function(){t.removeAttr("contenteditable spellcheck")},200),this.target.off("scroll",this.scrollHandler),this.target.off("keydown",this.keydownHandler),this.target.off("mousedown",this.mousedownHandler),this.target.off("mouseup",this.mouseupHandler),$("body").off("mousedown",this.remove),this.selectionPopup.remove(),this.canvas.editor.builder.topmenu.quickbar.renderDynamicQuickbar();var o=this.target.prop("tagName").toLowerCase();"input"==o?this.target.attr("value",this.target.get(0).value):"textarea"==o&&this.target.text(this.target.get(0).value),this.canvas.editor.saveContent(),delete this.target},mousedownHandler:function(e){e.stopPropagation(),this.selectionPopup.remove()},mouseupHandler:function(){var e=this;setTimeout(function(){e.selectionPopup.launchPopup(),$(window.getSelection().focusNode).parents("table").length>0&&e.canvas.editor.builder.topmenu.quickbar.initTableQuickbar()},30)},keydownHandler:function(e){this.selectionPopup.remove(),(e.ctrlKey||e.metaKey)&&13==e.which&&this.remove()},scrollHandler:function(){var e=this.target.parent("[data-text-editable]"),t=this.target.prop("scrollHeight");if(e>t)return!1;this.target.parent("[data-text-editable]").height(t)}});Oven.Editor=Oven.Editor||{},Oven.Editor.Canvas=Oven.Editor.Canvas||{},Oven.Editor.Canvas.TextEditor=o});$(function(){var e=Backbone.Model.extend({idAttribute:"cvsobj_id",defaults:{cvsobj_type:"",cvsobj_el:{}}}),o=Backbone.Collection.extend({model:e});Oven.Editor.Canvas=Oven.Editor.Canvas||{},Oven.Editor.Canvas.ObjectCollection=o,Oven.Editor.Canvas.ObjectModel=e});$(function(){var e=Oven.Editor.Canvas.ObjectModel,t=Oven.Dialog.Link,o=function(o){var n=o.canvas,l={_releasedGroupArray:[],_sendToClipboard:function(e){n.editor.clipboard=$.extend(!0,[],e)},_paste:function(t,o,l){if(t.length<1)return!1;var c=[],i="event"==o&&l?{top:n.editor.builder.contextmenu.$el.offset().top-n.$el.offset().top-10,left:n.editor.builder.contextmenu.$el.offset().left-n.$el.offset().left-10}:void 0,s=i&&t[0]?{top:parseInt(t[0].get("cvsobj_el").css("top")),left:parseInt(t[0].get("cvsobj_el").css("left"))}:{top:0,left:0};t.forEach(function(t){n.collectionRemoveHandler(t);var l=t.get("cvsobj_el"),r=l.clone(),a=n.editor.builder.makeId();if("event"==o)r.css({top:i.top+(parseInt(l.css("top"))-s.top),left:i.left+(parseInt(l.css("left"))-s.left)}),r.removeAttr("data-sync-obj-id");else if("duplicate"==o)r.css({top:parseInt(l.css("top"))+15,left:parseInt(l.css("left"))+15}),r.removeAttr("data-sync-obj-id");else if("sync"==o)r.attr({"data-sync-obj-id":r.attr("data-sync-obj-id")||r.attr("data-obj-id")});else{for(var d,f=n.$el.find("[data-obj-id]"),u=0,v=f.length;u<v;u++)d=$(f[u]),d.text()==r.text()&&d.css("left")==r.css("left")&&d.css("top")==r.css("top")&&r.css({top:parseInt(d.css("top"))+15,left:parseInt(d.css("left"))+15});r.removeAttr("data-sync-obj-id")}r.attr({"data-obj-id":a}),r.find("[data-obj-id]").each(function(){$(this).attr({"data-obj-id":n.editor.builder.makeId()})}),n.$el.append(r);var p=new e({cvsobj_id:a,cvsobj_type:r.attr("data-obj-type"),cvsobj_locked:"true"==r.attr("data-obj-locked"),cvsobj_memo:"true"==r.attr("data-memo-content"),cvsobj_el:r});c.push(p)}),n.selectCollection.remove(n.selectCollection.models),n.selectCollection.add(c),n.selectHandler()},_getRecoupPosition:function(e){var t=parseFloat(e.css("left"),10);t=isNaN(t)?0:t;var o=parseFloat(e.css("top"),10);return o=isNaN(o)?0:o,{left:t,top:o}},_calculateLasso:function(e){var t={};return e.forEach(function(e,o){var n,c,i,s,r=e.get("cvsobj_el"),a=l._getRecoupPosition(r);0==o?(t.left=a.left,t.right=a.left+r.outerWidth(),t.top=a.top,t.bottom=a.top+r.outerHeight()):(n=a.left,c=a.left+r.outerWidth(),i=a.top,s=a.top+r.outerHeight(),t.left=n<t.left?n:t.left,t.right=c>t.right?c:t.right,t.top=i<t.top?i:t.top,t.bottom=s>t.bottom?s:t.bottom)}),t},_getFirstElementFromSelectCollection:function(){var e=void 0,t=void 0;return n.selectCollection.each(function(o){var l=o.get("cvsobj_el"),c=n.$el.children().index(l);(void 0===e||c<e)&&(e=c,t=o)}),t.get("cvsobj_el")||null},_getLastElementFromSelectCollection:function(){var e=void 0,t=void 0;return n.selectCollection.each(function(o){var l=o.get("cvsobj_el"),c=n.$el.children().index(l);(void 0===e||c>e)&&(e=c,t=o)}),t.get("cvsobj_el")||null},_getRightEdge:function(e){return e.get("cvsobj_el").position().left+e.get("cvsobj_el").width()},_getBottomEdge:function(e){return e.get("cvsobj_el").position().top+e.get("cvsobj_el").height()},_getRotateRadians:function(e){var t=window.getComputedStyle(e.get(0),null),o=t.getPropertyValue("-webkit-transform")||t.getPropertyValue("-moz-transform")||t.getPropertyValue("-ms-transform")||t.getPropertyValue("transform")||null;if(!o||"none"==o)return null;var n=o.split("(")[1];n=n.split(")")[0],n=n.split(",");var l=n[0],c=n[1];n[2],n[3];return Math.atan2(c,l)},cutObject:function(){var e=n.selectCollection.where({cvsobj_locked:!1});if(e.length<1)return!1;e.forEach(function(e){e.get("cvsobj_el").unbind().remove()}),l._sendToClipboard(e),n.selectCollection.remove(n.selectCollection.models),n.selectHandler(),n.editor.saveContent()},deleteObject:function(){var e=n.selectCollection.where({cvsobj_locked:!1});if(e.length<1)return!1;e.forEach(function(e){e.get("cvsobj_el").unbind().remove()}),n.selectCollection.remove(n.selectCollection.models),n.selectHandler(),n.editor.saveContent()},duplicateObject:function(){var e=n.selectCollection.where({cvsobj_locked:!1});if(e.length<1)return!1;l._paste(e,"duplicate"),n.editor.saveContent()},pasteClipboard_event:function(e){l._paste(n.editor.clipboard,"event",e),n.editor.saveContent()},pasteClipboard_sync:function(){l._paste(n.editor.clipboard,"sync"),n.editor.saveContent()},pasteClipboard:function(){l._paste(n.editor.clipboard,"fixed"),n.editor.saveContent()},copyToClipboard:function(){var e=n.selectCollection.where({cvsobj_locked:!1});if(e.length<1)return!1;l._sendToClipboard(e)},copyToTemplate:function(){var e=n.selectCollection.where({cvsobj_locked:!1});if(e.length<1)return!1;l._sendToClipboard(e)},makeGroup:function(){var e=n.selectCollection.where({cvsobj_locked:!1,cvsobj_memo:!1});if(e.length<2)return!1;var t=l._calculateLasso(e),o=$(document.createElement("div"));o.attr({"data-obj-type":"group","data-obj-id":n.editor.builder.makeId()}).css({position:"absolute",left:t.left+"px",top:t.top+"px",width:t.right-t.left+"px",height:t.bottom-t.top+"px"}),e.forEach(function(e){var c=e.get("cvsobj_el"),i=l._getRecoupPosition(c);c.css({left:i.left-t.left,top:i.top-t.top}),c.appendTo(o),n.destroyObjectDraggable({currentTarget:c})}),n.selectCollection.remove(n.selectCollection.models),n.$el.append(o),n.forceSelectObject({currentTarget:o}),n.selectHandler(),n.editor.saveContent()},destroyGroup:function(){var e=n.selectCollection.where({cvsobj_locked:!1})[0].get("cvsobj_el");if(!e||"group"!==e.attr("data-obj-type"))return!1;n.selectCollection.remove(n.selectCollection.models);var t=l._getRotateRadians(e),o=l._getRecoupPosition(e),c=e.children();c.each(function(){var e=l._getRecoupPosition($(this));l._getRotateRadians($(this));t&&$(this).css({}),$(this).css({left:e.left+o.left,top:e.top+o.top}),n.addToSelectCollection($(this))}),c.unwrap(),n.selectHandler(),n.editor.saveContent()},releaseGroup:function(e){if(!e||"group"!==e.attr("data-obj-type"))return!1;n.selectCollection.remove(n.selectCollection.models);var t=l._getRotateRadians(e),o=l._getRecoupPosition(e),c=e.children();c.each(function(){var n=l._getRecoupPosition($(this));l._getRotateRadians($(this));t&&$(this).css({}),$(this).css({left:n.left+o.left,top:n.top+o.top}).attr({"data-released-from-group":e.attr("data-obj-id")})}),c.unwrap()},fastenReleasedGroup:function(e){n.selectCollection.remove(n.selectCollection.models);var t=n.$el.find("[data-released-from-group$='"+e+"']");t.each(function(){$(this).removeAttr("data-released-from-group"),n.addToSelectCollection($(this))}),t.length>1&&l.makeGroup()},selectAll:function(){n.selectCollection.remove(n.selectCollection.models),n.$el.find("> [data-obj-type]").each(function(){n.addToSelectCollection($(this))}),n.selectHandler()},sendFront:function(){n.selectCollection.each(function(e){e.get("cvsobj_el").appendTo(n.$el)}),n.editor.saveContent()},sendForward:function(){var e=l._getLastElementFromSelectCollection().next();if(e.length<1)return!1;var t=$(document.createElement("div"));n.selectCollection.each(function(e){e.get("cvsobj_el").appendTo(t)}),e.after(t),t.children().unwrap(),n.editor.saveContent()},sendBackward:function(){var e=l._getFirstElementFromSelectCollection().prev();if(e.length<1)return!1;var t=$(document.createElement("div"));n.selectCollection.each(function(e){e.get("cvsobj_el").appendTo(t)}),e.before(t),t.children().unwrap(),n.editor.saveContent()},sendBack:function(){var e=$(document.createElement("div"));n.selectCollection.each(function(t){t.get("cvsobj_el").appendTo(e)}),n.$el.prepend(e),e.children().unwrap(),n.editor.saveContent()},lockObject:function(){n.selectCollection.each(function(e){e.get("cvsobj_el").attr({"data-obj-locked":"true"}),e.set({cvsobj_locked:!0})}),n.selectHandler(),n.editor.saveContent()},unlockObject:function(){n.selectCollection.each(function(e){e.get("cvsobj_el").removeAttr("data-obj-locked"),e.set({cvsobj_locked:!1})}),n.selectHandler(),n.editor.saveContent()},toggleHistoryButton:function(){var e=n.editor.model;if(!e)return!1;var t=e.history,o=n.editor.builder.topmenu;o.$el.find(".history_undo").toggleClass("disabled",t.currentIndex===t.stack.length-1),o.$el.find(".history_redo").toggleClass("disabled",0===t.currentIndex)},toggleSaveButton:function(){if(!n.editor.model)return!1;n.editor.builder.topmenu.$el.find(".save_all").toggleClass("disabled",n.editor.builder.sequenceList.collection.where({_isModified:!0}).length<1)},undoHistory:function(){var e=n.editor.model.history.undo();null!==e&&(n.editor.model.set(e,{silent:!0}),n.editor.model.trigger("historyCalled",!0),n.selectCollection.reset())},redoHistory:function(){var e=n.editor.model.history.redo();null!==e&&(n.editor.model.set(e,{silent:!0}),n.editor.model.trigger("historyCalled",!0),n.selectCollection.reset())},nudgeObject:function(e,t){var o=t||1;n.selectCollection.where({cvsobj_locked:!1}).forEach(function(t){var n=t.get("cvsobj_el");switch(e){case 37:n.css("left",parseInt(n.css("left"))-o);break;case 38:n.css("top",parseInt(n.css("top"))-o);break;case 39:n.css("left",parseInt(n.css("left"))+o);break;case 40:n.css("top",parseInt(n.css("top"))+o)}})},supernudgeObject:function(e){l.nudgeObject(e,10)},rotateAngleObject:function(e,t){n.selectCollection.where({cvsobj_locked:!1}).forEach(function(t){var o=t.get("cvsobj_el"),n=15/(180/Math.PI),c=l._getRotateRadians(o);switch(e){case 37:c+=-n;break;case 39:c+=n}o.css("transform","rotate("+c+"rad)"),o.css("mozTransform","rotate("+c+"rad)"),o.css("webkitTransform","rotate("+c+"rad)"),o.css("oTransform","rotate("+c+"rad)")})},alignObject:function(e){var t=n.selectCollection.where({cvsobj_locked:!1});switch(e){case"left":var o;o=_.min(t,function(e){return e.get("cvsobj_el").position().left}),t.forEach(function(e){e.get("cvsobj_el").css("left",o.get("cvsobj_el").position().left)});break;case"center":var c,i,s;c=_.min(t,function(e){return e.get("cvsobj_el").position().left}),i=_.max(t,function(e){return l._getRightEdge(e)}),s=c.get("cvsobj_el").position().left+(l._getRightEdge(i)-c.get("cvsobj_el").position().left)/2,t.forEach(function(e){e.get("cvsobj_el").css("left",s-e.get("cvsobj_el").width()/2)});break;case"right":var o,r;o=_.max(t,function(e){return l._getRightEdge(e)}),r=l._getRightEdge(o),t.forEach(function(e){var t=e.get("cvsobj_el");t.css("left",r-t.width())});break;case"top":var o;o=_.min(t,function(e){return e.get("cvsobj_el").position().top}),t.forEach(function(e){e.get("cvsobj_el").css("top",o.get("cvsobj_el").position().top)});break;case"middle":var a,d,f;a=_.min(t,function(e){return e.get("cvsobj_el").position().top}),d=_.max(t,function(e){return l._getBottomEdge(e)}),f=a.get("cvsobj_el").position().top+(l._getBottomEdge(d)-a.get("cvsobj_el").position().top)/2,t.forEach(function(e){e.get("cvsobj_el").css("top",f-e.get("cvsobj_el").height()/2)});break;case"bottom":var o,u;o=_.max(t,function(e){return l._getBottomEdge(e)}),u=l._getBottomEdge(o),t.forEach(function(e){var t=e.get("cvsobj_el");t.css("top",u-t.height())})}n.editor.saveContent()},distributeObject:function(e){var t=n.selectCollection.where({cvsobj_locked:!1});switch(e){case"horizontal":var o=_.sortBy(t,function(e){return e.get("cvsobj_el").position().left+e.get("cvsobj_el").width()/2}),l=o[0].get("cvsobj_el"),c=o[o.length-1].get("cvsobj_el"),i=(c.position().left-l.position().left)/(o.length-1);o.forEach(function(e,t){var n,c;n=e.get("cvsobj_el"),0!=t&&t!=o.length-1&&(c=l.position().left+i*t-n.width()/2+l.width()/2,n.css("left",c))});break;case"vertical":var o=_.sortBy(t,function(e){return e.get("cvsobj_el").position().top+e.get("cvsobj_el").height()/2}),s=o[0].get("cvsobj_el"),r=o[o.length-1].get("cvsobj_el"),i=(r.position().top-s.position().top)/(o.length-1);o.forEach(function(e,t){var n,l;n=e.get("cvsobj_el"),0!=t&&t!=o.length-1&&(l=s.position().top+i*t-n.height()/2+s.height()/2,n.css("top",l))})}n.editor.saveContent()},expandImageSize:function(){n.selectCollection.where({cvsobj_locked:!1,cvsobj_type:"image"}).forEach(function(e){var t=e.get("cvsobj_el"),o=t.height()*(n.$el.width()/t.width());t.css({top:0,left:0,width:n.$el.width(),height:o}),o>360&&(n.editor.$el.find(".canvas_resizer").css("height",o),n.editor.$el.find(".canvas_resizer > .ui-resizable-s").attr("data-height",o+"px"),n.editor.model.set({seq_screen_height:o})),n.editor.saveContent()})},showLinkDialog:function(){n.linkDialog?n.linkDialog.initialize():n.linkDialog=new t({canvas:n})},synchronizeObject:function(e){var t=0;n.editor.builder.sequenceList.collection.each(function(o){var l=$(document.createElement("div"));l.html(o.get("seq_content")),n.selectCollection.each(function(c){n.collectionRemoveHandler(c);var i=c.get("cvsobj_el").attr("data-sync-obj-id")||c.id,s=l.find("[data-sync-obj-id='"+i+"'], [data-obj-id='"+i+"']");if(s.length<1||n.editor.model==o&&1===s.length)return!1;s.each(function(){var o=c.get("cvsobj_el").clone();o.attr({"data-obj-id":$(this).attr("data-obj-id"),"data-sync-obj-id":$(this).attr("data-sync-obj-id")||null}),!0!==e&&o.css({left:$(this).css("left"),top:$(this).css("top")}),$(this).remove(),l.append(o),t++})}),o.set({seq_content:l.html()}),n.editor.model==o&&o.trigger("historyCalled",!0)}),n.selectCollection.remove(n.selectCollection.models)},synchronizeObjectAndPosition:function(){l.synchronizeObject(!0)}};return l};Oven.Editor.Canvas=Oven.Editor.Canvas||{},Oven.Editor.Canvas.Function=o});$(function(){var e=Oven.Editor.Canvas.Function,t=Oven.Editor.Canvas.ObjectModel,i=Oven.Editor.Canvas.ObjectCollection,o=Oven.Editor.Canvas.TextEditor,n=Backbone.View.extend({events:{mousedown:"selectHandler","mousedown > *":"forceSelectObject","mouseenter > *[data-obj-type]:not(.ui-draggable-dragging):not(.ui-resizable-resizing):not([contenteditable])":"makeObjectDraggable","mouseleave > *[data-obj-type]:not(.ui-draggable-dragging):not(.ui-resizable-resizing)":"destroyObjectDraggable","contextmenu > *":"contextmenuHandler","dblclick [data-obj-type='group'] > [data-obj-type]":"groupDblclickHandler","dblclick [data-obj-type='group'][data-released-from-group] > [data-obj-type]":"ingroupGroupDblclickHandler","dblclick >[data-obj-type]:not([data-obj-type='group']) [data-text-content]":"textContentDblclickHandler"},initialize:function(t){this.clearChildren(),_.extend(this,t),_.bindAll(this,"applyScreenWidth","applyScreenHeight","collectionRemoveHandler","collectionAddHandler","previewBackgroundColor","collectionResetHandler","ingroupTextDblclickHandler","editText","stopPropagation"),this.delegateEvents(),this.makeCanvasResizable(),this.makeCanvasSelectable(),this.function=this.function||new e({canvas:this}),this.textEditor=this.textEditor||new o({canvas:this}),this.selectCollection=this.selectCollection||new i,this.selectCollection.reset(),this.selectCollection.off("all remove add").on({reset:this.collectionResetHandler,remove:this.collectionRemoveHandler,add:this.collectionAddHandler})},clearChildren:function(){this.$el.children().length>0&&this.$el.children().remove()},applyScreenWidth:function(){var e=this.editor.model.get("seq_screen_width")||this.editor.builder.projectModel.get("pro_screen");this.editor.$el.find(".canvas_resizer").width(e),this.$el.width(e)},applyScreenHeight:function(){var e=this.editor.model.get("seq_screen_width")||this.editor.builder.projectModel.get("pro_screen"),t=this.editor.model.get("seq_screen_height")||"";t=640!=e||t?t:360,this.editor.$el.find(".canvas_resizer").height(t),this.$el.height(t),this.editor.$el.find(".canvas_resizer > .ui-resizable-s").attr({"data-height":(this.editor.model.get("seq_screen_height")||this.editor.$el.find(".canvas_resizer").height())+"px"})},applyBackgroundColor:function(){this.$el.css({backgroundColor:this.editor.model.get("seq_background")||"#ffffff"})},previewBackgroundColor:function(e){this.$el.css({backgroundColor:e})},forceSelectObject:function(e){var t=e.ctrlKey||e.metaKey,i=$(e.currentTarget),o=this.selectCollection.get($(e.currentTarget).attr("data-obj-id"));t||o||this.selectCollection.remove(this.selectCollection.models),t&&o?this.selectCollection.remove(o):this.addToSelectCollection(i)},addToSelectCollection:function(e){var i=new t({cvsobj_id:e.attr("data-obj-id"),cvsobj_type:e.attr("data-obj-type"),cvsobj_locked:"true"==e.attr("data-obj-locked"),cvsobj_memo:"true"==e.attr("data-memo-content"),cvsobj_el:e});this.selectCollection.add(i)},makeCanvasResizable:function(){var e=this;this.editor.$el.find(".canvas_resizer").resizable({handles:"s",autoHide:!0,alsoResize:e.$el,minHeight:360,maxHeight:6e3,create:function(e,t){},resize:function(e,t){$(e.target).find("> .ui-resizable-s").attr("data-height",t.size.height+"px")},stop:function(t,i){e.editor.model.set({seq_screen_height:i.size.height})}})},makeCanvasSelectable:function(){var e=this;this.editor.$el.find(".canvas_wrapper").selectableScroll({filter:".canvas > *",tolerance:$.cookie("OVEN_SELECT_TOLERANCE")||"touch",autoRefresh:!0,start:function(t,i){e.editor.clearTextSelection(),t.metaKey||t.ctrlKey||e.selectCollection.remove(e.selectCollection.models)},selected:function(t,i){e.addToSelectCollection($(i.selected))},unselected:function(t,i){var o=e.selectCollection.get($(i.unselected).attr("data-obj-id"));o.collection.remove(o)},stop:function(){e.selectHandler()}})},makeObjectDraggable:function(e){var t,i,o=this,n={left:0,top:0},a=$.cookie("OVEN_DRAG_GRID"),l=$.cookie("OVEN_DRAG_SNAP"),c=$.cookie("OVEN_DRAG_ALIGN");$(e.currentTarget).draggable({snap:"false"!=l&&"#canvas, #canvas > [data-obj-id]:not(.ui-draggable-dragging, .ui-selected)",snapTolerance:10,align:"false"!=c&&"#canvas, #canvas > [data-obj-id]:not(.ui-draggable-dragging, .ui-selected)",alignTolerance:3,grid:!(!a||"false"==a)&&[a,a],cancel:"[data-obj-locked='true']",start:function(e,a){var l=parseInt($(this).css("left"),10);l=isNaN(l)?0:l;var c=parseInt($(this).css("top"),10);c=isNaN(c)?0:c,t=l-a.position.left,i=c-a.position.top,o.editor.clearTextSelection(),n={left:a.position.left+t,top:a.position.top+i}},drag:function(e,l){if(l.position.left+=t,l.position.top+=i,a&&"false"!=a){var c=Math.abs(l.position.left)%parseInt(a),r=Math.abs(l.position.top)%parseInt(a);0==c&&0==r||(l.position.top-=r,l.position.left-=c)}if(o.selectCollection.length<2)return!0;var s=l.helper.attr("data-obj-id");o.selectCollection.each(function(e){if(e&&e.id===s)return!1;if(e&&e.get("cvsobj_locked"))return o.selectCollection.remove(e),!1;var t=e.get("cvsobj_el");t.css({left:t.position().left+(l.position.left-n.left)+"px",top:t.position().top+(l.position.top-n.top)+"px"})}),n={left:l.position.left,top:l.position.top}},stop:function(e,t){o.editor.saveContent(),o.editor.clearTextSelection()}})},makeObjectResizable:function(e){var t=this,i=function(i){var o=e.find(".ui-resizable-e .indicator"),n=e.find(".ui-resizable-s .indicator"),a=parseInt($.trim(n.val())),l=parseInt($.trim(o.val()));if(isNaN(a)||isNaN(l))return o.val(e.height()),n.val(e.width()),!1;var c,r;a=a<5?5:a,a=a>6e3?6e3:a,l=l<5?5:l,l=l>6e3?6e3:l,"group"==e.attr("data-obj-type")?(c=a/e.width(),r=l/e.height(),e.width(a),e.height(l),e.find("[data-obj-type]").each(function(){var e=$(this);e.width(e.width()*c),e.height(e.height()*r),e.css("left",e.position().left*c),e.css("top",e.position().top*r)})):(e.width(a),e.height(l)),o.val(l),n.val(a),t.editor.saveContent()},o=function(e){l(e),13==e.keyCode?(i(),$(e.currentTarget).blur(),e.stopPropagation()):38===e.keyCode?(n(this,e.shiftKey),i(),this.select(),e.preventDefault()):40===e.keyCode&&(a(this,e.shiftKey),i(),this.select(),e.preventDefault())},n=function(e,t){var o=$(e);o.val(parseInt(o.val(),10)+1*(t?10:1)),i()},a=function(e,t){var o=$(e);o.val(parseInt(o.val(),10)-1*(t?10:1)),i()},l=function(e){return!!(-1!==jQuery.inArray(e.keyCode,[46,8,9,27,13,110,190])||65==e.keyCode&&(e.ctrlKey||e.metaKey)||e.keyCode>=35&&e.keyCode<=40)||(!(e.shiftKey||e.keyCode<48||e.keyCode>57)||!(e.keyCode<96||e.keyCode>105)||(e.preventDefault(),!1))},c=function(){var l=e.find(".ui-resizable-e"),c=e.find(".ui-resizable-s"),r=$("<input class='indicator' title='5-4000' data-property='height' value='"+e.height()+"'>"),s=$("<input class='indicator' title='5-4000' data-property='width' value='"+e.width()+"'>"),d=$("<div class='icon arrow-up-down'></div>"),h=$("<div class='icon arrow_left-right'></div>");r.on({mousedown:t.stopPropagation,keydown:o,change:i}),s.on({mousedown:t.stopPropagation,keydown:o,change:i}),d.on({click:function(e){e.offsetY<0?a(r):n(r)}}),h.on({click:function(e){e.offsetX<0?a(s):n(s)}}),l.append(r),l.append(d),c.append(s),c.append(h)};e.resizable({cancel:"[data-obj-locked='true']",minWidth:e.children().attr("data-min-width")||5,minHeight:parseInt(e.children().attr("data-min-height"))||5,handles:"ne, se, sw, nw, n, e, w, s",create:function(e,t){c()},start:function(t,i){"group"==e.attr("data-obj-type")&&i.originalElement.find("[data-obj-type]").each(function(){$(this).data("originalSizeInfo",{width:$(this).width(),height:$(this).height(),left:parseInt($(this).css("left"))||0,top:parseInt($(this).css("top"))||0})})},resize:function(t,i){var o=i.size.width/i.originalSize.width,n=i.size.height/i.originalSize.height;t.altKey?e.css({left:i.originalPosition.left+(i.originalSize.width-i.originalSize.width*o)/2,top:i.originalPosition.top+(i.originalSize.height-i.originalSize.height*n)/2}):e.css({left:i.position.left,top:i.position.top}),"group"==e.attr("data-obj-type")&&i.originalElement.find("[data-obj-type]").each(function(){var e=$(this),t=e.data("originalSizeInfo");e.width(t.width*o),e.height(t.height*n),e.css("left",t.left*o),e.css("top",t.top*n)});var a=e.find(".ui-resizable-e .indicator"),l=e.find(".ui-resizable-s .indicator");a.val(e.height()),l.val(e.width())},stop:function(i,o){"group"==e.attr("data-obj-type")&&o.originalElement.find("[data-obj-type]").each(function(){$(this).removeData("originalSizeInfo")}),t.editor.saveContent()}})},makeObjectRotatable:function(e){var t=this;e.rotatable({angle:t.function._getRotateRadians(e),start:function(e,t){},rotate:function(e,t){},stop:function(e,i){t.editor.saveContent()}})},destroyObjectDraggable:function(e){try{$(e.currentTarget).draggable("destroy")}catch(e){}},destroyObjectResizable:function(e){try{e.resizable("destroy")}catch(e){}},destroyObjectRotatable:function(e){try{e.rotatable("destroy")}catch(e){}},collectionResetHandler:function(e){this.selectCollection.where({cvsobj_locked:!1})<1&&this.editor.builder.topmenu.quickbar.renderDynamicQuickbar()},collectionRemoveHandler:function(e){this.destroyObjectResizable(e.get("cvsobj_el")),this.destroyObjectRotatable(e.get("cvsobj_el")),e.get("cvsobj_el").removeClass("ui-selected")},collectionAddHandler:function(e){e.get("cvsobj_el").addClass("ui-selected")},selectHandler:function(){var e=this,t=this.selectCollection.where({cvsobj_locked:!1});1===t.length?(this.makeObjectResizable(t[0].get("cvsobj_el")),this.makeObjectRotatable(t[0].get("cvsobj_el"))):this.selectCollection.each(function(t){e.destroyObjectResizable(t.get("cvsobj_el")),e.destroyObjectRotatable(t.get("cvsobj_el"))}),this.editor.builder.topmenu.quickbar.renderDynamicQuickbar(this.selectCollection)},contextmenuHandler:function(e){e.stopPropagation(),e.preventDefault();var t=this.selectCollection,i=t.get($(e.currentTarget).attr("data-obj-id"));if(!i)return!1;var o={$el:i.get("cvsobj_el")},n=i.toJSON(),a=t.where({cvsobj_locked:!0}),l=t.where({cvsobj_locked:!1}),c=t.where({cvsobj_locked:!1,cvsobj_memo:!1}),r=this.$el.children(),s=l.length&&l[0].get("cvsobj_type"),d=l.length&&l[0].get("cvsobj_el");n.hasClipboardData=this.editor.clipboard.length>0,n.elementIndex=r.index(i.get("cvsobj_el")),n.canvasElementLength=r.length,n.hasNoUnlockedObject=l.length<1,n.hasNoUnlockedNoneMemoObject=c.length<1,n.isGroupAvailable=c.length>1,n.isUngroupAvailable=1==c.length&&"group"==s,n.isLockAvailable=a.length<t.length&&!d.attr("data-released-from-group"),n.isUnlockAvailable=a.length>0,n.isImageObject=1==l.length&&"image"==s&&!d.attr("data-released-from-group"),n.isCroppedImageObject=!0===n.isImageObject&&d.find("[data-original-image-content]").length>0,n.has_OnlyOne_Unlocked_NonGroup_Object=1==l.length&&"group"!=s,n.has_OnlyOne_Unlocked_Object=1==c.length,this.editor.builder.contextmenu.initialize({e:e,caller:o,callerType:"canvasObject",callerModel:n,hasMultipleCaller:t.length>1,callerEvents:{"click .cut_object":this.function.cutObject,"click .delete_object":this.function.deleteObject,"click .duplicate_object":this.function.duplicateObject,"click .paste_clipboard_event:not(.disabled)":this.function.pasteClipboard_event,"click .copy_clipboard:not(.disabled)":this.function.copyToClipboard,"click .copy_to_template:not(.disabled)":this.function.copyToTemplate,"click .make_group:not(.disabled)":this.function.makeGroup,"click .destroy_group:not(.disabled)":this.function.destroyGroup,"click .send_front:not(.disabled)":this.function.sendFront,"click .send_forward:not(.disabled)":this.function.sendForward,"click .send_backward:not(.disabled)":this.function.sendBackward,"click .send_back:not(.disabled)":this.function.sendBack,"click .lock_object:not(.disabled)":this.function.lockObject,"click .unlock_object:not(.disabled)":this.function.unlockObject,"click .show_linkdialog:not(.disabled)":this.function.showLinkDialog,"click .synchronize_object:not(.disabled)":this.function.synchronizeObject,"click .synchronize_object_position:not(.disabled)":this.function.synchronizeObjectAndPosition,"click .send_to_drawer:not(.disabled)":this.editor.builder.object.sendToDrawerClickHandler}})},editText:function(e){if(this.textEditor.target&&this.textEditor.target.get(0)==e.get(0))return!1;this.textEditor.initialize({target:e})},textContentDblclickHandler:function(e){this.editText($(e.currentTarget))},groupDblclickHandler:function(e){var t=this,i=$(e.currentTarget);if(i.parents("[data-obj-type='group']").length>1)return this.groupDblclickHandler({currentTarget:i.parent().get(0)}),!1;var o=i.parent().attr("data-obj-id");this.function.releaseGroup(i.parent()),this.addToSelectCollection(i),this.selectHandler(),this.makeObjectDraggable(e);var n=function(e){if(3==e.which)return!1;t.function.fastenReleasedGroup(o),t.selectHandler(),t.makeObjectDraggable({currentTarget:t.selectCollection.at(0).get("cvsobj_el").get(0)}),t.editor.$el.off("mousedown",n),t.editor.$el.off("mouseup",n),t.$el.off("mousedown",n),i.off("mousedown",t.stopPropagation),i.off("mouseup",t.stopPropagation),i.find("[data-text-content]").off("dblclick",t.ingroupTextDblclickHandler)};i.on("mousedown",this.stopPropagation),i.on("mouseup",this.stopPropagation),i.find("[data-text-content]").on("dblclick",this.ingroupTextDblclickHandler),this.editor.$el.one("mouseup",n),this.editor.$el.one("mousedown",n),this.$el.one("mousedown",n)},stopPropagation:function(e){e.stopPropagation();var t=this.editor.builder;"firefox"==t.ua&&t.$el.trigger(e.type)},ingroupTextDblclickHandler:function(e){e.stopPropagation(),this.textContentDblclickHandler(e)},ingroupGroupDblclickHandler:function(e){}});Oven.Editor=Oven.Editor||{},Oven.Editor.Canvas=n});$(function(){var e=Oven.Editor.Canvas,t=Backbone.View.extend({events:{mousedown:"mousedownHandler",contextmenu:"contextmenuHandler"},initialize:function(t){_.extend(this,t),_.bindAll(this,"render","loadModel","showLinkDialog","saveContent"),this.template=_.template($("#editorTemplate").html()),this.clipboard=this.clipboard||[],this.model=void 0,this.canvas?this.canvas.initialize():this.canvas=new e({editor:this}),this.$el.html(""),this.destroyDroppable()},loadModel:function(e){this.model=e,this.render()},filterContent:function(e){return e.find("style, link, script, iframe, form, frame, embed").remove(),e.find("*[onclick], *[onmousedown], *[onfocus]").remove(),e.find("[class^='ui-'], [class*=' ui-'], [contenteditable]").each(function(){var e=$(this);e.hasClass("ui-resizable-handle")||e.hasClass("ui-rotatable-handle")?e.remove():(e.removeAttr("contenteditable"),e.removeClass("ui-selectable ui-selecting ui-selectee ui-selected"),e.removeClass("ui-draggable ui-draggable-handle ui-draggable-dragging"),e.removeClass("ui-resizable"),e.removeClass("ui-rotatable"))}),e},saveContent:function(){var e=this.filterContent(this.canvas.$el.clone());this.model.set({seq_content:e.html()})},render:function(){var e=this.model.toJSON();e.canvas_width=this.model.get("seq_screen_width")||this.builder.projectModel.get("pro_screen"),this.$el.html(this.template(e)),this.canvas.initialize({$el:this.$el.find("#canvas")}),this.$el.find(".canvas_wrapper").scrollTop(300),this.canvas.applyScreenWidth(),this.canvas.applyScreenHeight(),this.canvas.applyBackgroundColor(),this.makeDroppable(),this.canvas.function.toggleHistoryButton(),this.canvas.function.toggleSaveButton()},makeDroppable:function(){var e=this;this.$el.droppable({accept:".obj",drop:function(t,i){e.insertObject(t,i)}})},destroyDroppable:function(){try{this.$el.droppable("destroy")}catch(e){}},insertObject:function(e,t){var i,n;void 0!=t.position?(i=t.position.left-this.canvas.$el.offset().left,n=t.position.top-this.canvas.$el.offset().top):(i=50,n=this.$el.scrollTop()),this.canvas.selectCollection.remove(this.canvas.selectCollection.models),t.helper.data("selectedModels").forEach(function(e){e.item.sendToSequence({top:n,left:i})}),t.helper.removeData("selectedModels")},mousedownHandler:function(){this.builder.$el.click()},contextmenuHandler:function(e){if(e.stopPropagation(),e.preventDefault(),!this.model||!this.model.item)return!1;this.canvas.selectCollection&&this.canvas.selectCollection.remove(this.canvas.selectCollection.models);var t=this.model.toJSON();t.hasClipboardData=this.clipboard.length>0,t.canvasElementLength=this.canvas.$el.children().length,this.builder.contextmenu.initialize({e:e,caller:this.model.item,callerType:"editor",callerModel:t,callerEvents:{"click .select_all":this.canvas.function.selectAll,"click .paste_clipboard_sync:not(.disabled)":this.canvas.function.pasteClipboard_sync,"click .paste_clipboard_event:not(.disabled)":this.canvas.function.pasteClipboard_event,"click .change_width:not(.checked)":this.model.item.changeSequenceWidth,"click .duplicate_sequence":this.model.item.duplicateSequence,"click .delete_sequence":this.model.item.destroySequence,"click .change_all_background":this.model.item.changeAllOtherBackground,"click .webview_sequence":this.model.item.webviewSequence,"click .webview_qr":this.model.item.list.showWebviewQRDialog}})},clearTextSelection:function(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()},showLinkDialog:function(){this.linkDialog||(this.linkDialog=new LinkDialog({editor:this})),this.linkDialog.initialize()}});Oven.Editor=t});$(function(){var e=new Oven.Util,t=Backbone.View.extend({tagName:"a",events:{dblclick:"dblclickHandler",mousedown:"select",contextmenu:"contextmenuHandler","submit .obj_rename":"renameDrawerObjectName"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","dblclickHandler","matchingChangeHandler","objIdChangedHandler","remove","destoryModel","toggleSelected","generateLorem","destroyMultiple","makeDraggable","sendToSequence","renameDrawer","submitDrawerObjectName","renameDrawerObjectName","viewObject","getWrappedObject","cropImage","renderThumbnailBg"),this.listenTo(this.model,"change:_isMatching",this.matchingChangeHandler),this.listenTo(this.model,"change:obj_id",this.objIdChangedHandler),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"change:_isSelected",this.toggleSelected),this.model.item=this,this.$el.get(0).linkedModel=this.model},render:function(){return this.template=this.model.isNew()?_.template($("#objectItemUploadingTemplate").html()):_.template($("#objectItemTemplate").html()),this.$el.attr("href","javascript:;"),this.$el.attr("title",this.list.tab.object.builder.translation.convert("DoubleClick or drag into canvas to insert")),this.$el.addClass("obj"),this.$el.html(this.template(this.model.toJSON())),this.$el.toggleClass("uploading",this.model.isNew()),this.model.isNew()?this.$el.find(".knob").knob():this.makeDraggable(),this},objIdChangedHandler:function(){this.render(),this.renderThumbnailBg()},matchingChangeHandler:function(){this.$el.toggle(this.model.get("_isMatching"))},destoryModel:function(){var e;if(e="image"==this.model.get("obj_type")?"Are you sure to delete this image?\n(If you used this image on pages, it'll be displayed as a wireframe.)":"Are you sure to delete?",!confirm(this.list.tab.object.builder.translation.convert(e)))return!1;this.model.destroy()},destroyMultiple:function(){var e,t=this.list.collection.where({_isSelected:!0});if(e="image"==this.model.get("obj_type")?"Are you sure to delete these images?\n(If you used thees images on pages, they'll be displayed as wireframes.)":"Are you sure to delete?",!confirm(this.list.tab.object.builder.translation.convert(e)))return!1;t.forEach(function(e){e.destroy()})},saveToDrawer:function(){},remove:function(){this.$el.addClass("deleting").fadeOut(250,function(){$(this).unbind().remove()})},select:function(e){var t=e.ctrlKey||e.metaKey;this.model.get("_isSelected")||t||this.list.clearSelected(),this.model.set({_isSelected:!t||!this.model.get("_isSelected")}),t?this.$el.toggleClass("ui-selected"):this.$el.addClass("ui-selected")},generateLorem:function(e){var t=this,i=this.list.tab.object.lorem;e.each(function(){i.language=$.cookie("OVEN_LOREM_LANGUAGE")||t.list.tab.object.builder.userInfo.locale,i.type=Lorem.TEXT,i.capitalize="true"==this.getAttribute("data-lorem-capitalize"),i.query=this.getAttribute("data-lorem"),i.createLorem(this),this.removeAttribute("data-lorem"),this.removeAttribute("data-lorem-capitalize")})},getWrappedObject:function(e,t){var i=this,a=function(a){var o=$(document.createElement("div"));o.html(a||i.model.get("obj_content")),o.find("[data-lorem]").length>0&&i.generateLorem(o.find("[data-lorem]")),o.css({position:"absolute",top:parseInt(e.top)||0,left:parseInt(e.left)||0,width:i.model.get("obj_width"),height:i.model.get("obj_height")}),o.attr("data-obj-id",i.list.tab.object.builder.makeId()),o.find("[data-obj-id]").each(function(){$(this).attr("data-obj-id",i.list.tab.object.builder.makeId())}),o.find("[data-obj-id]").length>1?o.attr("data-obj-type","group"):"drawer"==i.model.get("obj_type")&&o.children("[data-image-content]").length>0?o.attr("data-obj-type","image"):"drawer"==i.model.get("obj_type")&&o.children("[data-svg-content]").length>0?o.attr("data-obj-type","icon"):"drawer"==i.model.get("obj_type")?o.attr("data-obj-type","element"):o.attr("data-obj-type",i.model.get("obj_type")),o.children("[data-memo-content]").length>0&&(o.attr("data-memo-content",!0),i.list.tab.object.builder.topmenu.menubar.memoMenu.showMemo(window.event,!0)),o.children("[data-text-content]").length>0&&o.attr("data-text-editable",!0),"function"==typeof t&&t(o)};if("icon"==this.model.get("obj_type")){var o=this.model.get("obj_thumb");$.get(o,function(e){var t=$(e).find("svg");t.removeAttr("xmlns:a"),t.attr("data-svg-content","true"),t.attr("fill")||t.attr("fill","#000000"),a(t)})}else a()},dblclickHandler:function(){var e=this.list.tab.object.builder;e.editor.canvas.selectCollection.remove(e.editor.canvas.selectCollection.models),this.sendToSequence({left:e.$el.width()/2-this.model.get("obj_width")/2-e.editor.canvas.$el.offset().left,top:e.$el.height()/2-this.model.get("obj_height")/2-e.editor.canvas.$el.offset().top-50})},sendToSequence:function(e){var t=this.list.tab.object.builder.editor.canvas;this.getWrappedObject(e,function(e){t.$el.append(e),t.addToSelectCollection(e),t.selectHandler(),t.editor.saveContent()})},makeDraggable:function(){var e=this;this.$el.draggable({appendTo:"body",distance:10,revert:"invalid",helper:function(t){var i=$("<div></div>"),a=e.model.collection.where({_isSelected:!0});return a.forEach(function(a,o){var l=a.item.$el.clone(),n=a.item.$el.get(0)==$(t.currentTarget).get(0),s=a.item.$el.position().top-(t.pageY-e.list.$el.find(".list").offset().top)+t.offsetY,r=a.item.$el.position().left-(t.pageX-e.list.$el.find(".list").offset().left)+t.offsetX;l.css({position:"absolute",top:s,left:r,backgroundColor:"#fff",boxShadow:"2px 2px 10px rgba(0,0,0,0.3)",zIndex:n?1001:1e3-o,opacity:.5,webkitTransitionProperty:"top, left, opacity",webkitTransitionDuration:"0.4s",transitionProperty:"top, left, opacity",transitionDuration:"0.4s",webkitTransform:"translate3d(0,0,0)",transform:"translate3d(0,0,0)"}),l.attr({"data-top":s,"data-left":r}),setTimeout(function(){l.css({top:n?0:Math.random()*(20+o)*(2*Math.round(Math.random())-1),left:n?0:Math.random()*(20+o)*(2*Math.round(Math.random())-1),opacity:1})},10),i.append(l)}),a.length>1&&i.append($("<div class='selected_length'>"+a.length+"</div>")),i.data("selectedModels",a),i},start:function(t,i){e.list.tab.object.builder.$el.click(),i.helper.one("mouseup",function(){null!==i.helper.data("selectedModels")&&(i.helper.find(".selected_length").remove(),i.helper.find(".obj").each(function(){$(this).css({top:$(this).attr("data-top")+"px",left:$(this).attr("data-left")+"px",opacity:.1})}))})}})},contextmenuHandler:function(e){e.stopPropagation(),e.preventDefault(),this.list.tab.selectable&&(this.model.get("_isSelected")||this.list.clearSelected(),this.$el.addClass("ui-selected")),this.list.tab.object.builder.contextmenu.initialize({e:e,caller:this,callerModel:this.model.toJSON(),callerType:"objectItem",hasMultipleCaller:this.list.collection.where({_isSelected:!0}).length>1,callerEvents:{"click .save_drawer":"saveToDrawer","click .delete_object":"destoryModel","click .delete_multiple":"destroyMultiple","click .raname_drawer":"renameDrawer","click .crop_image":"cropImage","click .view_object:not(.disabled)":"viewObject"}})},toggleSelected:function(){this.$el.toggleClass("selected",this.model.get("_isSelected"))},refreshProgress:function(e){var t=100*e.loaded/e.total;parseInt(e.total/1024*10),parseInt(e.loaded/1024*10);this.$el.find(".knob").val(t).trigger("change")},renameDrawer:function(t){var i=$("<form><input type='text'></form>").addClass("obj_rename");this.$el.find(".object_name").hide().after(i),i.find("input").val(e.decodeHtml(this.model.get("obj_name"))).focus().select(),this.list.tab.object.builder.$el.one("mousedown",this.renameDrawerObjectName)},submitDrawerObjectName:function(){this.$el.find(".obj_rename").remove(),this.$el.find(".object_name").html(this.model.get("obj_name")).show(),this.list.tab.object.builder.$el.off("mousedown",this.renameDrawerObjectName)},renameDrawerObjectName:function(){var t=this.$el.find(".obj_rename input"),i=$.trim(t.val());return""==i?(this.submitDrawerObjectName(),!1):(this.model.get("obj_name")!==i&&this.model.save({obj_name:e.encodeHtml(i)},{patch:!0}),this.submitDrawerObjectName(),!1)},viewObject:function(){this.list.tab.object.showObjectDialog(this.model)},cropImage:function(){this.list.tab.object.showImageCropDialog(this.model)},renderThumbnailBg:function(){this.$el.find(".object_thumb").css({backgroundImage:"url("+this.model.get("obj_thumb")+")"})}});Oven.Object=Oven.Object||{},Oven.Object.Item=t});$(function(){var e=new Oven.Util,t=Oven.Object.Item,i=Backbone.View.extend({events:{"keyup .search_object":"searchObject","click .clear_search":"clearSearch","mousedown .category_name":"toggleCategory"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","appendItem","prependItem","makeSelectable","removeHandler");var t=window.localStorage;if(this.$el.hide(),this.template=_.template($("#objectListTemplate").html()),!this.tab.collection)return!1;this.collection=new this.tab.collection,this.collection.on({add:this.prependItem,remove:this.removeHandler,reset:this.render}),this.collection.fetch({reset:!0,data:"icon"==this.collection.name?{cached:t.getItem("icons_packages")}:null,success:function(e,t,i){"icon"==e.name&&e.cacheIconPackages(t,i.xhr.status)}}),"image"==this.collection.name?this.noDataTemplate=$($("#noImageTemplate").html()):"drawer"==this.collection.name&&(this.noDataTemplate=$($("#emptyDrawerTemplate").html())),this.imageStat=_.template($("#imageStatTemplate").html()),this.totalSize=0},render:function(){this.$el.addClass("object_list").attr("data-object-type",this.collection.name),this.$el.html(this.template()),this.tab.object.$el.find(".object_body").append(this.$el),"image"==this.collection.name&&(this.$el.append(this.imageStat({MAX_SIZESUM:parseInt(this.tab.object.builder.userInfo.imageStorage.MAX_SIZESUM/1048576),MAX_COUNT:this.tab.object.builder.userInfo.imageStorage.MAX_COUNT})),this.$el.addClass("image_list"),this.refreshSizeGraph()),this.collection.length?this.collection.each(this.appendItem):"image"!=this.collection.name&&"drawer"!=this.collection.name||this.$el.find(".list").append(this.noDataTemplate),"function"==typeof this.callback&&(this.callback(),this.callback=void 0),!0===this.tab.selectable&&this.makeSelectable(),this.collection.each(function(e){e.item.renderThumbnailBg()})},removeHandler:function(){var e=this;"image"==this.collection.name&&this.refreshSizeGraph(),("image"==this.collection.name||"drawer"==this.collection.name)&&this.collection.length<1&&setTimeout(function(){e.$el.find(".list").html(e.noDataTemplate)},250)},refreshSizeGraph:function(){var e=0,t=this.tab.object.builder.userInfo.imageStorage;this.collection.each(function(t){e+=parseInt(t.get("obj_size"))});var i=Math.round(100*e/t.MAX_SIZESUM);this.$el.find(".image_stat .bar_size .bar_inner").css("width",i>0&&i<2.5?"2.5%":i+"%");var a=Math.round(100*this.collection.length/t.MAX_COUNT);this.$el.find(".image_stat .bar_length .bar_inner").css("width",a+"%"),this.$el.find(".image_stat .count_size .current").html(Math.floor(e/1048576*100)/100),this.$el.find(".image_stat .count_length .current").html(this.collection.length),this.totalSize=e},prependItem:function(e){"image"==this.collection.name&&this.refreshSizeGraph(),this.$el.find(".no_data").length>0&&this.$el.find(".no_data").remove(),this.appendItem(e,!0)},appendItem:function(e,i){var a=new t({model:e,list:this}),l=this.$el.find(".list .category[data-ctg='"+e.get("obj_category")+"']"),n=l.children(".category_name");l.length<1&&(l=$(document.createElement("div")).addClass("category").attr("data-ctg",e.get("obj_category")),n=$(_.template($("#objectCategoryNameTemplate").html())({category:e.get("obj_category")})),l.append(n),this.$el.find(".list").append(l)),!0===i?n.after(a.render().$el):l.append(a.render().$el)},makeSelectable:function(){var e=this;this.$el.find(".list").selectableScroll({filter:".category:not(.off) .obj",autoRefresh:!0,start:function(t,i){t.metaKey||t.ctrlKey||e.clearSelected(),e.tab.object.builder.contextmenu.isShown&&e.tab.object.builder.contextmenu.blur()},selected:function(e,t){t.selected.linkedModel.set({_isSelected:!0})},unselected:function(t,i){e.clearSelected()}})},clearSelected:function(){this.tab.object.builder.$el.click(),this.collection.where({_isSelected:!0}).forEach(function(e){e.set({_isSelected:!1})})},searchObject:function(e){var t=this,i=this.getPhoneme($.trim(this.$el.find(".search_object").val().toLowerCase().replace(/\s/g,""))),a=0;this.collection.each(function(e){var l=t.getPhoneme(e.get("obj_tag").toLowerCase().replace(/\s/g,"")).indexOf(i)>-1;e.set({_isMatching:l}),l&&a++}),this.displayResultLength(a),this.$el.find(".clear_search").toggle(i.length>0),this.toggleFilteredCategory(i.length>0)},toggleFilteredCategory:function(e){var t,i;e?(t=this.collection.where({_isMatching:!0}).map(function(e){return e.get("obj_category")}),i=_.union(t),this.$el.find(".list .category").each(function(){$(this).toggle(i.indexOf(this.getAttribute("data-ctg"))>-1)})):this.$el.find(".list .category").show(),!0===this.tab.selectable&&!0===e?this.$el.find(".list").selectableScroll("disable"):!0===this.tab.selectable&&!1===e&&this.$el.find(".list").selectableScroll("enable")},displayResultLength:function(t){var i=this,a=$.trim(this.$el.find(".search_object").val());if(void 0!==this.resultNotification&&(a.length?this.resultNotification.remove():this.resultNotification.slideUp(200,function(){$(this).remove(),i.$el.find(".list").removeClass("searching")})),!a.length)return delete this.resultNotification,!1;var l=$(_.template($("#objectSearchNotificationTemplate").html())({keyword:e.encodeHtml(a),resultLength:t}));this.resultNotification=this.resultNotification?l:l.hide().fadeIn(200),this.$el.find(".list").prepend(this.resultNotification)},clearSearch:function(){this.$el.find(".search_object").val(""),this.searchObject()},getPhoneme:function(e){for(var t,i=e.split(""),a=[],l=0,n=i.length;l<n;l++)t=this.splitPhoneme(i[l]),a=a.concat(t);return a.join("")},splitPhoneme:function(e){if(!/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(e))return[e];var t=Array("ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"),i=Array("ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"),a=Array("","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"),l=e.charCodeAt(0),n=l-44032,c=n%28,o=(n-c)/28%21,s=parseInt((n-c)/28/21);if(s<0)return[e];var r=[];return t[s]&&r.push(t[s]),i[o]&&r.push(i[o]),a[c]&&r.push(a[c]),r},toggleCategory:function(e){$(e.currentTarget).parent(".category").toggleClass("off")}});Oven.Object=Oven.Object||{},Oven.Object.List=i});$(function(){var e=Backbone.Model.extend({idAttribute:"obj_id",defaults:{obj_type:"image",obj_category:"Uploaded Image",obj_name:"",obj_width:0,obj_height:0,obj_size:0,obj_mimetype:"",obj_tag:"",obj_path:"",obj_thumb:"",obj_regidate:"",_isSelected:!1}});Oven.Object.Image=Oven.Object.Image||{},Oven.Object.Image.Model=e});$(function(){var e=Oven.Object.Image.Model,n=Backbone.Collection.extend({name:"image",model:e,url:"/api/objects/images"});Oven.Object.Image=Oven.Object.Image||{},Oven.Object.Image.Collection=n});$(function(){var e=Backbone.Model.extend({idAttribute:"obj_id",defaults:{obj_type:"drawer",obj_category:"",obj_name:"",obj_content:"",obj_width:0,obj_height:0,obj_thumb:"",obj_tag:"",obj_madeby:""}});Oven.Object.Drawer=Oven.Object.Drawer||{},Oven.Object.Drawer.Model=e});$(function(){var e=Oven.Object.Drawer.Model,r=Backbone.Collection.extend({name:"drawer",model:e,url:"/api/objects/drawer"});Oven.Object.Drawer=Oven.Object.Drawer||{},Oven.Object.Drawer.Collection=r});$(function(){var e=Backbone.Model.extend({idAttribute:"obj_id",defaults:{obj_type:"element",obj_category:"",obj_name:"",obj_content:"",obj_width:0,obj_height:0,obj_thumb:"",obj_tag:"",obj_madeby:""}});Oven.Object.Element=Oven.Object.Element||{},Oven.Object.Element.Model=e});$(function(){var e=Oven.Object.Element.Model,n=Backbone.Collection.extend({name:"element",model:e,url:"/api/objects/elements"});Oven.Object.Element=Oven.Object.Element||{},Oven.Object.Element.Collection=n});$(function(){var o=Backbone.Model.extend({idAttribute:"obj_id",defaults:{obj_type:"icon",obj_category:"",obj_name:"",obj_content:"",obj_width:0,obj_height:0,obj_thumb:"",obj_tag:"",obj_madeby:""}});Oven.Object.Icon=Oven.Object.Icon||{},Oven.Object.Icon.Model=o});$(function(){var e=Oven.Object.Icon.Model,c=Backbone.Collection.extend({name:"icon",model:e,url:"/api/objects/icons",parse:function(e){return e?e.collection:null},cacheIconPackages:function(e,c){var n=window.localStorage;if(e||204!=c){if(e)try{n.setItem("icons_packages",e.packages),n.setItem("icons_collection",JSON.stringify(e.collection))}catch(e){n.clear()}}else this.reset(JSON.parse(n.getItem("icons_collection")))}});Oven.Object.Icon=Oven.Object.Icon||{},Oven.Object.Icon.Collection=c});$(function(){var t=Oven.Object.List,e=Backbone.View.extend({events:{click:"select"},initialize:function(t){_.extend(this,t),_.bindAll(this,"render","select","unselect","getOrder"),this.template=_.template(this.templateEl.html()),this.$el=$(this.template()),this.render(),"function"==typeof this.callback&&this.callback()},render:function(){return this.$el.attr({title:this.object.builder.translation.convert("Drag tabs to change the order")}),this.object.$el.find(".object_tab").append(this.$el),"element"==this.templateEl.attr("data-object")&&(this.objectList=new t({tab:this})),this},select:function(t){void 0!==this.object.selectedTab&&this.object.selectedTab!==this&&(this.object.selectedTab.objectList.clearSelected(),this.object.selectedTab.unselect()),this.$el.addClass("on"),this.showList(t),this.object.selectedTab=this},unselect:function(){this.$el.removeClass("on"),this.objectList.$el.hide()},showList:function(e){void 0===this.objectList?this.objectList=new t({tab:this,callback:e}):"function"==typeof e&&e(),this.objectList.$el.show()},getOrder:function(){return this.$el.parent().children().index(this.$el)}});Oven.Object=Oven.Object||{},Oven.Object.Tab=e});$(function(){var t=new Oven.Util,e=Oven.Translation,o=Oven.Object.Image.Model,i=Backbone.View.extend({events:{"click .about_photos":"showAboutPhotos","click #aboutPhotos":"hideAboutPhotos"},initialize:function(t){_.extend(this,t),_.bindAll(this,"render","initializePhotosApp","appendAboutLink"),this.translation=new e({locale:loggedUser.locale}),void 0===this.photosApp&&(this.$el.attr("id","photosEditor"),this.initializePhotosApp(),this.appendAboutLink()),this.render()},appendAboutLink:function(){var t=$(document.createElement("A"));t.attr({href:"javascript:;",class:"about_photos"}),t.html("<span class='glyphicon glyphicon-info-sign'></span>"),this.$el.find(".photos_editor").append(t),this.$el.append($("#aboutPhotosTemplate").html())},showAboutPhotos:function(){var t=this.$el.find("#aboutPhotos");t.show(),setTimeout(function(){t.addClass("show")})},hideAboutPhotos:function(){var t=this.$el.find("#aboutPhotos");t.removeClass("show"),setTimeout(function(){t.hide()},300)},initializePhotosApp:function(){var t=this,e={serviceName:"oven",originType:"daum"};this.photosApp=new photos.App(this.$el.get(0),e),this.photosApp.on("photos:edit:complete",function(e){t.$el.removeClass("show"),setTimeout(function(){t.$el.detach()},301),t.sendImage(e[0].dataURL)}),this.photosApp.on("photos:edit:cancel",function(){t.$el.removeClass("show"),setTimeout(function(){t.$el.detach()},301)}),this.$el.disableSelection()},render:function(){var t=this;this.photosApp.open(this.model.get("obj_path")),this.$el.appendTo($("body")),setTimeout(function(){t.$el.addClass("show")})},sendImage:function(e){var i=this,n=function(){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=a.width,e.height=a.height,n.drawImage(a,0,0,a.width,a.height);var s=i.object.isValidImage({size:0,type:i.model.get("obj_mimetype")});if(null===s)return!1;if(!0!==s)return alert(s),!1;var h=new o({obj_name:"Processing.."});i.object.imageTab.objectList.collection.add(h,{at:0});var l=function(t){$.ajax({url:"/api/objects/images/",type:"PUT",data:{dataURL:t,filename:i.model.get("obj_name")},success:function(t){h.set(t)},error:function(t){h.destroy(),426==t.status?alert(i.translation.convert("Not enough free space. You need to upgrade the account.")):alert(i.translation.convert("Cannot perform action due to an error."))}})};t.compressCanvas({canvas:e,width:e.width,height:e.height,mimetype:i.model.get("obj_mimetype")},l)},a=new Image;return a.onload=function(){n()},a.src=e,!1},stopPropagation:function(t){t.stopPropagation()}});Oven.Dialog=Oven.Dialog||{},Oven.Dialog.ImageCrop=i});$(function(){var e=Oven.Object.Tab,t=Oven.Object.Element.Collection,i=Oven.Object.Image.Model,a=Oven.Object.Image.Collection,l=Oven.Object.Icon.Collection,o=Oven.Object.Drawer.Model,n=Oven.Object.Drawer.Collection,r=Oven.Dialog.Object,c=Oven.Dialog.ImageCrop,s=Backbone.View.extend({events:{click:"clickHandler","click .toggle_expand":"toggleExpand","change #imageUploadInput":"uploadInputChangeHandler"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render","linkObjectModules","bindImageUpload","uploadImage","addDrawer","sendToDrawerClickHandler","showObjectDialog"),this.template=_.template($("#objectTemplate").html()),this.lorem=new Lorem,this.render(),this.linkObjectModules(),this.makeSortable()},render:function(){this.$el.html(this.template())},linkObjectModules:function(){for(var i,o=$.cookie("OVEN_OBJECT_ORDER")?$.cookie("OVEN_OBJECT_ORDER").split(","):["element","icon","image","drawer"],r=0;r<o.length;r++){switch(o[r]){case"element":i=new e({object:this,templateEl:$(".objectTabTemplate[data-object='element']"),collection:t,selectable:!0}),this.elementTab=i;break;case"icon":i=new e({object:this,templateEl:$(".objectTabTemplate[data-object='icon']"),collection:l,selectable:!0}),this.iconTab=i;break;case"image":i=new e({object:this,templateEl:$(".objectTabTemplate[data-object='image']"),collection:a,selectable:!0,callback:this.bindImageUpload}),this.imageTab=i;break;case"drawer":i=new e({object:this,templateEl:$(".objectTabTemplate[data-object='drawer']"),collection:n,selectable:!0}),this.drawerTab=i}0==r&&(this.selectedTab=i,this.selectedTab.select())}},makeSortable:function(){var e=this;this.$el.find(".object_tab").sortable({axis:"x",containment:"parent",placeholder:"ui-state-highlight",revert:300,opacity:.85,helper:"clone",distance:15,tolerance:"pointer",sort:function(e,t){},update:function(t,i){var a=[];a[e.elementTab.getOrder()]="element",a[e.iconTab.getOrder()]="icon",a[e.imageTab.getOrder()]="image",a[e.drawerTab.getOrder()]="drawer",$.cookie("OVEN_OBJECT_ORDER",a.join(","),{expires:30})}})},clickHandler:function(){this.builder.$el.find("#builder").hasClass("hide_object")&&this.toggleObject()},toggleExpand:function(){this.builder.$el.find("#builder").toggleClass("expand_object");var e=this.selectedTab.objectList.$el,t=e.find(".list").scrollTop()/e.find(".list").get(0).scrollHeight,i=function(){var i=e.find(".list").get(0).scrollHeight*t;e.find(".list").scrollTop(i)};setTimeout(i,220)},toggleObject:function(e){e&&e.stopPropagation(),this.builder.$el.find("#builder").toggleClass("hide_object"),this.builder.topmenu.menubar.$el.find(".toggle_object").toggleClass("hidden")},bindImageUpload:function(){var e=this;this.builder.$el.attr({ondragover:"return false;"}).on({drop:function(t){if(t.preventDefault(),!t.originalEvent.dataTransfer||t.originalEvent.dataTransfer.files.length<1)return!1;var i=t.originalEvent.dataTransfer.files;e.imageTab.select(function(){e.uploadImage(i)})}})},isValidImage:function(e){if(void 0===e)return null;var t=this.builder.translation,i=this.builder.userInfo.imageStorage;if(this.imageTab.objectList.totalSize+e.size>i.MAX_SIZESUM||this.imageTab.objectList.collection.length>i.MAX_COUNT-1){var a=t.convert("Not enough free space. You need to upgrade the account.")+"\n";return"free"==this.builder.userInfo.grade&&(a+="("+t.convert("Verify your email and get a free upgrade to Standard account now.")+")"),a}return"image/png"!==e.type&&"image/gif"!==e.type&&"image/jpeg"!==e.type?t.convert("You can upload JPG, PNG or GIF files only."):!(e.size>i.MAX_FILESIZE)||t.convert("Maximum filesize is limited to ")+parseFloat(i.MAX_FILESIZE/1048576)+"MB"},uploadImage:function(e,t){this.builder.$el.click();var a=this;if(e.length>10)return alert(this.builder.translation.convert("Multiple image uploading is available up to 10 files.\n Please try again.")),!1;for(var l=0;l<e.length;l++)$(function(){var t=e[l],o=a.isValidImage(t);if(null===o)return!1;if(!0!==o)return alert(o),!1;var n=new FormData;n.append("file",t);var r=new i({obj_name:"Uploading..",obj_size:t.size});a.imageTab.objectList.collection.add(r,{at:0}),$.ajax({url:"/api/objects/images",type:"POST",data:n,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){e.lengthComputable&&r.item.refreshProgress(e)},!1),e},processData:!1,contentType:!1,success:function(e){r.set(e)},error:function(e){alert("Uploading failed"),r.destroy()}})})},sendToDrawerClickHandler:function(){this.drawerTab.select(this.addDrawer)},addDrawer:function(){var e=this.builder.editor.canvas.selectCollection.where({cvsobj_locked:!1});if(e.length<1)return!1;var t=e[0];this.builder.editor.canvas.selectCollection.remove(t);var i=t.get("cvsobj_el"),a=i.clone();a.css({position:"relative",left:"0",top:"0"});var l=new o({obj_name:"My object",obj_content:this.builder.editor.filterContent(i.clone()).html(),obj_category:"Storage",obj_width:i.width(),obj_height:i.height(),obj_html:a[0].outerHTML});this.drawerTab.objectList.collection.create(l)},showObjectDialog:function(e){this.objectDialog?this.objectDialog.initialize({model:e}):this.objectDialog=new r({object:this,model:e})},showImageCropDialog:function(e){this.imageCropDialog?this.imageCropDialog.initialize({model:e}):this.imageCropDialog=new c({object:this,model:e})},uploadInputChangeHandler:function(e){if(e.target.files&&e.target.files.length>0){this.uploadImage(e.target.files);var t=this.$el.find("#imageUploadInput");t.replaceWith(t.val("").clone(!0))}}});Oven.Object=s});$(function(){var e=Backbone.Model.extend({defaults:{fillColor:"",preserveAspectRatio:!0}}),t=Backbone.View.extend({tagName:"span",events:{"click .toggle_preserveAspectRatio":"preserveAspectRatioClickHandler"},initialize:function(t){if(_.extend(this,t),_.bindAll(this,"render","applyFillColor"),this.delegateEvents(),this.template=_.template($("#quickBarSVGTemplate").html()),this.model=this.model||new e,void 0!==t.selectCollection&&!1!==this.getSVGEditable())return this.render()},getSVGEditable:function(){var e=this.selectCollection.where({cvsobj_locked:!1}),t=this.selectCollection.where({cvsobj_locked:!1,cvsobj_type:"icon"});return e.length>0&&e.length===t.length&&t},render:function(){var e=this.getSVGEditable()[0].get("cvsobj_el");return this.model.set({fillColor:e.find("[fill]")[0].getAttribute("fill"),preserveAspectRatio:!("none"==e.find("svg")[0].getAttribute("preserveAspectRatio"))}),this.quickbar.topmenu.builder.$el.find("> .svg-fill-spectrum").remove(),this.$el.html(this.template(this.model.toJSON())),this.makeSpectrum(),this},applyFillColor:function(e){this.getSVGEditable().forEach(function(t){t.get("cvsobj_el").find("[fill]").attr({fill:e})}),this.quickbar.topmenu.builder.editor.saveContent()},preserveAspectRatioClickHandler:function(){var e=this.getSVGEditable()[0].get("cvsobj_el").find("svg");this.model.set("preserveAspectRatio",!this.model.get("preserveAspectRatio")),this.model.get("preserveAspectRatio")?e[0].removeAttribute("preserveAspectRatio"):e[0].setAttribute("preserveAspectRatio","none"),this.$el.find(".toggle_preserveAspectRatio").toggleClass("on",this.model.get("preserveAspectRatio")),this.quickbar.topmenu.builder.editor.saveContent()},makeSpectrum:function(){var e=this,t=this.$el.find("[data-colorpicker='true']");t.spectrum({preferredFormat:"rgb",clickoutFiresChange:!0,showPalette:!0,showInput:!0,showAlpha:!0,containerClassName:"svg-fill-spectrum",palette:[["#1abc9c","#16a085","#ffffff"],["#2ecc71","#27ae60","#E0E0E0"],["#3498db","#2980b9","#BEBEBE"],["#9b59b6","#8e44ad","#9E9E9E"],["#34495e","#2c3e50","#7F7F7F"],["#f1c40f","#f39c12","#5E5E5E"],["#e67e22","#d35400","#404040"],["#e74c3c","#c0392b","#212121"],["#95a5a6","#7f8c8d","#000000"]],beforeShow:function(e){$("body").click()},change:function(t){e.applyFillColor(t.toRgbString())},move:function(e){}}),t.on("dragstop.spectrum",function(i,o){t.spectrum("set",o),e.applyFillColor(o.toRgbString())})}});Oven.Topmenu=Oven.Topmenu||{},Oven.Topmenu.Quickbar=Oven.Topmenu.Quickbar||{},Oven.Topmenu.Quickbar.SVG=t});$(function(){var e=Backbone.Model.extend({defaults:{tableLayout:"auto",cellColor:""}}),t=Backbone.View.extend({tagName:"span",events:{mousedown:"stopPropagation","mousedown .table_layout":"tableLayoutClickHandler","mousedown .prepend_row":"prependRow","mousedown .append_row":"appendRow","mousedown .remove_row":"removeRow","mousedown .prepend_col":"prependCol","mousedown .append_col":"appendCol","mousedown .remove_col":"removeCol","mousedown .make_head_row":"makeHeadRow","mousedown .make_head_col":"makeHeadColumn","mousedown .make_head_cell":"makeHeadCell","mousedown .col_narrow":"cellNarrowClickHandler","mousedown .col_wide":"cellWideClickHandler"},initialize:function(t){if(_.extend(this,t),_.bindAll(this,"render"),this.delegateEvents(),this.template=_.template($("#quickBarTableTemplate").html()),this.model=this.model||new e,window.getSelection().focusNode)return this.render()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},prependRow:function(){this.appendRow(-1)},appendRow:function(e){var t=this.getTarget(),n=t.outerHeight(),a=t.parents("tr").clone();a.find("th, td").html("&nbsp;"),-1===e?t.parents("table").prepend(a):t.parents("table").append(a),this.selectElement(t[0]);var o=this.getTarget().parents("[data-text-editable]");o.height(o.outerHeight()+n),this.quickbar.topmenu.builder.editor.saveContent()},removeRow:function(){var e=this.getTarget(),t=e.outerHeight(),n=e.parents("tr"),a=n.next().children().eq(n.children().index(e));a=a.length?a:n.prev().children().eq(n.children().index(e)),n.remove(),a.length?this.selectElement(a[0]):(e.parents("[data-obj-type]").remove(),$("body").mousedown());var o=this.getTarget().parents("[data-text-editable]");o.height(o.outerHeight()-t),this.quickbar.topmenu.builder.editor.saveContent(),this.checkTextSelectionAndRemovePopup()},prependCol:function(){this.appendCol(-1)},appendCol:function(e){var t=this.getTarget(),n=t.outerWidth(),a=t.parent().children().index(t);t.parents("table").find("tr").each(function(){var t=$(this).children().eq(a),n=t.clone().html("&nbsp;");-1===e?t.before(n):t.after(n)}),this.selectElement(t[0]);var o=this.getTarget().parents("[data-text-editable]");o.width(o.outerWidth()+n),this.quickbar.topmenu.builder.editor.saveContent()},removeCol:function(){var e=this.getTarget(),t=e.outerWidth(),n=e.parent().children().index(e),a=e.parents("table"),o=e.next().length?e.next():e.prev();a.find("tr").each(function(){$(this).children().eq(n).remove()}),o.length?this.selectElement(o[0]):(e.parents("[data-obj-type]").remove(),$("body").mousedown());var r=this.getTarget().parents("[data-text-editable]");r.width(r.outerWidth()-t),this.quickbar.topmenu.builder.editor.saveContent(),this.checkTextSelectionAndRemovePopup()},makeHeadCell:function(){var e=this.getTarget(),t=document.createElement("td"==e[0].tagName.toLowerCase()?"th":"td");e.before($(t).html(e.html())),e.remove(),this.selectElement(t),this.quickbar.topmenu.builder.editor.saveContent()},makeHeadRow:function(){var e=this.getTarget(),t=e.parents("tr"),n=t.children().index(e),a="td"==e[0].tagName.toLowerCase()?"th":"td";t.children().each(function(){var e=document.createElement(a);$(e).html($(this).html()),$(this).before(e),$(this).remove()}),this.selectElement(t.children().eq(n)[0]),this.quickbar.topmenu.builder.editor.saveContent()},makeHeadColumn:function(){var e,t=this.getTarget(),n=t.parent().children().index(t),a=t.parents("table"),o="td"==t[0].tagName.toLowerCase()?"th":"td";a.find("tr").each(function(){var a=$(this).children().eq(n),r=document.createElement(o);$(r).html(a.html()),a.before(r),a[0]==t[0]&&(e=r),a.remove()}),this.selectElement(e),this.quickbar.topmenu.builder.editor.saveContent()},getTarget:function(){var e=$(window.getSelection().focusNode);return e.parents("td").length?e.parents("td"):e.parents("th").length?e.parents("th"):$(e)},stopPropagation:function(e){e.stopPropagation()},selectElement:function(e){if(window.getSelection){var t=window.getSelection();t.removeAllRanges();var n=document.createRange();n.selectNodeContents(e),t.addRange(n)}else if(document.selection){var a=document.body.createTextRange();a.moveToElementText(e),a.select()}},tableLayoutClickHandler:function(e){var t=this.getTarget().parents("table");t.css({tableLayout:"fixed"==t.css("tableLayout")?"auto":"fixed"}),$(e.currentTarget).toggleClass("on","auto"==t.css("tableLayout")),this.quickbar.topmenu.builder.editor.saveContent()},checkTextSelectionAndRemovePopup:function(){$.trim(window.getSelection().toString()).length<1&&this.quickbar.topmenu.builder.editor.canvas.textEditor.selectionPopup.remove()},cellWideClickHandler:function(){var e=this.getTarget(),t=e.parent().children().index(e),n=e.parents("table"),a=[],o=this.getTarget().parents("[data-text-editable]");n.find("tr").each(function(){var e=$(this).children().eq(t);a.push(e)});var r=parseInt(a[0].css("width"))/o.width()*100,i=parseInt(r)+10;i=i>=100?100:i,$(a).each(function(){$(this).css("width",i+"%")})},cellNarrowClickHandler:function(){var e=this.getTarget(),t=e.parent().children().index(e),n=e.parents("table"),a=[],o=this.getTarget().parents("[data-text-editable]");n.find("tr").each(function(){var e=$(this).children().eq(t);a.push(e)});var r=parseInt(a[0].css("width"))/o.width()*100,i=parseInt(r)-3;i=i<=0?0:i,$(a).each(function(){$(this).css("width",i+"%")})}});Oven.Topmenu=Oven.Topmenu||{},Oven.Topmenu.Quickbar=Oven.Topmenu.Quickbar||{},Oven.Topmenu.Quickbar.Table=t});$(function(){var e=Backbone.Model.extend({defaults:{isCropped:!1,preserveRatio:!0}}),t=Backbone.View.extend({tagName:"span",events:{"click .expand_image":"expandClickHandler","click .toggle_preserveRatio:not(.disabled)":"toggleIgnoreRatio"},initialize:function(t){if(_.extend(this,t),_.bindAll(this,"render"),this.delegateEvents(),this.template=_.template($("#quickBarImageTemplate").html()),this.model=this.model||new e,void 0!==t.selectCollection&&this.getImageEditable())return this.render()},getImageEditable:function(){var e=this.selectCollection.where({cvsobj_locked:!1});return 1==e.length&&"image"==e[0].get("cvsobj_type")&&!e[0].get("cvsobj_el").attr("data-released-from-group")&&e[0].get("cvsobj_el")},render:function(){return this.model.set({isCropped:this.getImageEditable().find("[data-original-image-content]").length>0,preserveRatio:this.getImageEditable().find("[data-ignore-ratio='true']").length<1}),this.$el.html(this.template(this.model.toJSON())),this},expandClickHandler:function(){this.quickbar.topmenu.builder.editor.canvas.function.expandImageSize()},toggleIgnoreRatio:function(){this.model.set("preserveRatio",!this.model.get("preserveRatio"));var e=this.getImageEditable().find("[data-image-content]");this.model.get("preserveRatio")?e.removeAttr("data-ignore-ratio"):e.attr("data-ignore-ratio","true"),this.$el.find(".toggle_preserveRatio").toggleClass("on",this.model.get("preserveRatio")),this.quickbar.topmenu.builder.editor.saveContent()}});Oven.Topmenu=Oven.Topmenu||{},Oven.Topmenu.Quickbar=Oven.Topmenu.Quickbar||{},Oven.Topmenu.Quickbar.Image=t});$(function(){var e=Backbone.Model.extend({defaults:{isGroupAvailable:!1,isUngroupAvailable:!1,isLockAvailable:!1,isUnlockAvailable:!1}}),i=Backbone.View.extend({tagName:"span",events:{"click .quick_group:not(.disabled)":"quickGroupClickHandler","click .quick_ungroup:not(.disabled)":"quickUngroupClickHandler","click .quick_lock:not(.disabled)":"quickLockClickHandler","click .quick_unlock:not(.disabled)":"quickUnlockClickHandler"},initialize:function(i){if(_.extend(this,i),_.bindAll(this,"render"),this.delegateEvents(),this.template=_.template($("#quickBarAlignTemplate").html()),this.model=this.model||new e,void 0!==i.selectCollection)return this.render()},render:function(){var e=this.selectCollection.where({cvsobj_locked:!0}),i=this.selectCollection.where({cvsobj_locked:!1}),l=this.selectCollection.where({cvsobj_locked:!1,cvsobj_memo:!1});return this.model.set({isGroupAvailable:l.length>1,isUngroupAvailable:1==l.length&&"group"==i[0].get("cvsobj_type"),isLockAvailable:e.length<this.selectCollection.length&&!i[0].get("cvsobj_el").attr("data-released-from-group"),isUnlockAvailable:e.length>0}),this.$el.html(this.template(this.model.toJSON())),this},quickGroupClickHandler:function(){this.quickbar.topmenu.builder.editor.canvas.function.makeGroup()},quickUngroupClickHandler:function(){this.quickbar.topmenu.builder.editor.canvas.function.destroyGroup()},quickLockClickHandler:function(){this.quickbar.topmenu.builder.editor.canvas.function.lockObject()},quickUnlockClickHandler:function(){this.quickbar.topmenu.builder.editor.canvas.function.unlockObject()}});Oven.Topmenu=Oven.Topmenu||{},Oven.Topmenu.Quickbar=Oven.Topmenu.Quickbar||{},Oven.Topmenu.Quickbar.Align=i});$(function(){var t=Backbone.Model.extend({defaults:{fontFamily:"",fontSize:"",color:"",backgroundColor:"",fontWeight:"",fontStyle:"",textDecoration:"",textAlign:"",lineHeight:"",hasInnerStyle:!1}}),e=Backbone.View.extend({tagName:"span",events:{"click .font_selector":"fontSelectorClickHandler","click .txt_style":"changeFontStyle","click .clear_inner_style":"clearInnerStyle"},initialize:function(e){if(_.extend(this,e),_.bindAll(this,"render","changeFontFamily","modelChangeHandler","changeFontStyle","getTextEditable"),this.delegateEvents(),this.template=_.template($("#quickBarTextEditorTemplate").html()),this.model=this.model||new t,void 0!==this.selectCollection&&this.getTextEditable().length>0)return this.render()},getTextEditable:function(){return this.selectCollection.filter(function(t){return"true"==t.get("cvsobj_el").attr("data-text-editable")&&!1===t.get("cvsobj_locked")})},render:function(){var t=this.getTextEditable()[0].get("cvsobj_el").children("[data-text-content]");this.model.off("change");var e="none";t.css("textDecoration").toLowerCase().indexOf("underline")>-1?e="underline":t.css("textDecoration").toLowerCase().indexOf("line-through")>-1&&(e="line-through");var n="normal"==t.css("lineHeight")?1.14:Math.ceil(parseInt(t.css("lineHeight"))/parseInt(t.css("fontSize"))*10)/10+"em";return this.model.set({fontFamily:t.css("fontFamily"),fontSize:t.css("fontSize"),color:t.css("color"),backgroundColor:t.css("backgroundColor"),fontWeight:"bold"==t.css("fontWeight")||"700"==t.css("fontWeight")?"bold":"normal",fontStyle:t.css("fontStyle"),textDecoration:e,textAlign:"start"==t.css("textAlign")?"":t.css("textAlign"),lineHeight:n,hasInnerStyle:t.find("*[style]").length>0}),this.model.on("change",this.modelChangeHandler),this.quickbar.topmenu.builder.$el.find("> .text-spectrum").remove(),this.$el.html(this.template(this.model.toJSON())),this.makeSpinner(),this.makeSpectrum(),this},modelChangeHandler:function(){if(!this.model.changedAttributes())return!1;var t=this;this.getTextEditable().forEach(function(e){e.get("cvsobj_el").children("[data-text-content]").css(t.model.changedAttributes())}),this.quickbar.topmenu.builder.editor.saveContent(),this.render()},makeSpinner:function(){var t=this.$el.find("input.spinner"),e=this;t.each(function(){$(this).spinner({min:$(this).attr("data-min"),max:$(this).attr("data-max"),step:$(this).attr("data-step")||1,stop:function(t,n){$(this).change();var i=this,o=$(this).attr("data-property");"fontSize"!=o&&"lineHeight"!=o||e.getTextEditable().forEach(function(t){var e=t.get("cvsobj_el"),n=e.children("[data-text-content]");"fontSize"==o?n.css("fontSize",i.value+"px"):n.css("lineHeight",i.value+"em"),n.prop("scrollHeight")>e.height()&&(e.height(n.prop("scrollHeight")),e.find(".ui-resizable-e .indicator").val(e.height()))}),e.quickbar.topmenu.builder.editor.saveContent()}})})},makeSpectrum:function(){var t=this,e=this.$el.find("[data-colorpicker='true']");e.spectrum({preferredFormat:"rgb",clickoutFiresChange:!0,showPalette:!0,showInput:!0,showAlpha:!0,allowEmpty:!0,containerClassName:"text-spectrum",palette:[["#1abc9c","#16a085","#ffffff"],["#2ecc71","#27ae60","#E0E0E0"],["#3498db","#2980b9","#BEBEBE"],["#9b59b6","#8e44ad","#9E9E9E"],["#34495e","#2c3e50","#7F7F7F"],["#f1c40f","#f39c12","#5E5E5E"],["#e67e22","#d35400","#404040"],["#e74c3c","#c0392b","#212121"],["#95a5a6","#7f8c8d","#000000"]],beforeShow:function(t){$("body").click()},change:function(e){var n=$(this).attr("data-property"),e=e.toRgbString();t.model.set(n,e),t.syncronizeProperty(n,e)},move:function(t){}}),e.on("dragstop.spectrum",function(n,i){e.spectrum("set",i);var o=$(this).attr("data-property");t.model.set(o,i.toRgbString()),t.syncronizeProperty(o,i.toRgbString())})},syncronizeProperty:function(t,e){"backgroundColor"==t&&this.getTextEditable().forEach(function(t){t.get("cvsobj_el").children("[data-sync-bgcolor]").each(function(){$(this).css($(this).attr("data-sync-bgcolor"),e)})})},fontSelectorClickHandler:function(t){t.stopPropagation(),t.preventDefault(),this.quickbar.topmenu.builder.contextmenu.initialize({e:t,caller:this,callerType:"fontSelector",callerModel:{offsetX:0,offsetY:28,width:270,fontFamily:this.model.get("fontFamily")},callerEvents:{"click [data-font]":this.changeFontFamily}})},changeFontFamily:function(t){var e=$(t.currentTarget).attr("data-font");this.model.set({fontFamily:e})},changeFontStyle:function(t){var e=$(t.currentTarget).attr("data-property"),n=$(t.currentTarget).attr("data-value");e&&this.model.set(e,n)},clearInnerStyle:function(){this.getTextEditable()[0].get("cvsobj_el").children("[data-text-content]").find("*").removeAttr("style"),this.model.set("hasInnerStyle",!1)}});Oven.Topmenu=Oven.Topmenu||{},Oven.Topmenu.Quickbar=Oven.Topmenu.Quickbar||{},Oven.Topmenu.Quickbar.TextEditor=e});$(function(){var e=Oven.Topmenu.Quickbar.TextEditor,i=Oven.Topmenu.Quickbar.Align,t=Oven.Topmenu.Quickbar.Image,n=Oven.Topmenu.Quickbar.SVG,c=Oven.Topmenu.Quickbar.Table,l=Backbone.View.extend({events:{"click .history_undo:not(.disabled)":"historyUndoClickHandler","click .history_redo:not(.disabled)":"historyRedoClickHandler","click .save_all:not(.disabled)":"savePageClickHandler","click .webview_project":"webviewProjectClickHandler","click .webview_option":"webviewOptionClickHandler"},initialize:function(l){_.extend(this,l),_.bindAll(this,"historyUndoClickHandler","historyRedoClickHandler","render","renderDynamicQuickbar","webviewProjectClickHandler"),this.template=_.template($("#quickbarForEditorTemplate").html()),this.textEditor=this.textEditor||new e({quickbar:this}),this.alignQuickbar=this.alignQuickbar||new i({quickbar:this}),this.imageQuickbar=this.imageQuickbar||new t({quickbar:this}),this.svgQuickbar=this.svgQuickbar||new n({quickbar:this}),this.tableQuickbar=this.tableQuickbar||new c({quickbar:this}),this.render(),this.renderDynamicQuickbar()},render:function(){this.$el.html(this.template())},renderDynamicQuickbar:function(e){this.topmenu.builder.$el.find("> .text-spectrum").remove();var i=this.$el.find(".dynamic_quickbar");if(i.html(""),!e||!e.length)return!1;i.append(this.alignQuickbar.initialize({selectCollection:e}).$el);try{i.append(this.textEditor.initialize({selectCollection:e}).$el)}catch(e){}try{i.append(this.imageQuickbar.initialize({selectCollection:e}).$el)}catch(e){}try{i.append(this.svgQuickbar.initialize({selectCollection:e}).$el)}catch(e){}},initTableQuickbar:function(){this.$el.find(".dynamic_quickbar").append(this.tableQuickbar.initialize().$el)},historyUndoClickHandler:function(){this.topmenu.builder.editor.canvas.function.undoHistory()},historyRedoClickHandler:function(){this.topmenu.builder.editor.canvas.function.redoHistory()},savePageClickHandler:function(){this.topmenu.builder.sequenceList.collection.where({_isModified:!0}).forEach(function(e){e.item.saveSequence()})},webviewProjectClickHandler:function(){if(this.topmenu.builder.sequenceList.selectedItem)this.topmenu.builder.sequenceList.selectedItem.webviewSequence();else{this.topmenu.builder.sequenceList.collection.at(0).item.webviewSequence()}},webviewOptionClickHandler:function(e){e.stopPropagation(),e.preventDefault(),this.topmenu.builder.contextmenu.initialize({e:e,caller:this,callerType:"webview",callerModel:{offsetX:-29,offsetY:28},callerEvents:{"click .webview_sequence":this.topmenu.builder.sequenceList.selectedItem.webviewSequence,"click .webview_qr":this.topmenu.builder.sequenceList.showWebviewQRDialog}})}});Oven.Topmenu=Oven.Topmenu||{},Oven.Topmenu.Quickbar=l});$(function(){var t=Oven.Dialog.Bug,e=Oven.Dialog.About,i=Oven.Dialog.Shortcut,n=Backbone.View.extend({events:{"click .report_bug":"reportClickHandler","click .show_help":"showHelpClickHandler","click .about_oven":"aboutOvenClickHandler","click .show_shortcut":"showShortcutClickHandler"},initialize:function(t){_.extend(this,t),this.template=_.template($("#rootmenuHelpTemplate").html()),this.appendToMenu(),this.render()},render:function(){return this.$el.html(this.template()),this},blur:function(){},appendToMenu:function(){this.$el.attr("data-menu")||(this.$el.addClass("menu_root").attr({"data-menu":this.menu}),this.menubar.$el.find(".menu").append(this.$el))},reportClickHandler:function(){this.bugDialog?this.bugDialog.initialize():this.bugDialog=new t},showHelpClickHandler:function(){window.open("http://oven-tool.github.io/docs/")},aboutOvenClickHandler:function(){this.aboutDialog?this.aboutDialog.initialize():this.aboutDialog=new e},showShortcutClickHandler:function(){this.shortcutDialog?this.shortcutDialog.initialize():this.shortcutDialog=new i}});Oven.Topmenu.Menubar=Oven.Topmenu.Menubar||{},Oven.Topmenu.Menubar.Help=n});$(function(){var e=Backbone.View.extend({events:{"click .show_grid":"toggleGrid","click .show_ruler":"toggleRuler","click .select_tolerance:not(.checked)":"setSelectTolerance","click .drag_snap:not(.checked)":"setDragSnap","click .drag_align:not(.checked)":"setDragAlign","click .drag_grid:not(.checked)":"setDragGrid","click .lorem_language:not(.checked)":"setLoremLanguage"},initialize:function(e){_.extend(this,e),this.template=_.template($("#rootmenuViewTemplate").html()),this.appendToMenu(),this.render()},appendToMenu:function(){this.$el.attr("data-menu")||(this.$el.addClass("menu_root").attr({"data-menu":this.menu}),this.menubar.$el.find(".menu").append(this.$el))},render:function(){return this.$el.html(this.template({locale:this.menubar.topmenu.builder.userInfo.locale})),this},toggleGrid:function(e){var a=!this.$el.find(".show_grid").hasClass("checked");this.$el.find(".show_grid").toggleClass("checked",a),this.menubar.topmenu.builder.editor.canvas.$el.attr("data-show-grid",a),$.cookie("OVEN_SHOW_GRID",a,{expires:30}),e.stopPropagation()},toggleRuler:function(e){var a=!this.$el.find(".show_ruler").hasClass("checked");this.$el.find(".show_ruler").toggleClass("checked",a);var t=this.menubar.topmenu.builder.editor.canvas,r=$($("#rulerTemplate").html());a?t.$el.before(r):t.$el.prev("#ruler").remove(),$.cookie("OVEN_SHOW_RULER",a,{expires:30}),e.stopPropagation()},setSelectTolerance:function(e){var a=$(e.currentTarget).attr("data-value");this.menubar.topmenu.builder.editor.$el.find(".canvas_wrapper").selectableScroll("option","tolerance",a),this.$el.find(".select_tolerance.checked").removeClass("checked"),this.$el.find(".select_tolerance[data-value='"+a+"']").addClass("checked"),$.cookie("OVEN_SELECT_TOLERANCE",a,{expires:30}),this.menubar.blur()},setDragSnap:function(e){var a=$(e.currentTarget).attr("data-value");this.$el.find(".drag_snap.checked").removeClass("checked"),this.$el.find(".drag_snap[data-value='"+a+"']").addClass("checked"),$.cookie("OVEN_DRAG_SNAP",a,{expires:30}),this.menubar.blur()},setDragAlign:function(e){var a=$(e.currentTarget).attr("data-value");this.$el.find(".drag_align.checked").removeClass("checked"),this.$el.find(".drag_align[data-value='"+a+"']").addClass("checked"),$.cookie("OVEN_DRAG_ALIGN",a,{expires:30}),this.menubar.blur()},setDragGrid:function(e){var a=$(e.currentTarget).attr("data-value");this.$el.find(".drag_grid.checked").removeClass("checked"),this.$el.find(".drag_grid[data-value='"+a+"']").addClass("checked"),$.cookie("OVEN_DRAG_GRID",a,{expires:30}),this.menubar.blur()},setLoremLanguage:function(e){var a=$(e.currentTarget).attr("data-value");this.$el.find(".lorem_language.checked").removeClass("checked"),this.$el.find(".lorem_language[data-value='"+a+"']").addClass("checked"),$.cookie("OVEN_LOREM_LANGUAGE",a,{expires:30}),this.menubar.blur()}});Oven.Topmenu.Menubar=Oven.Topmenu.Menubar||{},Oven.Topmenu.Menubar.View=e});$(function(){var e=Backbone.View.extend({events:{"click .add_memo:not(.disabled)":"addMemo","click .show_memo:not(.disabled)":"showMemo"},initialize:function(e){_.extend(this,e),_.bindAll(this,"render"),this.template=_.template($("#rootmenuMemoTemplate").html()),this.appendToMenu(),this.render()},appendToMenu:function(){this.$el.attr("data-menu")||(this.$el.addClass("menu_root").attr({"data-menu":this.menu}),this.menubar.$el.find(".menu").append(this.$el))},render:function(){return this.$el.html(this.template()),this.menubar.topmenu.builder.editor.model&&(this.$el.find(".disabled").removeClass("disabled"),this.$el.find(".show_memo").toggleClass("checked","true"==this.menubar.topmenu.builder.editor.canvas.$el.attr("data-show-memo"))),this},addMemo:function(e){this.showMemo(e,!0);var t=this.menubar.topmenu.builder;t.editor.canvas.selectCollection.remove(t.editor.canvas.selectCollection.models),t.object.elementTab.objectList.collection.get("g7347").item.sendToSequence({left:t.$el.width()/2-125-t.editor.canvas.$el.offset().left,top:t.$el.height()/2-85-t.editor.canvas.$el.offset().top}),$("body").trigger("click")},showMemo:function(e,t){var o=this.menubar.topmenu.builder,t=t||!this.$el.find(".show_memo").hasClass("checked");this.$el.find(".show_memo").toggleClass("checked",t),o.editor.canvas.$el.attr("data-show-memo",t),$.cookie("OVEN_SHOW_MEMO",t,{expires:30}),e&&e.stopPropagation&&e.stopPropagation()}});Oven.Topmenu.Menubar=Oven.Topmenu.Menubar||{},Oven.Topmenu.Menubar.Memo=e});$(function(){var e=Backbone.View.extend({events:{"click .make_group:not(.disabled)":"makeGroup","click .destroy_group:not(.disabled)":"destroyGroup","click .lock_object:not(.disabled)":"lockObject","click .unlock_object:not(.disabled)":"unlockObject","click .send_front:not(.disabled)":"sendFront","click .send_forward:not(.disabled)":"sendForward","click .send_backward:not(.disabled)":"sendBackward","click .send_back:not(.disabled)":"sendBack","click .align_horizontal_left:not(.disabled)":"alignHorizontalLeft","click .align_horizontal_center:not(.disabled)":"alignHorizontalCenter","click .align_horizontal_right:not(.disabled)":"alignHorizontalRight","click .align_vertical_top:not(.disabled)":"alignVerticalTop","click .align_vertical_middle:not(.disabled)":"alignVerticalMiddle","click .align_vertical_bottom:not(.disabled)":"alignVerticalBottom","click .distribute_horizontal:not(.disabled)":"distributeHorizontal","click .distribute_vertical:not(.disabled)":"distributeVertical"},initialize:function(e){_.extend(this,e),_.bindAll(this,"getBuilder"),this.delegateEvents(),this.template=_.template($("#rootmenuAlignTemplate").html()),this.appendToMenu(),this.render()},appendToMenu:function(){this.$el.attr("data-menu")||(this.$el.addClass("menu_root").attr({"data-menu":this.menu}),this.menubar.$el.find(".menu").append(this.$el))},getBuilder:function(){return this.menubar.topmenu.builder},render:function(){var e={elementIndex:void 0,canvasElementLength:void 0,hasMultipleCaller:!1,isGroupAvailable:!1,isUngroupAvailable:!1,isLockAvailable:!1,isUnlockAvailable:!1,hasNoUnlockedObject:!1,isAlignAvailable:!1,isDistributeAvailable:!1};try{var t=this.getBuilder(),i=t.editor.canvas.selectCollection,n=i.where({cvsobj_locked:!0}),l=i.where({cvsobj_locked:!1}),a=i.where({cvsobj_locked:!1,cvsobj_memo:!1});e.selectCollectionLength=i.length,e.elementIndex=t.editor.canvas.$el.children().index(t.editor.canvas.function._getLastElementFromSelectCollection()),e.canvasElementLength=t.editor.canvas.$el.children().length,e.isGroupAvailable=a.length>1,e.isUngroupAvailable=1==a.length&&"group"==l[0].get("cvsobj_type"),e.isLockAvailable=n.length<i.length&&!l[0].get("cvsobj_el").attr("data-released-from-group"),e.isUnlockAvailable=n.length>0,e.hasNoUnlockedObject=l.length<1,e.hasNoUnlockedNoneMemoObject=a.length<1,e.isAlignAvailable=l.length>1,e.isDistributeAvailable=l.length>2}catch(e){}return this.$el.html(this.template(e)),this},makeGroup:function(){this.getBuilder().editor.canvas.function.makeGroup()},destroyGroup:function(){this.getBuilder().editor.canvas.function.destroyGroup()},lockObject:function(){this.getBuilder().editor.canvas.function.lockObject()},unlockObject:function(){this.getBuilder().editor.canvas.function.unlockObject()},sendFront:function(){this.getBuilder().editor.canvas.function.sendFront()},sendForward:function(){this.getBuilder().editor.canvas.function.sendForward()},sendBackward:function(){this.getBuilder().editor.canvas.function.sendBackward()},sendBack:function(){this.getBuilder().editor.canvas.function.sendBack()},alignHorizontalLeft:function(){this.getBuilder().editor.canvas.function.alignObject("left")},alignHorizontalCenter:function(){this.getBuilder().editor.canvas.function.alignObject("center")},alignHorizontalRight:function(){this.getBuilder().editor.canvas.function.alignObject("right")},alignVerticalTop:function(){this.getBuilder().editor.canvas.function.alignObject("top")},alignVerticalMiddle:function(){this.getBuilder().editor.canvas.function.alignObject("middle")},alignVerticalBottom:function(){this.getBuilder().editor.canvas.function.alignObject("bottom")},distributeHorizontal:function(){this.getBuilder().editor.canvas.function.distributeObject("horizontal")},distributeVertical:function(){this.getBuilder().editor.canvas.function.distributeObject("vertical")}});Oven.Topmenu.Menubar=Oven.Topmenu.Menubar||{},Oven.Topmenu.Menubar.Align=e});$(function(){var e=Backbone.View.extend({events:{"mouseenter .cell":"cellMouseenterHandler","click .cell":"createTable","change .table_type":"typeChangeHandler","change .table_head":"headChangeHandler"},initialize:function(e){_.extend(this,e),this.template=_.template($("#rootmenuTableTemplate").html()),this.cellMap={},this.appendToMenu(),this.render()},appendToMenu:function(){this.$el.attr("data-menu")||(this.$el.addClass("menu_root").attr({"data-menu":this.menu}),this.menubar.$el.find(".menu").append(this.$el))},render:function(){return this.$el.html(this.template()),this.menubar.topmenu.builder.editor.model&&(this.$el.find(".disabled").removeClass("disabled"),this.setCellMap()),this},setCellMap:function(){var e=this;this.$el.find(".cell").each(function(){var t=$(this),a=t.attr("data-vertical-cell"),l=t.attr("data-horizontal-cell");e.cellMap[a]||(e.cellMap[a]={}),e.cellMap[a][l]=t})},cellMouseenterHandler:function(e){for(var t=parseInt($(e.currentTarget).attr("data-vertical-cell")),a=parseInt($(e.currentTarget).attr("data-horizontal-cell")),l=0;l<7;l++)for(var n=0;n<7;n++){var r=this.cellMap[l][n];r.toggleClass("on",l<=t&&n<=a)}},createTable:function(e){for(var t,a,l=parseInt($(e.currentTarget).attr("data-vertical-cell"))+1,n=parseInt($(e.currentTarget).attr("data-horizontal-cell"))+1,r=this.$el.find(".table_type").val(),d=this.$el.find(".table_head").val(),i=$(document.createElement("table")),o=i.append("<tbody></tbody>").find("tbody"),c=0;c<l;c++){t=$(document.createElement("tr")),o.append(t);for(var s=0;s<n;s++)a="top"==d&&0==c||"left"==d&&0==s?$(document.createElement("th")):$(document.createElement("td")),a.html("&nbsp;"),t.append(a)}i.attr("data-text-content","true"),i.addClass(r),this.sendToSequence(i)},sendToSequence:function(e){var t=this.menubar.topmenu.builder,a=t.editor.canvas,l=$(document.createElement("div"));l.html(e);var n=parseInt(.9*a.$el.width()),r=30*e.find("tr").length;l.css({position:"absolute",left:t.$el.width()/2-n/2-a.$el.offset().left,top:t.$el.height()/2-r/2-a.$el.offset().top-50,width:n,height:r}),l.attr({"data-obj-type":"element","data-obj-id":this.menubar.topmenu.builder.makeId(),"data-text-editable":"true"}),this.menubar.blur(),a.$el.append(l),a.selectCollection.remove(a.selectCollection.models),a.addToSelectCollection(l),a.selectHandler(),a.editor.saveContent()},typeChangeHandler:function(e){var t=this.$el.find(".table_type").val();this.$el.find(".cell_wrapper").attr({"data-table-type":t})},headChangeHandler:function(e){var t=this.$el.find(".table_head").val();this.$el.find(".cell_wrapper").attr({"data-table-head":t})}});Oven.Topmenu.Menubar=Oven.Topmenu.Menubar||{},Oven.Topmenu.Menubar.Table=e});$(function(){var e=Backbone.View.extend({events:{"change input[type='range'][data-value]":"rangeChangedHandler","change input[type='text'][data-value]":"textChangedHandler","change input[data-value]:not([data-colorpicker])":"inputChangedHandler","change select[data-value]":"inputChangedHandler","click .use_effect":"stopPropagation","click .use_effect input[type='checkbox']":"toggleEffect","click input":"stopPropagation","click .ui-spinner-button":"stopPropagation","click .unify_value":"stopPropagation","click .unify_value input[type='checkbox']":"unifyHandler"},initialize:function(e){_.extend(this,e),_.bindAll(this,"inputChangedHandler"),this.delegateEvents(),this.model.off("change:color").on({"change:color":this.inputChangedHandler}),this.$el.html()||this.render()},render:function(){this.$el.html(this.template(this.model.toJSON())),this.makeSpinner(),this.makeSpectrum(),this.showCheck()},inputChangedHandler:function(){this.caller.getherInfo(),this.caller.renderStyle()},rangeChangedHandler:function(e){var t=this.$el.find("input[type='text'][data-value='"+$(e.currentTarget).attr("data-value")+"']");t.length>0&&t.val($(e.currentTarget).val())},textChangedHandler:function(e){var t=this.$el.find("input[type='range'][data-value='"+$(e.currentTarget).attr("data-value")+"']");t.length>0&&t.val($(e.currentTarget).val())},toggleEffect:function(e){e.stopPropagation();var t=$(e.currentTarget).is(":checked");this.$el.find(".effect_control").toggleClass("disabled",!t),this.$el.prev().toggleClass("checked",t),this.model.set("use",t),this.caller.renderStyle(),this.showCheck()},showCheck:function(){this.$el.prev().toggleClass("checked",this.model.get("use"))},stopPropagation:function(e){e.stopPropagation()},makeSpectrum:function(){var e=this,t=this.$el.find("[data-colorpicker='true']");t.spectrum({color:this.model.get($(this).attr("data-value")),preferredFormat:"rgb",clickoutFiresChange:!1,showPalette:!0,showInput:!0,showAlpha:!0,containerClassName:"effect-spectrum",palette:[["#1abc9c","#16a085","#ffffff"],["#2ecc71","#27ae60","#E0E0E0"],["#3498db","#2980b9","#BEBEBE"],["#9b59b6","#8e44ad","#9E9E9E"],["#34495e","#2c3e50","#7F7F7F"],["#f1c40f","#f39c12","#5E5E5E"],["#e67e22","#d35400","#404040"],["#e74c3c","#c0392b","#212121"],["#95a5a6","#7f8c8d","#000000"]],change:function(t){e.model.set($(this).attr("data-value"),t.toRgbString())},move:function(e){}}),t.on("dragstop.spectrum",function(n,a){t.spectrum("set",a),e.model.set($(this).attr("data-value"),a.toRgbString())})},makeSpinner:function(){this.$el.find("input.spinner").each(function(){$(this).spinner({min:$(this).attr("data-min"),max:$(this).attr("data-max"),stop:function(e,t){$(this).change()}})})},unifyHandler:function(e){e.stopPropagation(),this.model.set({unify:$(e.currentTarget).is(":checked")}),this.model.get("unify")&&this.inputChangedHandler()}});Oven.Topmenu.Menubar.Effect=Oven.Topmenu.Menubar.Effect||{},Oven.Topmenu.Menubar.Effect.Common=e});$(function(){var e=Backbone.Model.extend({defaults:{use:!1,unify:!0,borderTopWidth:2,borderTopStyle:"solid",borderTopColor:"rgb(51,51,51)",borderRightWidth:2,borderRightStyle:"solid",borderRightColor:"rgb(51,51,51)",borderLeftWidth:2,borderLeftStyle:"solid",borderLeftColor:"rgb(51,51,51)",borderBottomWidth:2,borderBottomStyle:"solid",borderBottomColor:"rgb(51,51,51)"}}),t=Oven.Topmenu.Menubar.Effect.Common,o=Backbone.View.extend({initialize:function(e){_.extend(this,e),_.bindAll(this,"borderChangeHandler"),this.model=this.parseStyleToModel(),this.model.off("change").on({change:this.borderChangeHandler}),this.commonEffect?this.commonEffect.initialize({$el:this.$el,model:this.model}):this.commonEffect=new t({template:_.template($("#borderTemplate").html()),$el:this.$el,model:this.model,caller:this})},getherInfo:function(){var e,t,o,r,d,l,i=void 0!==this.model.changedAttributes().unify;this.model.set({borderTopWidth:parseInt(this.$el.find("[data-value='borderTopWidth']").val())||0,borderTopStyle:this.$el.find("[data-value='borderTopStyle']").val(),borderTopColor:this.$el.find("[data-value='borderTopColor']").val(),borderRightWidth:parseInt(this.$el.find("[data-value='borderRightWidth']").val())||0,borderRightStyle:this.$el.find("[data-value='borderRightStyle']").val(),borderRightColor:this.$el.find("[data-value='borderRightColor']").val(),borderLeftWidth:parseInt(this.$el.find("[data-value='borderLeftWidth']").val())||0,borderLeftStyle:this.$el.find("[data-value='borderLeftStyle']").val(),borderLeftColor:this.$el.find("[data-value='borderLeftColor']").val(),borderBottomWidth:parseInt(this.$el.find("[data-value='borderBottomWidth']").val())||0,borderBottomStyle:this.$el.find("[data-value='borderBottomStyle']").val(),borderBottomColor:this.$el.find("[data-value='borderBottomColor']").val()},{silent:!0}),this.model.get("unify")&&(i||this.model.changedAttributes())&&(i?(r=this.model.get("borderTopWidth"),d=this.model.get("borderTopStyle"),l=this.model.get("borderTopColor"),this.model.set({borderTopWidth:r,borderTopStyle:d,borderTopColor:l,borderRightWidth:r,borderRightStyle:d,borderRightColor:l,borderLeftWidth:r,borderLeftStyle:d,borderLeftColor:l,borderBottomWidth:r,borderBottomStyle:d,borderBottomColor:l},{silent:!0})):this.model.changedAttributes()&&(e=Object.keys(this.model.changedAttributes()),t=e[0],o=this.model.changedAttributes()[t],t.toLowerCase().indexOf("width")>-1?this.model.set({borderTopWidth:o,borderRightWidth:o,borderLeftWidth:o,borderBottomWidth:o}):t.toLowerCase().indexOf("style")>-1?this.model.set({borderTopStyle:o,borderRightStyle:o,borderLeftStyle:o,borderBottomStyle:o}):t.toLowerCase().indexOf("color")>-1&&this.model.set({borderTopColor:o,borderRightColor:o,borderLeftColor:o,borderBottomColor:o},{silent:!0})),this.setInputByModel())},isSameBorder:function(e){var t=e.css("borderTopWidth")==e.css("borderRightWidth")&&e.css("borderLeftWidth")==e.css("borderBottomWidth")&&e.css("borderTopWidth")==e.css("borderLeftWidth"),o=e.css("borderTopColor")==e.css("borderRightColor")&&e.css("borderLeftColor")==e.css("borderBottomColor")&&e.css("borderTopColor")==e.css("borderLeftColor"),r=e.css("borderTopStyle")==e.css("borderRightStyle")&&e.css("borderLeftStyle")==e.css("borderBottomStyle")&&e.css("borderTopStyle")==e.css("borderLeftStyle");return t&&o&&r},parseStyleToModel:function(){var t=this.effect.firstSelectedObject.children();t.css("border");return 0==parseInt(t.css("borderTopWidth"))&&0==parseInt(t.css("borderLeftWidth"))&&0==parseInt(t.css("borderRightWidth"))&&0==parseInt(t.css("borderBottomWidth"))?new e:new e({use:!0,unify:this.isSameBorder(t),borderTopWidth:parseInt(t.css("borderTopWidth"))||0,borderTopStyle:t.css("borderTopStyle"),borderTopColor:t.css("borderTopColor"),borderRightWidth:parseInt(t.css("borderRightWidth"))||0,borderRightStyle:t.css("borderRightStyle"),borderRightColor:t.css("borderRightColor"),borderLeftWidth:parseInt(t.css("borderLeftWidth"))||0,borderLeftStyle:t.css("borderLeftStyle"),borderLeftColor:t.css("borderLeftColor"),borderBottomWidth:parseInt(t.css("borderBottomWidth"))||0,borderBottomStyle:t.css("borderBottomStyle"),borderBottomColor:t.css("borderBottomColor")})},stringifyStyle:function(){return!1===this.model.get("use")?{borderTopWidth:"0px",borderTopStyle:"none",borderTopColor:"",borderRightWidth:"0px",borderRightStyle:"none",borderRightColor:"",borderLeftWidth:"0px",borderLeftStyle:"none",borderLeftColor:"",borderBottomWidth:"0px",borderBottomStyle:"none",borderBottomColor:""}:{borderTopWidth:this.model.get("borderTopWidth")+"px",borderTopStyle:this.model.get("borderTopStyle"),borderTopColor:this.model.get("borderTopColor"),borderRightWidth:this.model.get("borderRightWidth")+"px",borderRightStyle:this.model.get("borderRightStyle"),borderRightColor:this.model.get("borderRightColor"),borderLeftWidth:this.model.get("borderLeftWidth")+"px",borderLeftStyle:this.model.get("borderLeftStyle"),borderLeftColor:this.model.get("borderLeftColor"),borderBottomWidth:this.model.get("borderBottomWidth")+"px",borderBottomStyle:this.model.get("borderBottomStyle"),borderBottomColor:this.model.get("borderBottomColor")}},borderChangeHandler:function(){var e=this.model.changedAttributes();(e.borderTopColor||e.borderLeftColor||e.borderRightColor||e.borderBottomColor)&&(this.getherInfo(),this.renderStyle())},renderStyle:function(){var e=this;this.effect.getEffectableObject().forEach(function(t){t.get("cvsobj_el").children("[data-text-content], [data-image-content]").css(e.stringifyStyle())}),this.effect.getBuilder().editor.saveContent()},setInputByModel:function(){this.$el.find("[data-value='borderTopWidth']").val(this.model.get("borderTopWidth")),this.$el.find("[data-value='borderLeftWidth']").val(this.model.get("borderLeftWidth")),this.$el.find("[data-value='borderRightWidth']").val(this.model.get("borderRightWidth")),this.$el.find("[data-value='borderBottomWidth']").val(this.model.get("borderBottomWidth")),this.$el.find("[data-value='borderTopStyle']").val(this.model.get("borderTopStyle")),this.$el.find("[data-value='borderLeftStyle']").val(this.model.get("borderLeftStyle")),this.$el.find("[data-value='borderRightStyle']").val(this.model.get("borderRightStyle")),this.$el.find("[data-value='borderBottomStyle']").val(this.model.get("borderBottomStyle")),this.$el.find("[data-value='borderTopColor']").val(this.model.get("borderTopColor")).spectrum("set",this.model.get("borderTopColor")),this.$el.find("[data-value='borderLeftColor']").val(this.model.get("borderLeftColor")).spectrum("set",this.model.get("borderLeftColor")),this.$el.find("[data-value='borderRightColor']").val(this.model.get("borderRightColor")).spectrum("set",this.model.get("borderRightColor")),this.$el.find("[data-value='borderBottomColor']").val(this.model.get("borderBottomColor")).spectrum("set",this.model.get("borderBottomColor"))}});Oven.Topmenu.Menubar.Effect=Oven.Topmenu.Menubar.Effect||{},Oven.Topmenu.Menubar.Effect.Border=o});$(function(){var t=Backbone.Model.extend({defaults:{use:!1,unify:!0,borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}),e=Oven.Topmenu.Menubar.Effect.Common,o=Backbone.View.extend({initialize:function(t){_.extend(this,t),this.model=this.parseStyleToModel(),this.commonEffect?this.commonEffect.initialize({$el:this.$el,model:this.model}):this.commonEffect=new e({template:_.template($("#borderRadiusTemplate").html()),$el:this.$el,model:this.model,caller:this})},getherInfo:function(){var t,e,o=void 0!==this.model.changedAttributes().unify;this.model.set({borderTopLeftRadius:parseInt(this.$el.find("input[type='text'][data-value='borderTopLeftRadius']").val())||0,borderTopRightRadius:parseInt(this.$el.find("input[type='text'][data-value='borderTopRightRadius']").val())||0,borderBottomLeftRadius:parseInt(this.$el.find("input[type='text'][data-value='borderBottomLeftRadius']").val())||0,borderBottomRightRadius:parseInt(this.$el.find("input[type='text'][data-value='borderBottomRightRadius']").val())||0}),this.model.get("unify")&&(o||this.model.changedAttributes())&&(o?e=this.model.get("borderTopLeftRadius"):this.model.changedAttributes()&&(t=Object.keys(this.model.changedAttributes()),e=this.model.changedAttributes()[t[0]]),this.model.set({borderTopLeftRadius:e,borderTopRightRadius:e,borderBottomLeftRadius:e,borderBottomRightRadius:e}),this.setInputByModel())},parseStyleToModel:function(){var e=this.effect.firstSelectedObject.children(),o=e.css("borderRadius");return"0"==o||"0px"==o||"none"==o.toLowerCase()||""==o?new t:new t({use:!0,unify:e.css("borderTopLeftRadius")==e.css("borderTopRightRadius")&&e.css("borderBottomLeftRadius")==e.css("borderBottomRightRadius")&&e.css("borderTopLeftRadius")==e.css("borderBottomLeftRadius"),borderTopLeftRadius:parseInt(e.css("borderTopLeftRadius"))||0,borderTopRightRadius:parseInt(e.css("borderTopRightRadius"))||0,borderBottomLeftRadius:parseInt(e.css("borderBottomLeftRadius"))||0,borderBottomRightRadius:parseInt(e.css("borderBottomRightRadius"))||0})},stringifyStyle:function(){if(!1===this.model.get("use"))return"";var t=[];return t.push(this.model.get("borderTopLeftRadius")+"px"),t.push(this.model.get("borderTopRightRadius")+"px"),t.push(this.model.get("borderBottomRightRadius")+"px"),t.push(this.model.get("borderBottomLeftRadius")+"px"),t.join(" ")},renderStyle:function(){var t=this;this.effect.getEffectableObject().forEach(function(e){e.get("cvsobj_el").children("[data-text-content], [data-image-content]").css({borderRadius:t.stringifyStyle()})}),this.effect.getBuilder().editor.saveContent()},setInputByModel:function(){this.$el.find("input[data-value='borderTopLeftRadius']").val(this.model.get("borderTopLeftRadius")),this.$el.find("input[data-value='borderTopRightRadius']").val(this.model.get("borderTopRightRadius")),this.$el.find("input[data-value='borderBottomLeftRadius']").val(this.model.get("borderBottomLeftRadius")),this.$el.find("input[data-value='borderBottomRightRadius']").val(this.model.get("borderBottomRightRadius"))}});Oven.Topmenu.Menubar.Effect=Oven.Topmenu.Menubar.Effect||{},Oven.Topmenu.Menubar.Effect.BorderRadius=o});$(function(){var e=Backbone.Model.extend({defaults:{use:!1,opacity:100}}),t=Oven.Topmenu.Menubar.Effect.Common,n=Backbone.View.extend({initialize:function(e){_.extend(this,e),this.model=this.parseStyleToModel(),this.commonEffect?this.commonEffect.initialize({$el:this.$el,model:this.model}):this.commonEffect=new t({template:_.template($("#opacityTemplate").html()),$el:this.$el,model:this.model,caller:this})},getherInfo:function(){this.model.set({opacity:parseInt(this.$el.find("input[type='text'][data-value='opacity']").val())||0})},parseStyleToModel:function(){var t=this.effect.firstSelectedObject.children().css("opacity");return 1==t||"none"==t.toLowerCase()||""==t?new e:new e({use:!0,opacity:parseInt(100*parseFloat(t))||0})},stringifyStyle:function(){return!1===this.model.get("use")?"":this.model.get("opacity")/100},renderStyle:function(){var e=this;this.effect.getEffectableObject().forEach(function(t){t.get("cvsobj_el").children("[data-text-content], [data-image-content]").css({opacity:e.stringifyStyle()})}),this.effect.getBuilder().editor.saveContent()}});Oven.Topmenu.Menubar.Effect=Oven.Topmenu.Menubar.Effect||{},Oven.Topmenu.Menubar.Effect.Opacity=n});$(function(){var e=Backbone.Model.extend({defaults:{use:!1,x:10,y:10,blur:10,spread:0,color:"rgba(0,0,0,0.5)",inset:!1}}),t=Oven.Topmenu.Menubar.Effect.Common,n=Backbone.View.extend({initialize:function(e){_.extend(this,e),this.model=this.parseStyleToModel(),this.commonEffect?this.commonEffect.initialize({$el:this.$el,model:this.model}):this.commonEffect=new t({template:_.template($("#boxShadowTemplate").html()),$el:this.$el,model:this.model,caller:this})},getherInfo:function(){this.model.set({x:parseInt(this.$el.find("input[type='text'][data-value='x']").val())||0,y:parseInt(this.$el.find("input[type='text'][data-value='y']").val())||0,blur:parseInt(this.$el.find("input[type='text'][data-value='blur']").val())||0,spread:parseInt(this.$el.find("input[type='text'][data-value='spread']").val())||0,inset:this.$el.find("input[type='checkbox'][data-value='inset']").is(":checked"),color:this.$el.find("input[data-value='color']").val()})},parseStyleToModel:function(){var t,n=this.effect.firstSelectedObject.children().css("boxShadow");if("none"==n.toLowerCase()||""==n)return new e;var i={};return t=n.replace(/\,\s/g,",").split(" "),t.forEach(function(e,n){/\#|rgb/.test(e)&&(i.color=e,t.splice(n,1))}),i.use=!0,i.x=parseInt(t[0])||0,i.y=parseInt(t[1])||0,i.blur=parseInt(t[2])||0,i.spread=parseInt(t[3])||0,i.inset=t[4]&&"inset"==t[4].toLowerCase(),new e(i)},stringifyStyle:function(){if(!1===this.model.get("use"))return"none";var e=[];return e.push(this.model.get("color")),e.push(this.model.get("x")+"px"),e.push(this.model.get("y")+"px"),e.push(this.model.get("blur")+"px"),e.push(this.model.get("spread")+"px"),this.model.get("inset")&&e.push("inset"),e.join(" ")},renderStyle:function(){var e=this;this.effect.getEffectableObject().forEach(function(t){t.get("cvsobj_el").children("[data-text-content], [data-image-content]").css({boxShadow:e.stringifyStyle()})}),this.effect.getBuilder().editor.saveContent()}});Oven.Topmenu.Menubar.Effect=Oven.Topmenu.Menubar.Effect||{},Oven.Topmenu.Menubar.Effect.BoxShadow=n});$(function(){var e=Backbone.Model.extend({defaults:{use:!1,x:3,y:3,blur:5,color:"rgba(0,0,0,0.5)"}}),t=Oven.Topmenu.Menubar.Effect.Common,n=Backbone.View.extend({initialize:function(e){_.extend(this,e),this.model=this.parseStyleToModel(),this.commonEffect?this.commonEffect.initialize({$el:this.$el,model:this.model}):this.commonEffect=new t({template:_.template($("#textShadowTemplate").html()),$el:this.$el,model:this.model,caller:this})},getherInfo:function(){this.model.set({x:parseInt(this.$el.find("input[type='text'][data-value='x']").val())||0,y:parseInt(this.$el.find("input[type='text'][data-value='y']").val())||0,blur:parseInt(this.$el.find("input[type='text'][data-value='blur']").val())||0,color:this.$el.find("input[data-value='color']").val()})},parseStyleToModel:function(t){var n,i=this.effect.firstSelectedObject.children().css("textShadow");if("none"==i.toLowerCase()||""==i)return new e;var o={};return n=i.replace(/\,\s/g,",").split(" "),n.forEach(function(e,t){/\#|rgb/.test(e)&&(o.color=e,n.splice(t,1))}),o.use=!0,o.x=parseInt(n[0]),o.y=parseInt(n[1]),o.blur=parseInt(n[2]),new e(o)},stringifyStyle:function(){if(!1===this.model.get("use"))return"none";var e=[];return e.push(this.model.get("color")),e.push(this.model.get("x")+"px"),e.push(this.model.get("y")+"px"),e.push(this.model.get("blur")+"px"),e.join(" ")},renderStyle:function(){var e=this;this.effect.getEffectableObject().forEach(function(t){t.get("cvsobj_el").children("[data-text-content], [data-image-content]").css({textShadow:e.stringifyStyle()})}),this.effect.getBuilder().editor.saveContent()}});Oven.Topmenu.Menubar.Effect=Oven.Topmenu.Menubar.Effect||{},Oven.Topmenu.Menubar.Effect.TextShadow=n});$(function(){var e=Oven.Topmenu.Menubar.Effect.BoxShadow,t=Oven.Topmenu.Menubar.Effect.TextShadow,i=Oven.Topmenu.Menubar.Effect.Opacity,n=Oven.Topmenu.Menubar.Effect.BorderRadius,a=Oven.Topmenu.Menubar.Effect.Border,o=Backbone.View.extend({events:{"mouseenter > .sub > a:not(.disabled)":"linkMouseenterHandler"},initialize:function(e){_.extend(this,e),this.template=_.template($("#rootmenuEffectTemplate").html()),this.appendToMenu(),this.render()},render:function(){return this.$el.html(this.template()),this.applyControl(),this},getBuilder:function(){return this.menubar.topmenu.builder},applyControl:function(){if(this.getEffectableObject().length<1)return!1;this.$el.find("> .sub > a").removeClass("disabled"),this.getBuilder().$el.find("> .effect-spectrum").remove(),this.firstSelectedObject=this.getEffectableObject()[0].get("cvsobj_el")},getEffectableObject:function(){return this.getBuilder().editor.canvas.selectCollection.filter(function(e){return"icon"!==e.get("cvsobj_type")&&"group"!==e.get("cvsobj_type")&&!1===e.get("cvsobj_locked")})},launchBoxShadow:function(){this.boxShadow?this.boxShadow.initialize({$el:this.$el.find("[data-effect='boxShadow']")}):this.boxShadow=new e({effect:this,$el:this.$el.find("[data-effect='boxShadow']")})},launchTextShadow:function(){this.textShadow?this.textShadow.initialize({$el:this.$el.find("[data-effect='textShadow']")}):this.textShadow=new t({effect:this,$el:this.$el.find("[data-effect='textShadow']")})},launchOpacity:function(){this.opacity?this.opacity.initialize({$el:this.$el.find("[data-effect='opacity']")}):this.opacity=new i({effect:this,$el:this.$el.find("[data-effect='opacity']")})},launchBorderRadius:function(){this.borderRadius?this.borderRadius.initialize({$el:this.$el.find("[data-effect='borderRadius']")}):this.borderRadius=new n({effect:this,$el:this.$el.find("[data-effect='borderRadius']")})},launchBorder:function(){this.border?this.border.initialize({$el:this.$el.find("[data-effect='border']")}):this.border=new a({effect:this,$el:this.$el.find("[data-effect='border']")})},appendToMenu:function(){this.$el.attr("data-menu")||(this.$el.addClass("menu_root").attr({"data-menu":this.menu}),this.menubar.$el.find(".menu").append(this.$el))},linkMouseenterHandler:function(e){var t=$(e.currentTarget).next().attr("data-effect");"boxShadow"==t?this.launchBoxShadow():"textShadow"==t?this.launchTextShadow():"opacity"==t?this.launchOpacity():"borderRadius"==t?this.launchBorderRadius():"border"==t&&this.launchBorder()}});Oven.Topmenu.Menubar=Oven.Topmenu.Menubar||{},Oven.Topmenu.Menubar.Effect=o});$(function(){var e=Backbone.View.extend({events:{"click .history_undo:not(.disabled)":"historyUndoClickHandler","click .history_redo:not(.disabled)":"historyRedoClickHandler","click .cut_object:not(.disabled)":"cutObject","click .copy_clipboard:not(.disabled)":"copyClipboard","click .paste_clipboard:not(.disabled)":"pasteClipboard","click .paste_clipboard_sync:not(.disabled)":"pasteClipboard_sync","click .duplicate_object:not(.disabled)":"duplicateObject","click .select_all:not(.disabled)":"selectAll","click .show_linkdialog:not(.disabled)":"showLinkDialog","click .synchronize_object:not(.disabled)":"synchronizeObject","click .synchronize_object_position:not(.disabled)":"synchronizeObjectAndPosition","click .copy_to_template:not(.disabled)":"copyToTemplate","click .send_to_drawer:not(.disabled)":"sendToDrawer"},initialize:function(e){_.extend(this,e),_.bindAll(this,"getBuilder","historyUndoClickHandler","historyRedoClickHandler"),this.delegateEvents(),this.template=_.template($("#rootmenuEditTemplate").html()),this.appendToMenu(),this.render()},appendToMenu:function(){this.$el.attr("data-menu")||(this.$el.addClass("menu_root").attr({"data-menu":this.menu}),this.menubar.$el.find(".menu").append(this.$el))},getBuilder:function(){return this.menubar.topmenu.builder},render:function(){var e={hasSelectCollection:!1,hasClipboardData:!1,hasNoUnlockedObject:!1,hasEditorModel:!1,isLinkable:!1};try{var t=this.getBuilder(),i=t.editor.canvas.selectCollection.where({cvsobj_locked:!1}),n=t.editor.canvas.selectCollection.where({cvsobj_locked:!1,cvsobj_memo:!1});e.hasSelectCollection=t.editor.canvas.selectCollection.length>0,e.hasClipboardData=void 0!==t.editor.model&&t.editor.clipboard.length>0,e.hasNoUnlockedObject=i.length<1,e.canvasElementLength=t.editor.canvas.$el.children().length,e.has_OnlyOne_Unlocked_Object=1==n.length}catch(e){}return this.$el.html(this.template(e)),this.getBuilder().editor.canvas.function.toggleHistoryButton(),this},historyUndoClickHandler:function(){this.getBuilder().editor.canvas.function.undoHistory(),this.menubar.blur()},historyRedoClickHandler:function(){this.getBuilder().editor.canvas.function.redoHistory(),this.menubar.blur()},cutObject:function(){this.getBuilder().editor.canvas.function.cutObject()},copyClipboard:function(){this.getBuilder().editor.canvas.function.copyToClipboard()},copyToTemplate:function(){this.getBuilder().editor.canvas.function.copyToTemplate()},pasteClipboard:function(){this.getBuilder().editor.canvas.function.pasteClipboard()},pasteClipboard_sync:function(){this.getBuilder().editor.canvas.function.pasteClipboard_sync()},duplicateObject:function(){this.getBuilder().editor.canvas.function.duplicateObject()},selectAll:function(){this.getBuilder().editor.canvas.function.selectAll()},showLinkDialog:function(){this.getBuilder().editor.canvas.function.showLinkDialog()},synchronizeObject:function(){this.getBuilder().editor.canvas.function.synchronizeObject()},synchronizeObjectAndPosition:function(){this.getBuilder().editor.canvas.function.synchronizeObjectAndPosition()},sendToDrawer:function(){this.getBuilder().object.sendToDrawerClickHandler()}});Oven.Topmenu.Menubar=Oven.Topmenu.Menubar||{},Oven.Topmenu.Menubar.Edit=e});$(function(){var e=Oven.Dialog.DownloadProject,t=Backbone.View.extend({events:{"click .add_page":"addPage","click .save_all:not(.disabled)":"saveAll","click .delete_sequence:not(.disabled)":"deleteSequence","click .duplicate_sequence:not(.disabled)":"duplicateSequence","click .export_sequence_png:not(.disabled)":"exportSequenceAsPNG","click .export_sequence_jpg:not(.disabled)":"exportSequenceAsJPG","click .export_sequence_pdf:not(.disabled)":"exportSequenceAsPDF","click .export_sequence_pdfmemo:not(.disabled)":"exportSequenceAsPDFwithMemo","click .webview_sequence:not(.disabled)":"webviewSequence","click .webview_qr:not(.disabled)":"showWebviewQRDialog","click .rename_sequence:not(.disabled)":"renameSequence","click .download_project:not(.disabled)":"downloadProject"},initialize:function(e){_.extend(this,e),_.bindAll(this,"getBuilder"),this.template=_.template($("#rootmenuPageTemplate").html()),this.appendToMenu(),this.render()},render:function(){var e={isCurrentPageUnsaved:!1,hasUnsavedItems:!1};if(this.getBuilder().sequenceList){var t=this.getBuilder().sequenceList;e={isCurrentPageUnsaved:void 0!==t.selectedItem&&!0===t.selectedItem.model.get("_isModified"),hasUnsavedItems:t.collection.where({_isModified:!0}).length>0,hasSelectedSequence:void 0!==t.selectedItem}}return this.$el.html(this.template(e)),this},appendToMenu:function(){this.$el.attr("data-menu")||(this.$el.addClass("menu_root").attr({"data-menu":this.menu}),this.menubar.$el.find(".menu").append(this.$el))},getBuilder:function(){return this.menubar.topmenu.builder},addPage:function(){this.getBuilder().sequenceList.appendSequence()},savePage:function(){var e=this.getBuilder().sequenceList.selectedItem;e.model.get("_isModified")&&e.saveSequence()},saveAll:function(){this.menubar.topmenu.builder.sequenceList.collection.where({_isModified:!0}).forEach(function(e){e.item.saveSequence()})},deleteSequence:function(){this.getBuilder().sequenceList.selectedItem.destroySequence()},duplicateSequence:function(){this.getBuilder().sequenceList.selectedItem.duplicateSequence()},exportSequenceAsPNG:function(){this.getBuilder().sequenceList.selectedItem.exportSequenceAsPNG()},exportSequenceAsJPG:function(){this.getBuilder().sequenceList.selectedItem.exportSequenceAsJPG()},exportSequenceAsPDF:function(){this.getBuilder().sequenceList.selectedItem.exportSequenceAsPDF()},exportSequenceAsPDFwithMemo:function(){this.getBuilder().sequenceList.selectedItem.exportSequenceAsPDFwithMemo()},webviewSequence:function(){this.getBuilder().sequenceList.selectedItem.webviewSequence()},showWebviewQRDialog:function(){this.getBuilder().sequenceList.showWebviewQRDialog()},renameSequence:function(e){this.getBuilder().sequenceList.selectedItem.focusRenameInput()},downloadProject:function(){this.downloadProjectDialog?this.downloadProjectDialog.initialize():this.downloadProjectDialog=new e({builder:this.getBuilder()})}});Oven.Topmenu.Menubar=Oven.Topmenu.Menubar||{},Oven.Topmenu.Menubar.Page=t});$(function(){var e=new Oven.Util,t=Backbone.View.extend({events:{"click .share_option":"showPermissionDialog","submit .form_rename_project":"submitProjectName","click .go_dashboard":"goDashboard","click .modify_project_mode":"modifyProjectMode","click .modify_project_info":"modifyProjectInfo","click .rename_project":"renameProject","click .cp_project":"copyProject","click .rm_project":"deleteProject"},initialize:function(e){_.extend(this,e),_.bindAll(this,"submitProjectName","showPermissionDialog"),this.template=_.template($("#rootmenuProjectTemplate").html()),this.projectNameFormTemplate=_.template($("#renameProjectFormTemplate").html()),this.appendToMenu(),this.render()},appendToMenu:function(){this.$el.attr("data-menu")||(this.$el.addClass("menu_root").attr({"data-menu":this.menu}),this.menubar.$el.find(".menu").append(this.$el))},render:function(){var e=this.menubar.topmenu.builder.projectModel.toJSON();return this.$el.html(this.template(e)),this},renameProject:function(){var e=this,t=$(this.projectNameFormTemplate({pro_title:e.menubar.topmenu.builder.projectModel.get("pro_title")}));t.on({submit:this.submitProjectName,keyup:function(t){27===t.which&&e.menubar.topmenu.renderProjectName()}}),t.find("input:first-of-type").on({blur:this.submitProjectName}),this.menubar.$el.find(".project_name").html(t),t.find("input:first-of-type").select().focus(),setTimeout(function(){t.find("input").addClass("show")},10)},submitProjectName:function(){var t=this,o=$.trim($(".form_rename_project").find(".pro_title").val());return e.encodeHtml(o)==this.menubar.topmenu.builder.projectModel.get("pro_title")||o.length<1?(this.menubar.topmenu.renderProjectName(),!1):(this.menubar.topmenu.builder.projectModel.save({pro_title:e.encodeHtml(o)},{patch:!0,wait:!0,error:function(e,o){401==o.status||403==o.status?t.menubar.topmenu.builder.showLoginDialog(function(){t.submitProjectName()}):alert("오류로 인해 실행할 수 없습니다. 잠시 후에 다시 시도해주세요.")}}),!1)},showPermissionDialog:function(e){this.menubar.topmenu.builder.showPermissionDialog()},modifyProjectInfo:function(){this.menubar.topmenu.builder.showProjectModifyDialog()},modifyProjectMode:function(){this.menubar.topmenu.builder.showProjectModifyDialog(".project_mode")},goDashboard:function(){window.opener?(window.opener.location.reload(),window.close()):location.href="/"},copyProject:function(){var e=this.menubar.topmenu.builder.translation,t=this.menubar.topmenu.builder.projectModel;$.ajax({url:"/api/projects/"+t.id,method:"PUT",success:function(e){window.opener&&window.opener.location.reload(),location.href="/project/"+e.pro_id+"/"},error:function(t){401==t.status?(alert(e.convert("You don't have the permission. Please login again.")),window.opener?window.close():location.href="/"):alert(e.convert("Cannot perform action due to an error."))}})},deleteProject:function(){var e=this.menubar.topmenu.builder.translation;if(!confirm(e.convert("Are you sure to delete?")))return!1;var t=this;this.menubar.topmenu.builder.projectModel.destroy({wait:!0,dataType:"text",success:function(e){window.opener?(window.opener.location.reload(),window.close()):location.href="/"},error:function(e,o){401==o.status||403==o.status?t.menubar.topmenu.builder.showLoginDialog():alert("오류로 인해 실행할 수 없습니다. 잠시 후에 다시 시도해주세요.")}})}});Oven.Topmenu.Menubar=Oven.Topmenu.Menubar||{},Oven.Topmenu.Menubar.Project=t});$(function(){var e=Oven.Topmenu.Menubar.Project,n=Oven.Topmenu.Menubar.Page,t=Oven.Topmenu.Menubar.Edit,u=Oven.Topmenu.Menubar.Effect,o=Oven.Topmenu.Menubar.Table,i=Oven.Topmenu.Menubar.Memo,r=Oven.Topmenu.Menubar.View,l=Oven.Topmenu.Menubar.Help,s=Oven.Topmenu.Menubar.Align,c=Backbone.View.extend({events:{"click .menu_root":"stopPropagation","click .menu_root > a:not(.disabled)":"rootClickHandler","click .menu_root > .sub a:not(.disabled):not(.checked):not(.has_sub)":"blur","mouseover .menu_root > a:not(.disabled)":"rootMouseoverHandler","mouseenter .menu_root > .sub > a:not(.disabled)":"treeMouseenterHandler","mouseenter .menu_root .effect:not(.disabled) label":"treeMouseenterHandler","click .menu_head .rename_project":"renameProjectClickHanler","click .menu_head h3":"renameProjectClickHanler","click .toggle_sequence":"toggleSeqquenceClickHandler","click .toggle_object":"toggleObjectClickHandler"},initialize:function(e){_.extend(this,e),_.bindAll(this,"rootClickHandler","treeMouseenterHandler","blur","linkMenuModules"),this.template=_.template($("#rootmenuTemplate").html()),this.selectedRootmenu=void 0,this.selectedSubmenu=void 0,this.render(),this.linkMenuModules()},render:function(){this.$el.find(".menu").html(this.template())},rootClickHandler:function(e){var n;if(void 0!==this.selectedRootmenu&&(n=$(e.currentTarget).get(0)==this.selectedRootmenu.$el.find("> a").get(0),this.blur(),n))return!1;this.topmenu.builder.$el.click(),this.selectedRootmenu=this[$(e.currentTarget).parent(".menu_root").attr("data-menu")+"Menu"],this.showRootmenu(),this.topmenu.builder.$el.one("click",this.blur)},treeMouseenterHandler:function(e){if(this.clearSelectedSubmenu(),!$(e.currentTarget).hasClass("has_sub"))return!1;$(e.currentTarget).addClass("on"),this.selectedSubmenu=$(e.currentTarget).next(".sub"),this.selectedSubmenu.fadeIn(100)},rootMouseoverHandler:function(e){if(!this.selectedRootmenu||$(e.currentTarget).parent(".menu_root").get(0)==this.selectedRootmenu.$el.get(0))return!1;this.rootClickHandler(e)},showRootmenu:function(){this.selectedRootmenu.render().$el.find("> .sub").fadeIn(100),this.selectedRootmenu.$el.find("> a").addClass("on")},blur:function(e){this.clearSelectedRootmenu(),this.clearSelectedSubmenu(),this.topmenu.builder.$el.off("click",this.blur)},clearSelectedRootmenu:function(){void 0!==this.selectedRootmenu&&(this.selectedRootmenu.$el.find("> a").removeClass("on"),this.selectedRootmenu.$el.find("> .sub").hide(),this.selectedRootmenu=void 0)},clearSelectedSubmenu:function(){void 0!==this.selectedSubmenu&&(this.selectedSubmenu.find("[data-colorpicker]").spectrum("hide"),this.selectedSubmenu.prev(".on").removeClass("on alt"),this.selectedSubmenu.hide(),this.selectedSubmenu=void 0)},stopPropagation:function(e){return e.stopPropagation(),!1},linkMenuModules:function(){this.projectMenu=new e({menubar:this,menu:"project"}),this.pageMenu=new n({menubar:this,menu:"page"}),this.editMenu=new t({menubar:this,menu:"edit"}),this.alignMenu=new s({menubar:this,menu:"align"}),this.effectMenu=new u({menubar:this,menu:"effect"}),this.tableMenu=new o({menubar:this,menu:"table"}),this.memoMenu=new i({menubar:this,menu:"memo"}),this.viewMenu=new r({menubar:this,menu:"view"}),this.helpMenu=new l({menubar:this,menu:"help"})},renameProjectClickHanler:function(){this.projectMenu.renameProject()},toggleSeqquenceClickHandler:function(){this.topmenu.builder.sequenceList.toggleSequence()},toggleObjectClickHandler:function(){this.topmenu.builder.object.toggleObject()}});Oven.Topmenu=Oven.Topmenu||{},Oven.Topmenu.Menubar=c});$(function(){var e=Oven.Topmenu.Menubar,t=Oven.Topmenu.Quickbar,l=Backbone.View.extend({events:{"click .maximize_editor":"toggleFullscreen"},initialize:function(l){_.extend(this,l),_.bindAll(this,"render","renderProjectName","toggleFullscreen"),this.template=_.template($("#topmenuTemplate").html()),this.projectNameTemplate=_.template($("#projectNameTemplate").html()),this.bindFullscreenEvent(),this.render(),this.menubar=new e({$el:this.$el.find("#menuBar"),topmenu:this}),this.quickbar=new t({$el:this.$el.find("#quickBar"),topmenu:this})},render:function(){this.$el.html(this.template())},renderProjectName:function(){$("html title").text(this.builder.projectModel.get("pro_title")),this.$el.find(".project_name").html(this.projectNameTemplate({pro_title:this.builder.projectModel.get("pro_title")}))},bindFullscreenEvent:function(){var e=this;$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(t){var l=document.isFullScreen||document.mozIsFullScreen||document.webkitIsFullScreen;e.builder.$el.attr("data-fullscreen",l)})},toggleFullscreen:function(){var e=document,t=document.documentElement;e.isFullScreen||e.mozIsFullScreen||e.webkitIsFullScreen?e.exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen&&e.webkitCancelFullScreen():t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()}});Oven.Topmenu=l});$(function(){var e=Backbone.View.extend({events:{click:"stopPropagation","mouseenter > a:not(.disabled)":"treeMouseenterHandler"},initialize:function(e){!0===this.isShown&&this.blur(),this.callerEvents=void 0,this.caller=void 0,this.callerModel=void 0,this.callerType=void 0,this.hasMultipleCaller=!1,this.e=void 0,_.extend(this,e),_.bindAll(this,"render","blur","setPosition","animateEffect","treeMouseenterHandler","highlightCaller","bindCallerEvents"),this.builder.$el.click(),this.template={sequenceItem:_.template($("#sequenceItemContextTemplate").html()),objectItem:_.template($("#objectItemContextTemplate").html()),canvasObject:_.template($("#canvasObjectContextTemplate").html()),editor:_.template($("#editorContextTemplate").html()),fontSelector:_.template($("#fontSelectorTemplate").html()),webview:_.template($("#webviewContextTemplate").html())},this.caller&&this.callerType&&this.e&&this.render()},render:function(){var e=this.callerModel||{};e.hasMultipleCaller=this.hasMultipleCaller;var t=this.template[this.callerType](e);this.$el.html(t),this.$el.addClass("contextmenu"),this.builder.$el.append(this.$el),this.bindCallerEvents(),this.setPosition(),this.animateEffect(),this.highlightCaller(),this.applyColorpicker(),this.builder.$el.one("click",this.blur),this.isShown=!0,this.builder.editor.clearTextSelection()},bindCallerEvents:function(){if(!this.callerEvents)return!1;var e,t,i,l;for(l in this.callerEvents){e=l.split(" ")[0],t=l.split(" ")[1],i="function"==typeof this.callerEvents[l]?this.callerEvents[l]:this.caller[this.callerEvents[l]];var s=this;this.$el.find(t).on(e,i),this.$el.find(t).on(e,function(){s.blur()})}},setPosition:function(){this.setWidth(),void 0!==this.callerModel.offsetY||void 0!==this.callerModel.offsetX?this.setFixedPosition():this.setRelativePosition()},setRelativePosition:function(){var e=this.builder.$el.width()<this.e.clientX+this.$el.width()+50?this.e.clientX+this.$el.width()+50-this.builder.$el.width():0,t=this.builder.$el.height()<this.e.clientY+this.$el.height()+50?this.e.clientY+this.$el.height()+50-this.builder.$el.height():0;this.$el.css({top:this.e.clientY+10-t,left:this.e.clientX+10-e})},setRelativeSubPosition:function(e){var t=this.builder.$el.height()<e.offset().top+e.height()+50?e.offset().top+e.height()+50-this.builder.$el.height():0;e.css({marginTop:parseInt(e.css("marginTop"))-t})},setFixedPosition:function(){this.$el.css({top:$(this.e.currentTarget).position().top+this.callerModel.offsetY,left:$(this.e.currentTarget).position().left+this.callerModel.offsetX})},setWidth:function(){this.$el.css({width:this.callerModel.width?this.callerModel.width:""})},animateEffect:function(){this.$el.fadeIn("fast");var e=this;setTimeout(function(){e.$el.addClass("show")},10)},highlightCaller:function(){},applyColorpicker:function(){var e=this,t=this.$el.find("[data-colorpicker]");if(t.length<1)return!1;var i=e.caller.model,l=t.parent().prev().find(".color_window");t.spectrum({preferredFormat:"hex",clickoutFiresChange:!1,showPalette:!0,showInput:!0,allowEmpty:!1,showAlpha:!1,maxSelectionSize:8,showSelectionPalette:!0,selectionPalette:[],localStorageKey:"oven.sequence.spectrum",palette:[["#1abc9c","#16a085","#ffffff"],["#2ecc71","#27ae60","#E0E0E0"],["#3498db","#2980b9","#BEBEBE"],["#9b59b6","#8e44ad","#9E9E9E"],["#34495e","#2c3e50","#7F7F7F"],["#f1c40f","#f39c12","#5E5E5E"],["#e67e22","#d35400","#404040"],["#e74c3c","#c0392b","#212121"],["#95a5a6","#7f8c8d","#000000"]],change:function(e){i.set({seq_background:e.toRgbString()})},move:function(t){e.builder.editor.canvas.previewBackgroundColor(t.toRgbString()),l.css({color:t.toRgbString()})}}),t.on("dragstop.spectrum",function(e,l){t.spectrum("set",l),i.set({seq_background:l.toRgbString()})}),t.spectrum("container").appendTo(t.parent()),t.spectrum("show")},blur:function(){if(!this.isShown)return!1;this.highlightCaller(),this.$el.hide().html("").removeClass("show"),this.builder.$el.off("click",this.blur),this.isShown=!1},treeMouseenterHandler:function(e){if(void 0!==this.selectedSubmenu&&(this.selectedSubmenu.prev(".on").removeClass("on alt"),this.selectedSubmenu.hide().removeClass("sub_on"),this.selectedSubmenu=void 0),!$(e.currentTarget).hasClass("has_sub"))return!1;$(e.currentTarget).addClass("on"),this.selectedSubmenu=$(e.currentTarget).next(".sub"),this.selectedSubmenu.fadeIn(100).addClass("sub_on"),this.setRelativeSubPosition(this.selectedSubmenu)},stopPropagation:function(e){e.stopPropagation()}});Oven.Builder=Oven.Builder||{},Oven.Builder.Contextmenu=e});$(function(){var t=Backbone.View.extend({events:{keydown:"keydownHandler"},initialize:function(t){_.extend(this,t),_.bindAll(this,"keydownHandler")},keydownHandler:function(t){var e=this.$el.find("input:not([type='checkbox']):focus, textarea:focus, [contenteditable='true']:focus").length>0,i=this.$el.find(".modal.in").length>0;if(e||i)return!0;var c=t.which,r=t.altKey,s=t.ctrlKey||t.metaKey,l=t.shiftKey;if(s&&!l&&90==c)try{this.builder.editor.canvas.function.undoHistory(),this.applyShortcut(t)}catch(t){}else if(s&&l&&90==c)try{this.builder.editor.canvas.function.redoHistory(),this.applyShortcut(t)}catch(t){}else if(s&&!l&&83==c)try{this.builder.topmenu.menubar.pageMenu.saveAll(),this.applyShortcut(t)}catch(t){}else if(s&&l&&83==c)try{this.builder.topmenu.menubar.pageMenu.saveAll(),this.applyShortcut(t)}catch(t){}else if(13==c||113==c)try{var a=this.builder.editor.canvas.selectCollection.where({cvsobj_locked:!1});1===a.length&&"group"!==a[0].get("cvsobj_type")&&(this.builder.editor.canvas.editText(a[0].get("cvsobj_el")),this.applyShortcut(t))}catch(t){}else if(!r||37!=c&&39!=c)if(!l||37!=c&&38!=c&&39!=c&&40!=c)if(37==c||38==c||39==c||40==c)try{this.$el.one("keyup",this.builder.editor.saveContent),this.builder.editor.canvas.function.nudgeObject(c),this.applyShortcut(t)}catch(t){}else if(188==c||33==c||190==c||34==c)try{this.builder.sequenceList.moveSequence(188==c||33==c?-1:1),this.applyShortcut(t)}catch(t){}else if(46==c||8==c)try{this.builder.editor.canvas.function.deleteObject(),this.applyShortcut(t)}catch(t){}else if(s&&88==c)try{this.builder.editor.canvas.function.cutObject(),this.applyShortcut(t)}catch(t){}else if(s&&!l&&86==c)try{this.builder.editor.canvas.function.pasteClipboard(),this.applyShortcut(t)}catch(t){}else if(s&&l&&86==c)try{this.builder.editor.canvas.function.pasteClipboard_sync(),this.applyShortcut(t)}catch(t){}else if(s&&!l&&67==c)try{this.builder.editor.canvas.function.copyToClipboard(),this.applyShortcut(t)}catch(t){}else if(s&&l&&67==c)try{this.builder.editor.canvas.function.copyToTemplate(),this.applyShortcut(t)}catch(t){}else if(s&&65==c)try{this.builder.editor.canvas.function.selectAll(),this.applyShortcut(t)}catch(t){}else if(s&&!l&&71==c)try{this.builder.editor.canvas.function.makeGroup(),this.applyShortcut(t)}catch(t){}else if(s&&l&&71==c)try{this.builder.editor.canvas.function.destroyGroup(),this.applyShortcut(t)}catch(t){}else if(s&&76==c)try{this.builder.editor.canvas.function.showLinkDialog(),this.applyShortcut(t)}catch(t){}else if(s&&!l&&75==c)try{this.builder.editor.canvas.function.lockObject(),this.applyShortcut(t)}catch(t){}else if(s&&l&&75==c)try{this.builder.editor.canvas.function.unlockObject(),this.applyShortcut(t)}catch(t){}else if(!s||l||r||73!=c)if(r&&71==c)try{this.builder.topmenu.menubar.viewMenu.toggleGrid(),this.applyShortcut(t)}catch(t){}else if(r&&72==c)try{this.builder.topmenu.menubar.viewMenu.toggleRuler(),this.applyShortcut(t)}catch(t){}else if(121==c)try{this.builder.topmenu.menubar.projectMenu.$el.find("> a").click(),this.applyShortcut(t)}catch(t){}else if(!r||49!=c&&50!=c&&51!=c&&52!=c){if(r&&(57==c||48==c))try{57==c?this.builder.sequenceList.toggleSequence():48==c&&this.builder.object.toggleObject(),this.applyShortcut(t)}catch(t){}}else try{this.$el.find(".object_tab").children("a").eq(c-49).click(),this.applyShortcut(t)}catch(t){}else try{this.builder.sequenceList.appendSequence(),this.applyShortcut(t)}catch(t){}else try{this.$el.one("keyup",this.builder.editor.saveContent),this.builder.editor.canvas.function.supernudgeObject(c),this.applyShortcut(t)}catch(t){}else try{this.$el.one("keyup",this.builder.editor.saveContent),this.builder.editor.canvas.function.rotateAngleObject(c),this.applyShortcut(t)}catch(t){}},applyShortcut:function(t){t.preventDefault(),this.$el.click()}});Oven.Builder=Oven.Builder||{},Oven.Builder.Shortcut=t});$(function(){var e=Oven.Builder.Contextmenu,t=Oven.Topmenu,i=Oven.Sequence.List,n=Oven.Editor,o=Oven.Project.Model,r=Oven.Object,s=Oven.Project.PermissionDialog,l=Oven.Project.LoginDialog,a=Oven.Project.ModifyDialog,c=Oven.Builder.Shortcut,h=Oven.Translation,d=Backbone.View.extend({events:{contextmenu:"contextmenuHandler"},initialize:function(o){_.extend(this,o),_.bindAll(this,"initializeProjectModel","projectChangeHandler"),this.template=_.template($("#builderTemplate").html()),this.$el.find("#builder").html(this.template()),this.setUserInfo(),this.initializeProjectModel(),this.translation=new h({locale:this.userInfo.locale}),this.contextmenu=new e({builder:this}),this.object=new r({$el:this.$el.find("#object"),builder:this}),this.sequenceList=new i({$el:this.$el.find("#sequence"),builder:this}),this.editor=new n({$el:this.$el.find("#editor"),builder:this}),this.topmenu=new t({$el:this.$el.find("#topmenu"),builder:this}),this.shortcut=new c({$el:this.$el,builder:this});var s=this;window.onbeforeunload=function(){return s.sequenceList.collection.where({_isModified:!0}).length>0?s.translation.convert("You have unsaved page."):null},$.removeCookie("OVEN_PROCESSING_FILES",{path:"/"}),this.$el.find("#initializeBuilder, #initializeUserInfo").remove(),$.ajaxSetup({complete:function(e,t){ga("send","pageview",this.url)}})},contextmenuHandler:function(e){e.stopPropagation(),e.preventDefault()},makeId:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<5;i++)e+=t.charAt(Math.floor(Math.random()*t.length));return this.sequenceList.collection.filter(function(t){return t.get("seq_content").indexOf(e)>-1}).length>0?this.makeId():e},initializeProjectModel:function(){this.projectModel=new o({id:this.pro_id,pro_screen:this.initScreen});var e=this;this.projectModel.fetch({success:function(t){delete e.initScreen,e.topmenu.renderProjectName(),t.on({change:e.projectChangeHandler})},reset:!0})},projectChangeHandler:function(){var e=this.projectModel.changedAttributes();e.pro_title&&this.topmenu.renderProjectName(),e.pro_screen&&(this.topmenu.menubar.projectMenu.render(),this.sequenceList.proScreenChangeHandler())},showPermissionDialog:function(){this.projectPermissionDialog?this.projectPermissionDialog.initialize({model:this.projectModel}):this.projectPermissionDialog=new s({model:this.projectModel,builder:this})},showLoginDialog:function(e){this.loginDialog?this.loginDialog.initialize({callback:e}):this.loginDialog=new l({builder:this,callback:e})},showProjectModifyDialog:function(e){this.projectModifyDialog?this.projectModifyDialog.initialize({startTabSelector:e,model:this.projectModel}):this.projectModifyDialog=new a({model:this.projectModel,startTabSelector:e})},setUserInfo:function(){switch(this.userInfo=loggedUser,this.userInfo.grade){case"enterprise":this.userInfo.imageStorage={MAX_COUNT:1e4,MAX_SIZESUM:1048576e4,MAX_FILESIZE:5242880};break;case"standard":this.userInfo.imageStorage={MAX_COUNT:500,MAX_SIZESUM:524288e3,MAX_FILESIZE:5242880};break;case"free":default:this.userInfo.imageStorage={MAX_COUNT:30,MAX_SIZESUM:31457280,MAX_FILESIZE:2097152}}}});Oven.Builder=Oven.Builder||{},Oven.Builder.App=d});